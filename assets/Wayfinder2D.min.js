function ClassCallback(t,e){return function(){return e.apply(t,arguments)}}function Rectangle(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n,this.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)}}if(void 0===Float32Array)var Float32Array=function(){return[0,0]};"undefined"!=typeof window&&(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,16)},window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),"function"!=typeof String.prototype.format&&(String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,i){return void 0!==t[i]?t[i]:e})}),window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),window.console=window.console||{log:function(){},error:function(){}};var Class=function(){};!function(){var t=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function n(){!t&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;t=!0;var o=new this;t=!1;for(var r in i)o[r]="function"==typeof i[r]&&"function"==typeof s[r]&&e.test(i[r])?function(t,e){return function(){var i=this._super;this._super=s[t];var n=e.apply(this,arguments);return this._super=i,n}}(r,i[r]):i[r];return n.prototype=o,n.prototype.constructor=n,n.extend=arguments.callee,n}}();var Callback=ClassCallback;!function(t,e){"use strict";var i=function t(e,i){return new t.Instance(e,i||{})};i.VERSION="1.1.2",i.defaults={behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},i.DOCUMENT=document,i.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,i.HAS_TOUCHEVENTS="ontouchstart"in t,i.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),i.NO_MOUSEEVENTS=i.HAS_TOUCHEVENTS&&i.IS_MOBILE||i.HAS_POINTEREVENTS,i.CALCULATE_INTERVAL=25;var n={},s=i.DIRECTION_DOWN="down",o=i.DIRECTION_LEFT="left",r=i.DIRECTION_UP="up",a=i.DIRECTION_RIGHT="right",h=i.POINTER_MOUSE="mouse",c=i.POINTER_TOUCH="touch",d=i.POINTER_PEN="pen",u=i.EVENT_START="start",l=i.EVENT_MOVE="move",f=i.EVENT_END="end",g=i.EVENT_RELEASE="release",p=i.EVENT_TOUCH="touch";i.READY=!1,i.plugins=i.plugins||{},i.gestures=i.gestures||{};var m=i.utils={extend:function(t,i,n){for(var s in i)!i.hasOwnProperty(s)||t[s]!==e&&n||(t[s]=i[s]);return t},on:function(t,e,i){t.addEventListener(e,i,!1)},off:function(t,e,i){t.removeEventListener(e,i,!1)},each:function(t,i,n){var s,o;if("forEach"in t)t.forEach(i,n);else if(t.length!==e){for(s=0,o=t.length;o>s;s++)if(!1===i.call(n,t[s],s,t))return}else for(s in t)if(t.hasOwnProperty(s)&&!1===i.call(n,t[s],s,t))return},inStr:function(t,e){return t.indexOf(e)>-1},inArray:function(t,e){if(t.indexOf){var i=t.indexOf(e);return-1!==i&&i}for(var n=0,s=t.length;s>n;n++)if(t[n]===e)return n;return!1},toArray:function(t){return Array.prototype.slice.call(t,0)},hasParent:function(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1},getCenter:function(t){var e=[],i=[],n=[],s=[],o=Math.min,r=Math.max;return 1===t.length?{pageX:t[0].pageX,pageY:t[0].pageY,clientX:t[0].clientX,clientY:t[0].clientY}:(m.each(t,function(t){e.push(t.pageX),i.push(t.pageY),n.push(t.clientX),s.push(t.clientY)}),{pageX:(o.apply(Math,e)+r.apply(Math,e))/2,pageY:(o.apply(Math,i)+r.apply(Math,i))/2,clientX:(o.apply(Math,n)+r.apply(Math,n))/2,clientY:(o.apply(Math,s)+r.apply(Math,s))/2})},getVelocity:function(t,e,i){return{x:Math.abs(e/t)||0,y:Math.abs(i/t)||0}},getAngle:function(t,e){var i=e.clientX-t.clientX,n=e.clientY-t.clientY;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(t,e){return Math.abs(t.clientX-e.clientX)>=Math.abs(t.clientY-e.clientY)?t.clientX-e.clientX>0?o:a:t.clientY-e.clientY>0?r:s},getDistance:function(t,e){var i=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(i*i+n*n)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==r||t==s},setPrefixedCss:function(t,e,i,n){var s=["","Webkit","Moz","O","ms"];e=m.toCamelCase(e);for(var o=0;o<s.length;o++){var r=e;if(s[o]&&(r=s[o]+r.slice(0,1).toUpperCase()+r.slice(1)),r in t.style){t.style[r]=(null==n||n)&&i||"";break}}},toggleBehavior:function(t,e,i){if(e&&t&&t.style){m.each(e,function(e,n){m.setPrefixedCss(t,n,e,i)});var n=i&&function(){return!1};"none"==e.userSelect&&(t.onselectstart=n),"none"==e.userDrag&&(t.ondragstart=n)}},toCamelCase:function(t){return t.replace(/[_-]([a-z])/g,function(t){return t[1].toUpperCase()})}},y=i.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(t,e,i,n){var s=e.split(" ");m.each(s,function(e){m.on(t,e,i),n&&n(e)})},off:function(t,e,i,n){var s=e.split(" ");m.each(s,function(e){m.off(t,e,i),n&&n(e)})},onTouch:function(t,e,s){var o=this,r=function(n){var r,a=n.type.toLowerCase(),h=i.HAS_POINTEREVENTS,c=m.inStr(a,"mouse");c&&o.preventMouseEvents||(c&&e==u&&0===n.button?(o.preventMouseEvents=!1,o.shouldDetect=!0):h&&e==u?o.shouldDetect=1===n.buttons:c||e!=u||(o.preventMouseEvents=!0,o.shouldDetect=!0),h&&e!=f&&v.updatePointer(e,n),o.shouldDetect&&(r=o.doDetect.call(o,n,e,t,s)),r==f&&(o.preventMouseEvents=!1,o.shouldDetect=!1,v.reset()),h&&e==f&&v.updatePointer(e,n))};return this.on(t,n[e],r),r},doDetect:function(t,e,i,n){var s=this.getTouchList(t,e),o=s.length,r=e,a=s.trigger,h=o;e==u?a=p:e==f&&(a=g,h=s.length-(t.changedTouches?t.changedTouches.length:1)),h>0&&this.started&&(r=l),this.started=!0;var c=this.collectEventData(i,r,s,t);return e!=f&&n.call(P,c),a&&(c.changedLength=h,c.eventType=a,n.call(P,c),c.eventType=r,delete c.changedLength),r==f&&(n.call(P,c),this.started=!1),r},determineEventTypes:function(){var e;return e=i.HAS_POINTEREVENTS?t.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:i.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n[u]=e[0],n[l]=e[1],n[f]=e[2],n},getTouchList:function(t,e){if(i.HAS_POINTEREVENTS)return v.getTouchList();if(t.touches){if(e==l)return t.touches;var n=[],s=[].concat(m.toArray(t.touches),m.toArray(t.changedTouches)),o=[];return m.each(s,function(t){!1===m.inArray(n,t.identifier)&&o.push(t),n.push(t.identifier)}),o}return t.identifier=1,[t]},collectEventData:function(t,e,i,n){var s=c;return m.inStr(n.type,"mouse")||v.matchType(h,n)?s=h:v.matchType(d,n)&&(s=d),{center:m.getCenter(i),timeStamp:Date.now(),target:n.target,touches:i,eventType:e,pointerType:s,srcEvent:n,preventDefault:function(){var t=this.srcEvent;t.preventManipulation&&t.preventManipulation(),t.preventDefault&&t.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return P.stopDetect()}}}},v=i.PointerEvent={pointers:{},getTouchList:function(){var t=[];return m.each(this.pointers,function(e){t.push(e)}),t},updatePointer:function(t,e){t==f||t!=f&&1!==e.buttons?delete this.pointers[e.pointerId]:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e)},matchType:function(t,e){if(!e.pointerType)return!1;var i=e.pointerType,n={};return n[h]=i===(e.MSPOINTER_TYPE_MOUSE||h),n[c]=i===(e.MSPOINTER_TYPE_TOUCH||c),n[d]=i===(e.MSPOINTER_TYPE_PEN||d),n[t]},reset:function(){this.pointers={}}},P=i.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:m.extend({},e),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);var e=this.current.inst,i=e.options;return m.each(this.gestures,function(n){return!this.stopped&&e.enabled&&i[n.name]&&!1===n.handler.call(n,t,e)?(this.stopDetect(),!1):void 0},this),this.current&&(this.current.lastEvent=t),t.eventType==f&&this.stopDetect(),t}},stopDetect:function(){this.previous=m.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(t,e,n,s,o){var r=this.current,a=!1,h=r.lastCalcEvent,c=r.lastCalcData;h&&t.timeStamp-h.timeStamp>i.CALCULATE_INTERVAL&&(e=h.center,n=t.timeStamp-h.timeStamp,s=t.center.clientX-h.center.clientX,o=t.center.clientY-h.center.clientY,a=!0),(t.eventType==p||t.eventType==g)&&(r.futureCalcEvent=t),(!r.lastCalcEvent||a)&&(c.velocity=m.getVelocity(n,s,o),c.angle=m.getAngle(e,t.center),c.direction=m.getDirection(e,t.center),r.lastCalcEvent=r.futureCalcEvent||t,r.futureCalcEvent=t),t.velocityX=c.velocity.x,t.velocityY=c.velocity.y,t.interimAngle=c.angle,t.interimDirection=c.direction},extendEventData:function(t){var e=this.current,i=e.startEvent,n=e.lastEvent||i;(t.eventType==p||t.eventType==g)&&(i.touches=[],m.each(t.touches,function(t){i.touches.push({clientX:t.clientX,clientY:t.clientY})}));var s=t.timeStamp-i.timeStamp,o=t.center.clientX-i.center.clientX,r=t.center.clientY-i.center.clientY;return this.getCalculatedData(t,n.center,s,o,r),m.extend(t,{startEvent:i,deltaTime:s,deltaX:o,deltaY:r,distance:m.getDistance(i.center,t.center),angle:m.getAngle(i.center,t.center),direction:m.getDirection(i.center,t.center),scale:m.getScale(i.touches,t.touches),rotation:m.getRotation(i.touches,t.touches)}),t},register:function(t){var n=t.defaults||{};return n[t.name]===e&&(n[t.name]=!0),m.extend(i.defaults,n,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}),this.gestures}};i.Instance=function(t,e){var n=this;i.READY||(y.determineEventTypes(),m.each(i.gestures,function(t){P.register(t)}),y.onTouch(i.DOCUMENT,l,P.detect),y.onTouch(i.DOCUMENT,f,P.detect),i.READY=!0),this.element=t,this.enabled=!0,m.each(e,function(t,i){delete e[i],e[m.toCamelCase(i)]=t}),this.options=m.extend(m.extend({},i.defaults),e||{}),this.options.behavior&&m.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=y.onTouch(t,u,function(t){n.enabled&&t.eventType==u?P.startDetect(n,t):t.eventType==p&&P.detect(t)}),this.eventHandlers=[]},i.Instance.prototype={on:function(t,e){var i=this;return y.on(i.element,t,e,function(t){i.eventHandlers.push({gesture:t,handler:e})}),i},off:function(t,e){var i=this;return y.off(i.element,t,e,function(t){var n=m.inArray({gesture:t,handler:e});!1!==n&&i.eventHandlers.splice(n,1)}),i},trigger:function(t,e){e||(e={});var n=i.DOCUMENT.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e;var s=this.element;return m.hasParent(e.target,s)&&(s=e.target),s.dispatchEvent(n),this},enable:function(t){return this.enabled=t,this},dispose:function(){var t,e;for(m.toggleBehavior(this.element,this.options.behavior,!1),t=-1;e=this.eventHandlers[++t];)m.off(this.element,e.gesture,e.handler);return this.eventHandlers=[],y.off(this.element,n[u],this.eventStartHandler),null}},function(t){var e=!1;i.gestures.Drag={name:t,index:50,handler:function(i,n){var h=P.current;if(!(n.options.dragMaxTouches>0&&i.touches.length>n.options.dragMaxTouches))switch(i.eventType){case u:e=!1;break;case l:if(i.distance<n.options.dragMinDistance&&h.name!=t)return;var c=h.startEvent.center;if(h.name!=t&&(h.name=t,n.options.dragDistanceCorrection&&i.distance>0)){var d=Math.abs(n.options.dragMinDistance/i.distance);c.pageX+=i.deltaX*d,c.pageY+=i.deltaY*d,c.clientX+=i.deltaX*d,c.clientY+=i.deltaY*d,i=P.extendEventData(i)}(h.lastEvent.dragLockToAxis||n.options.dragLockToAxis&&n.options.dragLockMinDistance<=i.distance)&&(i.dragLockToAxis=!0);var p=h.lastEvent.direction;i.dragLockToAxis&&p!==i.direction&&(i.direction=m.isVertical(p)?i.deltaY<0?r:s:i.deltaX<0?o:a),e||(n.trigger(t+"start",i),e=!0),n.trigger(t,i),n.trigger(t+i.direction,i);var y=m.isVertical(i.direction);(n.options.dragBlockVertical&&y||n.options.dragBlockHorizontal&&!y)&&i.preventDefault();break;case g:e&&i.changedLength<=n.options.dragMaxTouches&&(n.trigger(t+"end",i),e=!1);break;case f:e=!1}},defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),i.gestures.Gesture={name:"gesture",index:1337,handler:function(t,e){e.trigger(this.name,t)}},function(t){var e;i.gestures.Hold={name:t,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:function(i,n){var s=n.options,o=P.current;switch(i.eventType){case u:clearTimeout(e),o.name=t,e=setTimeout(function(){o&&o.name==t&&n.trigger(t,i)},s.holdTimeout);break;case l:i.distance>s.holdThreshold&&clearTimeout(e);break;case g:clearTimeout(e)}}}}("hold"),i.gestures.Release={name:"release",index:1/0,handler:function(t,e){t.eventType==g&&e.trigger(this.name,t)}},i.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(t,e){if(t.eventType==g){var i=t.touches.length,n=e.options;if(i<n.swipeMinTouches||i>n.swipeMaxTouches)return;(t.velocityX>n.swipeVelocityX||t.velocityY>n.swipeVelocityY)&&(e.trigger(this.name,t),e.trigger(this.name+t.direction,t))}}},function(t){var e=!1;i.gestures.Tap={name:t,index:100,handler:function(i,n){var s,o,r=n.options,a=P.current,h=P.previous;switch(i.eventType){case u:e=!1;break;case l:e=e||i.distance>r.tapMaxDistance;break;case f:"touchcancel"!=i.srcEvent.type&&i.deltaTime<r.tapMaxTime&&!e&&(s=h&&h.lastEvent&&i.timeStamp-h.lastEvent.timeStamp,o=!1,h&&h.name==t&&s&&s<r.doubleTapInterval&&i.distance<r.doubleTapDistance&&(n.trigger("doubletap",i),o=!0),(!o||r.tapAlways)&&(a.name=t,n.trigger(a.name,i)))}},defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),i.gestures.Touch={name:"touch",index:-1/0,defaults:{preventDefault:!1,preventMouse:!1},handler:function(t,e){return e.options.preventMouse&&t.pointerType==h?void t.stopDetect():(e.options.preventDefault&&t.preventDefault(),void(t.eventType==p&&e.trigger("touch",t)))}},function(t){var e=!1;i.gestures.Transform={name:t,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:function(i,n){switch(i.eventType){case u:e=!1;break;case l:if(i.touches.length<2)return;var s=Math.abs(1-i.scale),o=Math.abs(i.rotation);if(s<n.options.transformMinScale&&o<n.options.transformMinRotation)return;P.current.name=t,e||(n.trigger(t+"start",i),e=!0),n.trigger(t,i),o>n.options.transformMinRotation&&n.trigger("rotate",i),s>n.options.transformMinScale&&(n.trigger("pinch",i),n.trigger("pinch"+(i.scale<1?"in":"out"),i));break;case g:e&&i.changedLength<2&&(n.trigger(t+"end",i),e=!1)}}}}("transform"),"function"==typeof define&&define.amd?define(function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:t.Hammer=i}(window),function(){"use strict";var t={};"undefined"==typeof exports?"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t.exports={},define(function(){return t.exports})):t.exports=window:t.exports=exports,function(t){var e={};if(!l)l=1e-6;e.create=function(){return new Float32Array(2)},e.clone=function(t){var e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var i=new Float32Array(2);return i[0]=t,i[1]=e,i},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,i){return t[0]=e,t[1]=i,t},e.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},e.sub=e.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t},e.mul=e.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t},e.div=e.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t},e.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},e.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},e.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},e.dist=e.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},e.sqrDist=e.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n},e.len=e.length=function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},e.sqrLen=e.squaredLength=function(t){var e=t[0],i=t[1];return e*e+i*i},e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.normalize=function(t,e){var i=e[0],n=e[1],s=i*i+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s),t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},e.lerp=function(t,e,i,n){var s=e[0],o=e[1];return t[0]=s+n*(i[0]-s),t[1]=o+n*(i[1]-o),t},e.transformMat2=function(t,e,i){var n=e[0],s=e[1];return t[0]=n*i[0]+s*i[1],t[1]=n*i[2]+s*i[3],t},e.forEach=function(){var t=new Float32Array(2);return function(e,i,n,s,o,r){var a,h;for(i||(i=2),n||(n=0),h=s?Math.min(s*i+n,e.length):e.length,a=n;a<h;a+=i)t[0]=e[a],t[1]=e[a+1],o(t,t,r),e[a]=t[0],e[a+1]=t[1];return e}}(),e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},void 0!==t&&(t.vec2=e);var i={};if(!l)l=1e-6;i.create=function(){return new Float32Array(3)},i.clone=function(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},i.fromValues=function(t,e,i){var n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=i,n},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},i.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},i.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},i.sub=i.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},i.mul=i.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t},i.div=i.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},i.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},i.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},i.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},i.dist=i.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+n*n+s*s)},i.sqrDist=i.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return i*i+n*n+s*s},i.len=i.length=function(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},i.sqrLen=i.squaredLength=function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},i.normalize=function(t,e){var i=e[0],n=e[1],s=e[2],o=i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},i.cross=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=i[0],a=i[1],h=i[2];return t[0]=s*h-o*a,t[1]=o*r-n*h,t[2]=n*a-s*r,t},i.lerp=function(t,e,i,n){var s=e[0],o=e[1],r=e[2];return t[0]=s+n*(i[0]-s),t[1]=o+n*(i[1]-o),t[2]=r+n*(i[2]-r),t},i.transformMat4=function(t,e,i){var n=e[0],s=e[1],o=e[2];return t[0]=i[0]*n+i[4]*s+i[8]*o+i[12],t[1]=i[1]*n+i[5]*s+i[9]*o+i[13],t[2]=i[2]*n+i[6]*s+i[10]*o+i[14],t},i.transformQuat=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=i[0],a=i[1],h=i[2],c=i[3],d=c*n+a*o-h*s,u=c*s+h*n-r*o,l=c*o+r*s-a*n,f=-r*n-a*s-h*o;return t[0]=d*c+f*-r+u*-h-l*-a,t[1]=u*c+f*-a+l*-r-d*-h,t[2]=l*c+f*-h+d*-a-u*-r,t},i.forEach=function(){var t=new Float32Array(3);return function(e,i,n,s,o,r){var a,h;for(i||(i=3),n||(n=0),h=s?Math.min(s*i+n,e.length):e.length,a=n;a<h;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],o(t,t,r),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}(),i.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},void 0!==t&&(t.vec3=i);var n={};if(!l)l=1e-6;n.create=function(){return new Float32Array(4)},n.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},n.fromValues=function(t,e,i,n){var s=new Float32Array(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s},n.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},n.set=function(t,e,i,n,s){return t[0]=e,t[1]=i,t[2]=n,t[3]=s,t},n.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},n.sub=n.subtract=function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t},n.mul=n.multiply=function(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t},n.div=n.divide=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t},n.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},n.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},n.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},n.dist=n.distance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(i*i+n*n+s*s+o*o)},n.sqrDist=n.squaredDistance=function(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],o=e[3]-t[3];return i*i+n*n+s*s+o*o},n.len=n.length=function(t){var e=t[0],i=t[1],n=t[2],s=t[3];return Math.sqrt(e*e+i*i+n*n+s*s)},n.sqrLen=n.squaredLength=function(t){var e=t[0],i=t[1],n=t[2],s=t[3];return e*e+i*i+n*n+s*s},n.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},n.normalize=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=i*i+n*n+s*s+o*o;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r),t},n.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},n.lerp=function(t,e,i,n){var s=e[0],o=e[1],r=e[2],a=e[3];return t[0]=s+n*(i[0]-s),t[1]=o+n*(i[1]-o),t[2]=r+n*(i[2]-r),t[3]=a+n*(i[3]-a),t},n.transformMat4=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3];return t[0]=i[0]*n+i[4]*s+i[8]*o+i[12]*r,t[1]=i[1]*n+i[5]*s+i[9]*o+i[13]*r,t[2]=i[2]*n+i[6]*s+i[10]*o+i[14]*r,t[3]=i[3]*n+i[7]*s+i[11]*o+i[15]*r,t},n.transformQuat=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=i[0],a=i[1],h=i[2],c=i[3],d=c*n+a*o-h*s,u=c*s+h*n-r*o,l=c*o+r*s-a*n,f=-r*n-a*s-h*o;return t[0]=d*c+f*-r+u*-h-l*-a,t[1]=u*c+f*-a+l*-r-d*-h,t[2]=l*c+f*-h+d*-a-u*-r,t},n.forEach=function(){var t=new Float32Array(4);return function(e,i,n,s,o,r){var a,h;for(i||(i=4),n||(n=0),h=s?Math.min(s*i+n,e.length):e.length,a=n;a<h;a+=i)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,r),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),n.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==t&&(t.vec4=n);var s={},o=new Float32Array([1,0,0,1]);if(!l)l=1e-6;s.create=function(){return new Float32Array(o)},s.clone=function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},s.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},s.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},s.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},s.invert=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=i*o-s*n;return r?(r=1/r,t[0]=o*r,t[1]=-n*r,t[2]=-s*r,t[3]=i*r,t):null},s.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},s.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},s.mul=s.multiply=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=i[0],h=i[1],c=i[2],d=i[3];return t[0]=n*a+s*c,t[1]=n*h+s*d,t[2]=o*a+r*c,t[3]=o*h+r*d,t},s.rotate=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+s*a,t[1]=n*-a+s*h,t[2]=o*h+r*a,t[3]=o*-a+r*h,t},s.scale=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=i[0],h=i[1];return t[0]=n*a,t[1]=s*h,t[2]=o*a,t[3]=r*h,t},s.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==t&&(t.mat2=s);var r={},a=new Float32Array([1,0,0,0,1,0,0,0,1]);if(!l)l=1e-6;r.create=function(){return new Float32Array(a)},r.clone=function(t){var e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},r.invert=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=e[4],a=e[5],h=e[6],c=e[7],d=e[8],u=d*r-a*c,l=-d*o+a*h,f=c*o-r*h,g=i*u+n*l+s*f;return g?(g=1/g,t[0]=u*g,t[1]=(-d*n+s*c)*g,t[2]=(a*n-s*r)*g,t[3]=l*g,t[4]=(d*i-s*h)*g,t[5]=(-a*i+s*o)*g,t[6]=f*g,t[7]=(-c*i+n*h)*g,t[8]=(r*i-n*o)*g,t):null},r.adjoint=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=e[4],a=e[5],h=e[6],c=e[7],d=e[8];return t[0]=r*d-a*c,t[1]=s*c-n*d,t[2]=n*a-s*r,t[3]=a*h-o*d,t[4]=i*d-s*h,t[5]=s*o-i*a,t[6]=o*c-r*h,t[7]=n*h-i*c,t[8]=i*r-n*o,t},r.determinant=function(t){var e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],a=t[6],h=t[7],c=t[8];return e*(c*o-r*h)+i*(-c*s+r*a)+n*(h*s-o*a)},r.mul=r.multiply=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=e[4],h=e[5],c=e[6],d=e[7],u=e[8],l=i[0],f=i[1],g=i[2],p=i[3],m=i[4],y=i[5],v=i[6],P=i[7],I=i[8];return t[0]=l*n+f*r+g*c,t[1]=l*s+f*a+g*d,t[2]=l*o+f*h+g*u,t[3]=p*n+m*r+y*c,t[4]=p*s+m*a+y*d,t[5]=p*o+m*h+y*u,t[6]=v*n+P*r+I*c,t[7]=v*s+P*a+I*d,t[8]=v*o+P*h+I*u,t},r.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},void 0!==t&&(t.mat3=r);var h={},c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(!l)l=1e-6;h.create=function(){return new Float32Array(c)},h.clone=function(t){var e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},h.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},h.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],s=e[3],o=e[6],r=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=s,t[13]=r,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},h.invert=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=e[4],a=e[5],h=e[6],c=e[7],d=e[8],u=e[9],l=e[10],f=e[11],g=e[12],p=e[13],m=e[14],y=e[15],v=i*a-n*r,P=i*h-s*r,I=i*c-o*r,w=n*h-s*a,A=n*c-o*a,b=s*c-o*h,W=d*p-u*g,x=d*m-l*g,O=d*y-f*g,L=u*m-l*p,S=u*y-f*p,M=l*y-f*m,R=v*M-P*S+I*L+w*O-A*x+b*W;return R?(R=1/R,t[0]=(a*M-h*S+c*L)*R,t[1]=(s*S-n*M-o*L)*R,t[2]=(p*b-m*A+y*w)*R,t[3]=(l*A-u*b-f*w)*R,t[4]=(h*O-r*M-c*x)*R,t[5]=(i*M-s*O+o*x)*R,t[6]=(m*I-g*b-y*P)*R,t[7]=(d*b-l*I+f*P)*R,t[8]=(r*S-a*O+c*W)*R,t[9]=(n*O-i*S-o*W)*R,t[10]=(g*A-p*I+y*v)*R,t[11]=(u*I-d*A-f*v)*R,t[12]=(a*x-r*L-h*W)*R,t[13]=(i*L-n*x+s*W)*R,t[14]=(p*P-g*w-m*v)*R,t[15]=(d*w-u*P+l*v)*R,t):null},h.adjoint=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=e[4],a=e[5],h=e[6],c=e[7],d=e[8],u=e[9],l=e[10],f=e[11],g=e[12],p=e[13],m=e[14],y=e[15];return t[0]=a*(l*y-f*m)-u*(h*y-c*m)+p*(h*f-c*l),t[1]=-(n*(l*y-f*m)-u*(s*y-o*m)+p*(s*f-o*l)),t[2]=n*(h*y-c*m)-a*(s*y-o*m)+p*(s*c-o*h),t[3]=-(n*(h*f-c*l)-a*(s*f-o*l)+u*(s*c-o*h)),t[4]=-(r*(l*y-f*m)-d*(h*y-c*m)+g*(h*f-c*l)),t[5]=i*(l*y-f*m)-d*(s*y-o*m)+g*(s*f-o*l),t[6]=-(i*(h*y-c*m)-r*(s*y-o*m)+g*(s*c-o*h)),t[7]=i*(h*f-c*l)-r*(s*f-o*l)+d*(s*c-o*h),t[8]=r*(u*y-f*p)-d*(a*y-c*p)+g*(a*f-c*u),t[9]=-(i*(u*y-f*p)-d*(n*y-o*p)+g*(n*f-o*u)),t[10]=i*(a*y-c*p)-r*(n*y-o*p)+g*(n*c-o*a),t[11]=-(i*(a*f-c*u)-r*(n*f-o*u)+d*(n*c-o*a)),t[12]=-(r*(u*m-l*p)-d*(a*m-h*p)+g*(a*l-h*u)),t[13]=i*(u*m-l*p)-d*(n*m-s*p)+g*(n*l-s*u),t[14]=-(i*(a*m-h*p)-r*(n*m-s*p)+g*(n*h-s*a)),t[15]=i*(a*l-h*u)-r*(n*l-s*u)+d*(n*h-s*a),t},h.determinant=function(t){var e=t[0],i=t[1],n=t[2],s=t[3],o=t[4],r=t[5],a=t[6],h=t[7],c=t[8],d=t[9],u=t[10],l=t[11],f=t[12],g=t[13],p=t[14],m=t[15];return(e*r-i*o)*(u*m-l*p)-(e*a-n*o)*(d*m-l*g)+(e*h-s*o)*(d*p-u*g)+(i*a-n*r)*(c*m-l*f)-(i*h-s*r)*(c*p-u*f)+(n*h-s*a)*(c*g-d*f)},h.mul=h.multiply=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=e[4],h=e[5],c=e[6],d=e[7],u=e[8],l=e[9],f=e[10],g=e[11],p=e[12],m=e[13],y=e[14],v=e[15],P=i[0],I=i[1],w=i[2],A=i[3];return t[0]=P*n+I*a+w*u+A*p,t[1]=P*s+I*h+w*l+A*m,t[2]=P*o+I*c+w*f+A*y,t[3]=P*r+I*d+w*g+A*v,P=i[4],I=i[5],w=i[6],A=i[7],t[4]=P*n+I*a+w*u+A*p,t[5]=P*s+I*h+w*l+A*m,t[6]=P*o+I*c+w*f+A*y,t[7]=P*r+I*d+w*g+A*v,P=i[8],I=i[9],w=i[10],A=i[11],t[8]=P*n+I*a+w*u+A*p,t[9]=P*s+I*h+w*l+A*m,t[10]=P*o+I*c+w*f+A*y,t[11]=P*r+I*d+w*g+A*v,P=i[12],I=i[13],w=i[14],A=i[15],t[12]=P*n+I*a+w*u+A*p,t[13]=P*s+I*h+w*l+A*m,t[14]=P*o+I*c+w*f+A*y,t[15]=P*r+I*d+w*g+A*v,t},h.translate=function(t,e,i){var n,s,o,r,a,h,c,d,u,l,f,g,p=i[0],m=i[1],y=i[2];return e===t?(t[12]=e[0]*p+e[4]*m+e[8]*y+e[12],t[13]=e[1]*p+e[5]*m+e[9]*y+e[13],t[14]=e[2]*p+e[6]*m+e[10]*y+e[14],t[15]=e[3]*p+e[7]*m+e[11]*y+e[15]):(n=e[0],s=e[1],o=e[2],r=e[3],a=e[4],h=e[5],c=e[6],d=e[7],u=e[8],l=e[9],f=e[10],g=e[11],t[0]=n,t[1]=s,t[2]=o,t[3]=r,t[4]=a,t[5]=h,t[6]=c,t[7]=d,t[8]=u,t[9]=l,t[10]=f,t[11]=g,t[12]=n*p+a*m+u*y+e[12],t[13]=s*p+h*m+l*y+e[13],t[14]=o*p+c*m+f*y+e[14],t[15]=r*p+d*m+g*y+e[15]),t},h.scale=function(t,e,i){var n=i[0],s=i[1],o=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},h.rotate=function(t,e,i,n){var s,o,r,a,h,c,d,u,f,g,p,m,y,v,P,I,w,A,b,W,x,O,L,S,M=n[0],R=n[1],D=n[2],T=Math.sqrt(M*M+R*R+D*D);return Math.abs(T)<l?null:(T=1/T,M*=T,R*=T,D*=T,s=Math.sin(i),o=Math.cos(i),r=1-o,a=e[0],h=e[1],c=e[2],d=e[3],u=e[4],f=e[5],g=e[6],p=e[7],m=e[8],y=e[9],v=e[10],P=e[11],I=M*M*r+o,w=R*M*r+D*s,A=D*M*r-R*s,b=M*R*r-D*s,W=R*R*r+o,x=D*R*r+M*s,O=M*D*r+R*s,L=R*D*r-M*s,S=D*D*r+o,t[0]=a*I+u*w+m*A,t[1]=h*I+f*w+y*A,t[2]=c*I+g*w+v*A,t[3]=d*I+p*w+P*A,t[4]=a*b+u*W+m*x,t[5]=h*b+f*W+y*x,t[6]=c*b+g*W+v*x,t[7]=d*b+p*W+P*x,t[8]=a*O+u*L+m*S,t[9]=h*O+f*L+y*S,t[10]=c*O+g*L+v*S,t[11]=d*O+p*L+P*S,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},h.rotateX=function(t,e,i){var n=Math.sin(i),s=Math.cos(i),o=e[4],r=e[5],a=e[6],h=e[7],c=e[8],d=e[9],u=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*s+c*n,t[5]=r*s+d*n,t[6]=a*s+u*n,t[7]=h*s+l*n,t[8]=c*s-o*n,t[9]=d*s-r*n,t[10]=u*s-a*n,t[11]=l*s-h*n,t},h.rotateY=function(t,e,i){var n=Math.sin(i),s=Math.cos(i),o=e[0],r=e[1],a=e[2],h=e[3],c=e[8],d=e[9],u=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*s-c*n,t[1]=r*s-d*n,t[2]=a*s-u*n,t[3]=h*s-l*n,t[8]=o*n+c*s,t[9]=r*n+d*s,t[10]=a*n+u*s,t[11]=h*n+l*s,t},h.rotateZ=function(t,e,i){var n=Math.sin(i),s=Math.cos(i),o=e[0],r=e[1],a=e[2],h=e[3],c=e[4],d=e[5],u=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*s+c*n,t[1]=r*s+d*n,t[2]=a*s+u*n,t[3]=h*s+l*n,t[4]=c*s-o*n,t[5]=d*s-r*n,t[6]=u*s-a*n,t[7]=l*s-h*n,t},h.fromRotationTranslation=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=n+n,h=s+s,c=o+o,d=n*a,u=n*h,l=n*c,f=s*h,g=s*c,p=o*c,m=r*a,y=r*h,v=r*c;return t[0]=1-(f+p),t[1]=u+v,t[2]=l-y,t[3]=0,t[4]=u-v,t[5]=1-(d+p),t[6]=g+m,t[7]=0,t[8]=l+y,t[9]=g-m,t[10]=1-(d+f),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},h.frustum=function(t,e,i,n,s,o,r){var a=1/(i-e),h=1/(s-n),c=1/(o-r);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(s+n)*h,t[10]=(r+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=r*o*2*c,t[15]=0,t},h.perspective=function(t,e,i,n,s){var o=1/Math.tan(e/2),r=1/(n-s);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(s+n)*r,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*s*n*r,t[15]=0,t},h.ortho=function(t,e,i,n,s,o,r){var a=1/(e-i),h=1/(n-s),c=1/(o-r);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(s+n)*h,t[14]=(r+o)*c,t[15]=1,t},h.lookAt=function(t,e,i,n){var s,o,r,a,c,d,u,f,g,p,m=e[0],y=e[1],v=e[2],P=n[0],I=n[1],w=n[2],A=i[0],b=i[1],W=i[2];return Math.abs(m-A)<l&&Math.abs(y-b)<l&&Math.abs(v-W)<l?h.identity(t):(u=m-A,f=y-b,g=v-W,p=1/Math.sqrt(u*u+f*f+g*g),u*=p,f*=p,g*=p,s=I*g-w*f,o=w*u-P*g,r=P*f-I*u,(p=Math.sqrt(s*s+o*o+r*r))?(s*=p=1/p,o*=p,r*=p):(s=0,o=0,r=0),a=f*r-g*o,c=g*s-u*r,d=u*o-f*s,(p=Math.sqrt(a*a+c*c+d*d))?(a*=p=1/p,c*=p,d*=p):(a=0,c=0,d=0),t[0]=s,t[1]=a,t[2]=u,t[3]=0,t[4]=o,t[5]=c,t[6]=f,t[7]=0,t[8]=r,t[9]=d,t[10]=g,t[11]=0,t[12]=-(s*m+o*y+r*v),t[13]=-(a*m+c*y+d*v),t[14]=-(u*m+f*y+g*v),t[15]=1,t)},h.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},void 0!==t&&(t.mat4=h);var d={},u=new Float32Array([0,0,0,1]);if(!l)var l=1e-6;d.create=function(){return new Float32Array(u)},d.clone=n.clone,d.fromValues=n.fromValues,d.copy=n.copy,d.set=n.set,d.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},d.setAxisAngle=function(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t},d.add=n.add,d.mul=d.multiply=function(t,e,i){var n=e[0],s=e[1],o=e[2],r=e[3],a=i[0],h=i[1],c=i[2],d=i[3];return t[0]=n*d+r*a+s*c-o*h,t[1]=s*d+r*h+o*a-n*c,t[2]=o*d+r*c+n*h-s*a,t[3]=r*d-n*a-s*h-o*c,t},d.scale=n.scale,d.rotateX=function(t,e,i){i*=.5;var n=e[0],s=e[1],o=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+r*a,t[1]=s*h+o*a,t[2]=o*h-s*a,t[3]=r*h-n*a,t},d.rotateY=function(t,e,i){i*=.5;var n=e[0],s=e[1],o=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h-o*a,t[1]=s*h+r*a,t[2]=o*h+n*a,t[3]=r*h-s*a,t},d.rotateZ=function(t,e,i){i*=.5;var n=e[0],s=e[1],o=e[2],r=e[3],a=Math.sin(i),h=Math.cos(i);return t[0]=n*h+s*a,t[1]=s*h-n*a,t[2]=o*h+r*a,t[3]=r*h-o*a,t},d.calculateW=function(t,e){var i=e[0],n=e[1],s=e[2];return t[0]=i,t[1]=n,t[2]=s,t[3]=-Math.sqrt(Math.abs(1-i*i-n*n-s*s)),t},d.dot=n.dot,d.lerp=n.lerp,d.slerp=function(t,e,i,n){var s,o,r,a,h=e[0],c=e[1],d=e[2],u=e[3],l=i[0],f=i[1],g=i[2],p=e[3],m=h*l+c*f+d*g+u*p;return Math.abs(m)>=1?(t!==e&&(t[0]=h,t[1]=c,t[2]=d,t[3]=u),t):(s=Math.acos(m),o=Math.sqrt(1-m*m),Math.abs(o)<.001?(t[0]=.5*h+.5*l,t[1]=.5*c+.5*f,t[2]=.5*d+.5*g,t[3]=.5*u+.5*p,t):(r=Math.sin((1-n)*s)/o,a=Math.sin(n*s)/o,t[0]=h*r+l*a,t[1]=c*r+f*a,t[2]=d*r+g*a,t[3]=u*r+p*a,t))},d.invert=function(t,e){var i=e[0],n=e[1],s=e[2],o=e[3],r=i*i+n*n+s*s+o*o,a=r?1/r:0;return t[0]=-i*a,t[1]=-n*a,t[2]=-s*a,t[3]=o*a,t},d.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},d.len=d.length=n.length,d.sqrLen=d.squaredLength=n.squaredLength,d.normalize=n.normalize,d.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},void 0!==t&&(t.quat=d)}(t.exports)}();var ArrayUtility=Class.extend({init:function(t){if(t instanceof Object){var e=t;this.data=[];for(var i in e)this.data.push(e[i])}else{if(!(t instanceof Array))throw"Argument objectOrArray must be an object or array";this.data=t}},get:function(){return this.data},sort:function(t){return this.data.sort(function(e,i){return t(e,i)?1:t(i,e)?-1:0}),this.data}}),Color=function(t,e,i,n){this.r=1,this.g=1,this.b=1,this.a=1,this.clone=function(){return new Color(this.r,this.g,this.b,this.a)},this.fromHex=function(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(t);return e&&(this.r=parseInt(e[1],16)/255,this.g=parseInt(e[2],16)/255,this.b=parseInt(e[3],16)/255,e[4]&&(this.a=parseInt(e[4],16)/255)),this},this.toHex=function(){var t=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e};return"#"+t(255*this.r)+t(255*this.g)+t(255*this.b)+t(255*this.a)},this.toString=function(){return"rgba("+Math.floor(255*this.r)+", "+Math.floor(255*this.g)+", "+Math.floor(255*this.b)+", "+this.a+")"},this.toVector=function(){return vec4.fromValues(this.r,this.g,this.b,this.a)},this.set=function(t,e,i,n){"number"==typeof t&&(this.r=t),"number"==typeof e&&(this.g=e),"number"==typeof i&&(this.b=i),"number"==typeof n&&(this.a=n)},this.set(t,e,i,n)},WayfinderAPI={LOCATION:"//api.3dwayfinder.com/",PROJECT:!1,getJSON:function(t,e){Logistics.getJSON(t,e).error(function(t){console&&console.log&&console.log("Failed to get JSON: "+JSON.stringify(t))})},getURL:function(t,e,i){if(!1===WayfinderAPI.PROJECT)throw"No project opened! Call WayfinderAPI.open(<project name>);";return i=i||[],[WayfinderAPI.LOCATION,"public",WayfinderAPI.PROJECT,t,e].concat(i).join("/")},open:function(t){WayfinderAPI.PROJECT=t}};WayfinderAPI["2d"]={},WayfinderAPI["3d"]={},WayfinderAPI.access={},WayfinderAPI.advertisements={},WayfinderAPI.beacons={},WayfinderAPI.building={},WayfinderAPI.guitranslations={},WayfinderAPI.images={},WayfinderAPI.languages={},WayfinderAPI.lights={},WayfinderAPI.locationgroups={},WayfinderAPI.locations={},WayfinderAPI.materials={},WayfinderAPI.mobile={},WayfinderAPI.models={},WayfinderAPI.navigation={},WayfinderAPI.poisettings={},WayfinderAPI.svg={},WayfinderAPI.settings={},WayfinderAPI.statistics={},WayfinderAPI.templates={},WayfinderAPI.textures={},WayfinderAPI["2d"].bundle=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","bundle",[]),t)},WayfinderAPI["2d"].bundle.url=function(){return WayfinderAPI.getURL("2d","bundle",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].edges=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","edges",[]),t)},WayfinderAPI["2d"].edges.url=function(){return WayfinderAPI.getURL("2d","edges",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].getWatermark=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","getWatermark",[]),t)},WayfinderAPI["2d"].getWatermark.url=function(){return WayfinderAPI.getURL("2d","getWatermark",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].image=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","image",[t]),e)},WayfinderAPI["2d"].image.url=function(t){return WayfinderAPI.getURL("2d","image",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].lod=function(t,e,i,n,s){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","lod",[t,e,i,n]),s)},WayfinderAPI["2d"].lod.url=function(t,e,i,n){return WayfinderAPI.getURL("2d","lod",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].lodcount=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","lodcount",[]),t)},WayfinderAPI["2d"].lodcount.url=function(){return WayfinderAPI.getURL("2d","lodcount",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].nodes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","nodes",[]),t)},WayfinderAPI["2d"].nodes.url=function(){return WayfinderAPI.getURL("2d","nodes",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].overlays=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","overlays",[]),t)},WayfinderAPI["2d"].overlays.url=function(){return WayfinderAPI.getURL("2d","overlays",Array.prototype.slice.call(arguments,0))},WayfinderAPI["3d"].getWatermark=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("3d","getWatermark",[]),t)},WayfinderAPI["3d"].getWatermark.url=function(){return WayfinderAPI.getURL("3d","getWatermark",Array.prototype.slice.call(arguments,0))},WayfinderAPI["3d"].scene=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("3d","scene",[]),t)},WayfinderAPI["3d"].scene.url=function(){return WayfinderAPI.getURL("3d","scene",Array.prototype.slice.call(arguments,0))},WayfinderAPI.access.hasWatermark=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("access","hasWatermark",[]),t)},WayfinderAPI.access.hasWatermark.url=function(){return WayfinderAPI.getURL("access","hasWatermark",Array.prototype.slice.call(arguments,0))},WayfinderAPI.access.template=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("access","template",[t]),e)},WayfinderAPI.access.template.url=function(t){return WayfinderAPI.getURL("access","template",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.all=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","all",[]),t)},WayfinderAPI.advertisements.all.url=function(){return WayfinderAPI.getURL("advertisements","all",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.data=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","data",[t]),e)},WayfinderAPI.advertisements.data.url=function(t){return WayfinderAPI.getURL("advertisements","data",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.frames=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","frames",[t,e,i]),n)},WayfinderAPI.advertisements.frames.url=function(t,e,i){return WayfinderAPI.getURL("advertisements","frames",Array.prototype.slice.call(arguments,0))},WayfinderAPI.beacons.getBeacon=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("beacons","getBeacon",[t]),e)},WayfinderAPI.beacons.getBeacon.url=function(t){return WayfinderAPI.getURL("beacons","getBeacon",Array.prototype.slice.call(arguments,0))},WayfinderAPI.beacons.getBeacons=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("beacons","getBeacons",[]),t)},WayfinderAPI.beacons.getBeacons.url=function(){return WayfinderAPI.getURL("beacons","getBeacons",Array.prototype.slice.call(arguments,0))},WayfinderAPI.building.levels=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("building","levels",[]),t)},WayfinderAPI.building.levels.url=function(){return WayfinderAPI.getURL("building","levels",Array.prototype.slice.call(arguments,0))},WayfinderAPI.building.location=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("building","location",[]),t)},WayfinderAPI.building.location.url=function(){return WayfinderAPI.getURL("building","location",Array.prototype.slice.call(arguments,0))},WayfinderAPI.guitranslations.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("guitranslations","get",[]),t)},WayfinderAPI.guitranslations.get.url=function(){return WayfinderAPI.getURL("guitranslations","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.checkImage=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","checkImage",[t]),e)},WayfinderAPI.images.checkImage.url=function(t){return WayfinderAPI.getURL("images","checkImage",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.get=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","get",[t]),e)},WayfinderAPI.images.get.url=function(t){return WayfinderAPI.getURL("images","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.thumbnail=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","thumbnail",[t]),e)},WayfinderAPI.images.thumbnail.url=function(t){return WayfinderAPI.getURL("images","thumbnail",Array.prototype.slice.call(arguments,0))},WayfinderAPI.languages.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("languages","get",[]),t)},WayfinderAPI.languages.get.url=function(){return WayfinderAPI.getURL("languages","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.languages.translation=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("languages","translation",[t]),e)},WayfinderAPI.languages.translation.url=function(t){return WayfinderAPI.getURL("languages","translation",Array.prototype.slice.call(arguments,0))},WayfinderAPI.lights.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("lights","get",[]),t)},WayfinderAPI.lights.get.url=function(){return WayfinderAPI.getURL("lights","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locationgroups.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locationgroups","get",[]),t)},WayfinderAPI.locationgroups.get.url=function(){return WayfinderAPI.getURL("locationgroups","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.byfloor=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","byfloor",[]),t)},WayfinderAPI.locations.byfloor.url=function(){return WayfinderAPI.getURL("locations","byfloor",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.bygroup=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","bygroup",[]),t)},WayfinderAPI.locations.bygroup.url=function(){return WayfinderAPI.getURL("locations","bygroup",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.bynode=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","bynode",[t]),e)},WayfinderAPI.locations.bynode.url=function(t){return WayfinderAPI.getURL("locations","bynode",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","get",[]),t)},WayfinderAPI.locations.get.url=function(){return WayfinderAPI.getURL("locations","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.location=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","location",[t]),e)},WayfinderAPI.locations.location.url=function(t){return WayfinderAPI.getURL("locations","location",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.tags=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","tags",[]),t)},WayfinderAPI.locations.tags.url=function(){return WayfinderAPI.getURL("locations","tags",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","get",[]),t)},WayfinderAPI.materials.get.url=function(){return WayfinderAPI.getURL("materials","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.textureMaterialNames=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","textureMaterialNames",[t]),e)},WayfinderAPI.materials.textureMaterialNames.url=function(t){return WayfinderAPI.getURL("materials","textureMaterialNames",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.textures=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","textures",[t]),e)},WayfinderAPI.materials.textures.url=function(t){return WayfinderAPI.getURL("materials","textures",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.uniforms=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","uniforms",[t]),e)},WayfinderAPI.materials.uniforms.url=function(t){return WayfinderAPI.getURL("materials","uniforms",Array.prototype.slice.call(arguments,0))},WayfinderAPI.mobile.bundle=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("mobile","bundle",[]),t)},WayfinderAPI.mobile.bundle.url=function(){return WayfinderAPI.getURL("mobile","bundle",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.all=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","all",[]),t)},WayfinderAPI.models.all.url=function(){return WayfinderAPI.getURL("models","all",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.allmeshes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","allmeshes",[]),t)},WayfinderAPI.models.allmeshes.url=function(){return WayfinderAPI.getURL("models","allmeshes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","get",[]),t)},WayfinderAPI.models.get.url=function(){return WayfinderAPI.getURL("models","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.instances=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","instances",[]),t)},WayfinderAPI.models.instances.url=function(){return WayfinderAPI.getURL("models","instances",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.json=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","json",[t]),e)},WayfinderAPI.models.json.url=function(t){return WayfinderAPI.getURL("models","json",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshes=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshes",[t]),e)},WayfinderAPI.models.meshes.url=function(t){return WayfinderAPI.getURL("models","meshes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshesOfInstances=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshesOfInstances",[]),t)},WayfinderAPI.models.meshesOfInstances.url=function(){return WayfinderAPI.getURL("models","meshesOfInstances",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshesbyfloor=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshesbyfloor",[]),t)},WayfinderAPI.models.meshesbyfloor.url=function(){return WayfinderAPI.getURL("models","meshesbyfloor",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.model=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","model",[t]),e)},WayfinderAPI.models.model.url=function(t){return WayfinderAPI.getURL("models","model",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.allAttributes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","allAttributes",[]),t)},WayfinderAPI.navigation.allAttributes.url=function(){return WayfinderAPI.getURL("navigation","allAttributes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.attributes=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","attributes",[t]),e)},WayfinderAPI.navigation.attributes.url=function(t){return WayfinderAPI.getURL("navigation","attributes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.edges=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","edges",[]),t)},WayfinderAPI.navigation.edges.url=function(){return WayfinderAPI.getURL("navigation","edges",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.node=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","node",[t]),e)},WayfinderAPI.navigation.node.url=function(t){return WayfinderAPI.getURL("navigation","node",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.nodes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","nodes",[]),t)},WayfinderAPI.navigation.nodes.url=function(){return WayfinderAPI.getURL("navigation","nodes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.nodesbytype=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","nodesbytype",[t]),e)},WayfinderAPI.navigation.nodesbytype.url=function(t){return WayfinderAPI.getURL("navigation","nodesbytype",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","get",[]),t)},WayfinderAPI.poisettings.get.url=function(){return WayfinderAPI.getURL("poisettings","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.getAllPOISettings=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","getAllPOISettings",[]),t)},WayfinderAPI.poisettings.getAllPOISettings.url=function(){return WayfinderAPI.getURL("poisettings","getAllPOISettings",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.getText=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","getText",[t]),e)},WayfinderAPI.poisettings.getText.url=function(t){return WayfinderAPI.getURL("poisettings","getText",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.getTexts=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","getTexts",[]),t)},WayfinderAPI.poisettings.getTexts.url=function(){return WayfinderAPI.getURL("poisettings","getTexts",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","map",[]),t)},WayfinderAPI.poisettings.map.url=function(){return WayfinderAPI.getURL("poisettings","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.setting=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","setting",[t]),e)},WayfinderAPI.poisettings.setting.url=function(t){return WayfinderAPI.getURL("poisettings","setting",Array.prototype.slice.call(arguments,0))},WayfinderAPI.svg.bundle=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("svg","bundle",[]),t)},WayfinderAPI.svg.bundle.url=function(){return WayfinderAPI.getURL("svg","bundle",Array.prototype.slice.call(arguments,0))},WayfinderAPI.svg.get=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("svg","get",[t]),e)},WayfinderAPI.svg.get.url=function(t){return WayfinderAPI.getURL("svg","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","get",[]),t)},WayfinderAPI.settings.get.url=function(){return WayfinderAPI.getURL("settings","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.getText=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","getText",[t]),e)},WayfinderAPI.settings.getText.url=function(t){return WayfinderAPI.getURL("settings","getText",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.getTexts=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","getTexts",[]),t)},WayfinderAPI.settings.getTexts.url=function(){return WayfinderAPI.getURL("settings","getTexts",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","map",[]),t)},WayfinderAPI.settings.map.url=function(){return WayfinderAPI.getURL("settings","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.setting=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","setting",[t]),e)},WayfinderAPI.settings.setting.url=function(t){return WayfinderAPI.getURL("settings","setting",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.click=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","click",[t,e,i]),n)},WayfinderAPI.statistics.click.url=function(t,e,i){return WayfinderAPI.getURL("statistics","click",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.device=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","device",[t,e,i]),n)},WayfinderAPI.statistics.device.url=function(t,e,i){return WayfinderAPI.getURL("statistics","device",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.endSession=function(t,e,i){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","endSession",[t,e]),i)},WayfinderAPI.statistics.endSession.url=function(t,e){return WayfinderAPI.getURL("statistics","endSession",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.search=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","search",[t,e,i]),n)},WayfinderAPI.statistics.search.url=function(t,e,i){return WayfinderAPI.getURL("statistics","search",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.startSession=function(t,e,i,n,s,o){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","startSession",[t,e,i,n,s]),o)},WayfinderAPI.statistics.startSession.url=function(t,e,i,n,s){return WayfinderAPI.getURL("statistics","startSession",Array.prototype.slice.call(arguments,0))},WayfinderAPI.templates.css=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("templates","css",[t]),e)},WayfinderAPI.templates.css.url=function(t){return WayfinderAPI.getURL("templates","css",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.count=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","count",[]),t)},WayfinderAPI.textures.count.url=function(){return WayfinderAPI.getURL("textures","count",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","map",[]),t)},WayfinderAPI.textures.map.url=function(){return WayfinderAPI.getURL("textures","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.mipmap=function(t,e,i){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","mipmap",[t,e]),i)},WayfinderAPI.textures.mipmap.url=function(t,e){return WayfinderAPI.getURL("textures","mipmap",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.names=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","names",[]),t)},WayfinderAPI.textures.names.url=function(){return WayfinderAPI.getURL("textures","names",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.texture=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","texture",[t]),e)},WayfinderAPI.textures.texture.url=function(t){return WayfinderAPI.getURL("textures","texture",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.texturebyid=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","texturebyid",[t]),e)},WayfinderAPI.textures.texturebyid.url=function(t){return WayfinderAPI.getURL("textures","texturebyid",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.thumbnail=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","thumbnail",[t]),e)},WayfinderAPI.textures.thumbnail.url=function(t){return WayfinderAPI.getURL("textures","thumbnail",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.thumbnailbyid=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","thumbnailbyid",[t]),e)},WayfinderAPI.textures.thumbnailbyid.url=function(t){return WayfinderAPI.getURL("textures","thumbnailbyid",Array.prototype.slice.call(arguments,0))};var WayfinderOptions=Class.extend({init:function(){this.application="wayfinder",this.map="map",this.project="demo",this.kiosk=!1,this.debugLog=!1,this.debugPOIs=!1,this.debugTranslations=!1,this.drawKioskIcon=!0,this.apiLocation="../../api/",this.language="en",this.disablePathDrawing=!1,this.searchScroreLimiter=3,this.searchMinimumScrore=10,this.filterPOIs="",this.factory=new WayfinderFactory},loadFromURL:function(){if(location.hash.length>=2&&location.hash.indexOf("{")>-1){var t=unescape(location.hash.substring(1)).split("#");if(t.length>=1&&t[0].indexOf("{")>-1&&t[0].indexOf("}")>-1){i=JSON.parse(t[0]);for(var e in i)console.log("Overriding option: "+e+"="+i[e]),this[e]=i[e],"kiosk"===e&&(this["kiosk.default"]=i[e])}}else if(location.search.length>=2){var i=unescape(location.search.substring(1)).split("&");if(console.log("location.search.1",i),i.length>=1){var n;for(var e in i)(n=i[e].split("=")).length>1&&(console.log("Overriding option: "+n[0]+"="+n[1]),this[n[0]]=n[1],"kiosk"===n[0]&&(this["kiosk.default"]=n[1]))}}}}),WF_DEBUG=!1,Wayfinder=Class.extend({init:function(t,e){t&&t instanceof WayfinderOptions||(t=new WayfinderOptions),e||(e=new WayfinderFactory(this)),this.factory=e,this.setOptions(t),this.settings=new Settings,this.statistics=new WFStatistics(this),this.firstFinishedLoading=!1,this.debugLog=!1,this.kiosk=!1,this.dataLoaded=!1,t.debugLog&&DebugLog&&"DebugLog"==typeof DebugLog&&(this.debugLog=new DebugLog(t.debugLog)),Logistics.onStageProgress(ClassCallback(this,this.onStageProgress)),Logistics.onProgress(ClassCallback(this,this.onProgress)),this.languages={},this.pois={},this.poisArray=[],this.poiGroups={},this.nodes={},this.edges={},this.attributes={},this.poisettings=new Settings,this.poiAdvertisements={},this.advertisements={},this.translator=new Translator(this.options.language,{}),this.building=null,this.firstLanguageChange=!0,this.search=new WayfinderSearch(this),this.events=new WayfinderEvents(this),this.accessibility=""},cbOnPOIClick:function(t){},cbOnDataLoaded:function(){},cbOnProgress:function(t){},cbOnStageProgress:function(t,e){},cbOnLanguageChange:function(t){},cbOnBeforeFloorChange:function(t){},cbOnFloorChange:function(t){},cbOnZoomChange:function(t){},cbOnPathStep:function(t,e){},cbOnPathStart:function(t,e){},cbOnPathFinished:function(t){},cbOnTouch:function(t,e){},cbOnMapUpdate:function(){},cbOnMapReady:function(){},cbOnLocationChange:function(t){},finishedLoading:function(t){this.firstFinishedLoading||(this.firstFinishedLoading=!0,this.onDataLoaded())},setOptions:function(t){this.options=t,this.options.project=this.readProjectName(),this.options.loadFromURL()},setStyle:function(t){$("head").append('<link rel="stylesheet" type="text/css" href="{0}">'.format(WayfinderAPI.templates.css.url(t)))},open:function(t){void 0!==t&&(this.options.project=t),WayfinderAPI.open(this.options.project),this.startLoading(),console.log("Open",this.options.project)},readProjectName:function(){if("undefined"!=typeof document)for(var t=document.location.pathname.split("/"),e=0;e<t.length;e++)if("projects"==t[e]&&t.length>e+1)return t[e+1];return this.options.project},getLayout:function(){if("undefined"!=typeof document){var t=document.getElementsByTagName("meta");for(var e in t)if("layout"==t[e].name)return t[e].content;for(var i=document.location.pathname.split("/"),e=0;e<i.length;e++)if("projects"==i[e]&&i.length>e+2)return i[e+2]}return"default"},log:function(){this.debugLog&&this.debugLog.logArray(this.log.arguments)},getProject:function(){return this.options.project},getAPILocation:function(){return WayfinderAPI&&WayfinderAPI.LOCATION?WayfinderAPI.LOCATION:this.options.apiLocation},setKiosk:function(t){this.options.kiosk=t},getKiosk:function(){return this.options.kiosk},getKioskNode:function(){return!!(this.options.kiosk&&this.options.kiosk in this.nodes)&&this.nodes[this.options.kiosk]},showPath:function(t,e){},showPathFromPOIToPOI:function(t,e){},showKiosk:function(){},showFloor:function(t,e){"object"==typeof t&&this.building.setActiveFloors(t),this.cbOnFloorChange&&"function"==typeof this.cbOnFloorChange&&this.cbOnFloorChange(t)},getLanguage:function(){return this.translator.getLanguage()},setLanguage:function(t){this.translator.translate(t),"function"==typeof this.cbOnLanguageChange&&(this.cbOnLanguageChange(t),this.events.trigger("language-change",t))},startLoading:function(){},onBundleData:function(t){var e=t.data;this.settings.data=e.settings,this.poisettings.data=e.poisettings,this.texts=e.texts,this.onSettings(),e.guitranslations&&this.translator.setTranslations(e.guitranslations),this.factory.createLanguages(e.languages),this.factory.createFloors(e.levels),this.factory.createLocations(e)},onDataCreated:function(){this.finishedLoading()},loadPOIIcons:function(t){if(this.pois){for(var e in this.pois)this.pois[e].image_id&&0!==this.pois[e].image_id&&this.pois[e].alwaysVisible&&Logistics.getImage(WayfinderAPI.getURL("images","get",[this.pois[e].image_id]),null,ClassCallback(this.pois[e],this.pois[e].setIcon),{stage:"locations"})}},loadSecondaryResources:function(){var t=this;setTimeout(function(){t.loadHiddenPOIIcons()},1e3)},loadHiddenPOIIcons:function(t){if(this.pois)for(var e in this.pois)this.pois[e].image_id&&0!==this.pois[e].image_id&&!this.pois[e].alwaysVisible&&Logistics.getImage(WayfinderAPI.getURL("images","thumbnail",[this.pois[e].image_id]),ClassCallback(this.pois[e],this.pois[e].setIcon))},onAdvertisementsLoaded:function(t){this.advertisements=t.data},onSettings:function(){this.building=this.factory.createBuilding(this.settings.data),this.options.language=this.settings.get("language.default",this.options.language),this.setLanguage(this.options.language),!1===this.options.kiosk&&this.setKiosk(this.settings.getInt("kiosk.default",0))},onDataLoaded:function(){this.setKiosk(this.options.kiosk),this.statistics.start(),this.dataLoaded=!0,this.loadSecondaryResources(),this.cbOnProgress(100),this.cbOnDataLoaded();var t=this;setTimeout(function(){t.runDefaultActions()},1e3)},createTranslations:function(t){this.translator&&t&&this.translator.setTranslations(t.data)},onProgress:function(t){"function"==typeof this.cbOnProgress&&this.cbOnProgress(t)},onStageProgress:function(t,e){"function"==typeof this.cbOnStageProgress&&this.cbOnStageProgress(t,e)},resize:function(){if("undefined"!=typeof document){var t=document.getElementById(this.options.map);if(t&&"undefined"!=typeof window){var e=window.getComputedStyle(t.parentNode,null);t.setAttribute("width",e.width),t.setAttribute("height",e.height)}}},onPOIClick:function(t,e,i){"function"==typeof this.cbOnPOIClick&&this.cbOnPOIClick(t)},onZoomChange:function(t){"function"==typeof this.cbOnZoomChange&&this.cbOnZoomChange(t)},setZoom:function(t){},zoomIn:function(){},zoomOut:function(){},pathToText:function(t){},textPathSimplification:function(t){function e(t){return t>=45&&t<135?"right":t>=135&&t<225?"around":t>=225&&t<315&&"left"}var i={},n="generic portal kiosk landmark";if(i.distance=0,i.steps=[],t&&t.length>0){for(var s=!1,o=t[t.length-1].bNode,r=0,a=0;a<t.length;a++)i.distance+=t[a].distance,r+=t[a].distance,s=e(t[a].angle),t[a].type&&"landmark"==t[a].type&&(t[a].bNode&&t[a].bNode.pois&&t[a].bNode.pois.length>0?i.steps.push({landmark:t[a].bNode.pois,endNode:t[a].bNode,startNode:o,in:r}):t[a].aNode&&t[a].aNode.pois&&t[a].aNode.pois.length>0&&i.steps.push({landmark:t[a].aNode.pois,endNode:t[a].aNode,startNode:o,in:r})),s&&("string"==typeof t[a].type&&-1==n.indexOf(t[a].type)||(r>0&&i.steps.push({walk:r/100,endNode:t[a].bNode,startNode:o}),i.steps.push({turn:s,endNode:t[a].bNode,startNode:o,in:r})),o=t[a].bNode,r=0),t[a].type&&-1==n.indexOf(t[a].type)&&(a>0&&a<t.length-1&&t[a].type!==t[a+1].type&&(r>0&&i.steps.push({walk:lastDistanc/100,endNode:t[a].bNode,startNode:o}),i.steps.push({use:t[a].type,endNode:t[a].bNode,startNode:o,in:r}),o=t[a].bNode),r=0),t[a].go_to_floor&&(r>0&&i.steps({walk:r/100,endNode:t[a].bNode,startNode:o}),r=0,i.steps.push({go_to_floor:t[a].go_to_floor,endNode:t[a].bNode,startNode:o}),o=t[a].bNode);r>0&&i.steps.push({walk:r/100,endNode:t[t.length-1].bNode,startNode:o})}return i},getPOIWithExternalId:function(t){for(var e in this.pois)if(this.pois[e].room_id==t)return this.pois[e];return!1},getNearestPOI:function(t,e){},restoreDefaultState:function(){this.options.language&&this.setLanguage(this.options.language),this.clearHighlights(),this.showKiosk()},showScreensaver:function(){},hideScreensaver:function(){},setHighlights:function(t){},clearHighlights:function(){},setDisplaying:function(t){},clearDisplaying:function(){},onSetLanguage:function(t){},getLanguages:function(){return this.languages},getPOIs:function(){return this.pois},getPOIsArray:function(){return this.poisArray},getPOIGroups:function(){return this.poiGroups},getNodes:function(){return this.nodes},getEdges:function(){return this.edges},clearPath:function(){},zoomOnPathSegment:function(t,e){},getCurrentFloor:function(){return this.logic.currentFloor},findNearestNodeOnFloor:function(t,e){},getImageData:function(){return!1},parsePOIFromURLParam:function(t){if("string"==typeof t)if(0===(t=decodeURIComponent(t)).indexOf("poi-"));else if(0===t.indexOf("room-"));else{var e=this.search.search(t);if(console.log("parsePOIFromURLParam.results",e),e&&e.length>0)return e[0]}return!1},runDefaultActions:function(){if(console.log("runDefaultActions",this.options.source,this.options.destination),this.options.source){e=this.parsePOIFromURLParam(this.options.source);if(console.log("a",e),!e)return;this.setDisplaying([e]),this.showFloor(e.node.floor)}if(this.options.destination){var t=this.parsePOIFromURLParam(this.options.destination);if(console.log("b",t),!t)return;if(this.options.source){var e;if(!(e=this.parsePOIFromURLParam(this.options.source)))return;this.showFloor(e.node.floor),this.showPathFromPOIToPOI(e,t)}else this.showPath(t)}}}),WayfinderFactory=Class.extend({init:function(t){this.wayfinder=t},createFloors:function(t){if(t&&this.wayfinder.building)for(var e in t)"object"==typeof t[e]&&this.wayfinder.building.addFloor(this.createFloor(t[e],this.wayfinder.languages))},createNodes:function(t){if(t)for(var e=this.wayfinder.settings.getInt("kiosk.default",0),i=this.wayfinder.building.getFloors(),n=0;n<t.length;n++){var s=this.createNode(t[n]);s&&(this.wayfinder.nodes[t[n].id]=s,s.floor_id in i&&i[s.floor_id].addNode(s),t[n].id==e&&(this.wayfinder.kiosk=s))}},createAttributes:function(t){t&&(this.wayfinder.attributes=t)},createPOIs:function(t){for(var e=0;e<t.length;e++){var i=this.createPOI(t[e],this.wayfinder.languages);this.wayfinder.pois[t[e].id]=i,this.wayfinder.poisArray.push(i),i.node_id in this.wayfinder.nodes&&this.wayfinder.nodes[i.node_id].addPOI(i),this.wayfinder.poisettings&&this.wayfinder.poisettings.data&&this.wayfinder.poisettings.data[i.id]&&(i.settings.data=this.wayfinder.poisettings.data[i.id])}},createTags:function(t){if(t)for(var e in t){var i=t[e],n=this.wayfinder.pois[i.poi_id];n&&n.setTags(i.tags)}},filterPOIs:function(t){if(t&&t.length>0){var e,i="";for(var n in t)if((i=t[n].trim())&&""!==i)for(var s in this.wayfinder.pois)(e=this.wayfinder.pois[s]).setShowInMenu(!1),e.getTags().indexOf(i)>-1&&e.setShowInMenu(!0)}},createGroups:function(t,e){if(e&&t){var i,n;for(n in t)i=this.createPOIGroup(t[n],this.wayfinder.languages),this.wayfinder.poiGroups[i.getID()]=i;for(var s in e){n=e[s];for(var o in n){var r=this.wayfinder.pois[n[o]];i=this.wayfinder.poiGroups[s],r&&i&&(i.addPOI(r),r.addGroup(i))}}}},createAdvertisements:function(t){if(t)for(var e in t){var i=t[e],n=this.wayfinder.pois[i.poi_id];if(n){var s=this.createPOIAdvertisement(n,i,this.wayfinder.languages);this.wayfinder.poiAdvertisements[i.id]=s,n.addAdvertisement(s)}}},addPOIsToFloor:function(t){for(var e in t){var i=this.wayfinder.building.getFloors();if(e in i){var n=i[e];for(var s in t[e])t[e][s]in this.wayfinder.pois&&n.addPOI(this.wayfinder.pois[t[e][s]])}}},createEdges:function(t){this.wayfinder.edges=t},createBuilding:function(t){return new Building(t)},createFloor:function(t,e){return new Floor(t,e)},createNode:function(t){return new NavigationNode(t)},createPOI:function(t,e){return new POI(t,e)},createPOIGroup:function(t,e){return new POIGroup(t,e)},createPOIAdvertisement:function(t,e,i){return new POIAdvertisement(t,e,i)},createLanguages:function(t){for(var e in t)this.wayfinder.languages[e]=new Language(t[e]),e.toLowerCase()==this.wayfinder.options.language.toLowerCase()&&(this.wayfinder.translator.language=e);this.wayfinder.translator.translate()},createLocations:function(t){this.wayfinder.factory.createNodes(t.navigation.nodes),this.wayfinder.factory.createEdges(t.navigation.edges),this.wayfinder.factory.createPOIs(t.locations.all),this.wayfinder.factory.addPOIsToFloor(t.locations.byfloor),this.wayfinder.factory.createGroups(t.locations.groups,t.locations.bygroup),this.wayfinder.factory.createTags(t.locations.tags),this.wayfinder.options.filterPOIs&&this.wayfinder.factory.filterPOIs(this.wayfinder.options.filterPOIs.trim().split(",")),this.wayfinder.advertisements=t.a,Logistics.getJSON(WayfinderAPI.navigation.allAttributes.url(),null,ClassCallback(this.wayfinder.factory,this.wayfinder.factory.createAttributes),{stage:"settings"})}}),WayfinderSearch=Class.extend({init:function(t){this.wayfinder=t,this.searchParams=[],this.limit=0,this.options={maxSearchParams:15,stringSearch:"relative",minimumScore:1,splitKeywords:!0,splitString:!1,limit:1/0,scoreLimit:1.25,searchStringLength:2,poi:{name:1,description:.5,tags:1,room_id:.5}},this.results={},this.highScore=0,this.scores=[],this.providers={},this.setupProviders()},overrideOptions:function(t){for(var e in t)this.options[e]=t[e]},setupProviders:function(){this.providers.poi=ClassCallback(this,this.POIsProvider)},clearResults:function(){this.results={},this.highScore=0,this.scores=[]},search:function(t,e,i){var n="poi";if(this.clearResults(),"string"==typeof e&&(n=e),this.overrideOptions(i),void 0!==t&&t.length>=this.options.searchStringLength){t=t.trim().toLowerCase(),this.options.splitKeywords?this.searchParams=t.split(" "):this.searchParams.push(t),this.searchParams.length>this.options.maxSearchParams&&this.searchParams.splice(this.options.maxSearchParams,this.searchParams.length-this.options.maxSearchParams);this.wayfinder.pois;for(var s=0;s<this.searchParams.length;s++)this.providers[n]&&"function"==typeof this.providers[n]&&this.providers[n](this.searchParams[s],this.wayfinder)}return console.log("results",this.results),this.order(this.results,this.highScore,this.scores)},pushResult:function(t,e,i){t>=this.options.minimumScore&&(t=parseFloat(parseFloat(t).toFixed(2)),this.results[t]||(this.results[t]={}),-1==this.scores.indexOf(t)&&this.scores.push(t),this.results[t][e]=i,this.highScore=Math.max(this.highScore,t))},POIsProvider:function(t,e){function i(t,e){var i=0;return s.options.poi.name&&t.getName(n)&&(i=s.searchString(t.getName(n),e,s.options.poi.name)),s.options.poi.description&&t.getDescription(n)&&(i=Math.max(i,s.searchString(t.getDescription(n),e,s.options.poi.description))),s.options.poi.tags&&t.getTags()&&(i=Math.max(i,s.searchString(t.getTags(),e,s.options.poi.tags))),s.options.poi.room_id&&t.getRoomId()&&(i=Math.max(i,s.searchString(t.getRoomId(),e,s.options.poi.room_id))),i}var n=this.wayfinder.getLanguage(),s=this,o=e.pois;for(var r in o)o[r].getShowInMenu()&&(score=i(o[r],t),this.pushResult(score,o[r].getID(),o[r]))},findWithChar:function(t){var e=[],i=this.wayfinder.getLanguage();e[0]=[];var n=this.sortPOIs(this.wayfinder.pois);for(var s in n)n[s].getShowInMenu()&&n[s].getName(i).charAt(0)==t&&e[0].push(n[s])},searchString:function(t,e,i){if("string"==typeof t&&"string"==typeof e)switch(t=t.toLowerCase().trim(),e=e.toLowerCase().trim(),this.options.stringSearch){case"strict":return this.searchStringStrict(t,e,i);case"relative":return this.searchStringRelatively(t,e,i);default:return this.searchStringStrict(t,e,i)}return 0},searchStringStrict:function(t,e,i){if(!t||!e)return 0;var n=e.indexOf(t);if(n>-1){return((n=n/t.length*100)+e.length/t.length*100)/2}return 0},searchStringRelatively:function(t,e,i){function n(t,e,i){for(var n=0,s=0,o=0,r=-1,a=0;a<t.length;a++)r==t[a]-1?(s++,n=Math.max(n,s)):(o+=t[a]-r-1,s=1),r=t[a];var h=n/i.length*1.4;return h+=0===t[0]?2:0,h+=1-o/i.length,h+=t.length/e,h+=n/e*1.2,h+=e>i.length?0:t.length/i.length*1.3,10*(h+=e.length==i.length?1:0)}if(!t||!e)return 0;var s=e.split(""),o=[t];this.options.splitString&&(o=t.split(/,\s*|\s/));var r=0,a=0,h=[],c=-1,d=0;i||(i=1);for(var u=0;u<o.length;u++)if((t=o[u]).length>1){for(;a<t.length;){if(t[a]===s[r]){if(d=a,h.push(a),++r>=s.length)break}else a==t.length-1&&r<s.length&&(a=d,r++);a++}h.length>0?c+=n(h,s.length,t):c=Math.max(c,-1),r=0,a=0,h.length=0}return console.log("searchStringRelatively",t,"*",e,c),c=Math.round(c*i)},order:function(t,e,i){if(!t||0==t.length)return[];var n,s=[],o=0,r=i.sort(function(t,e){return t-e}).reverse();for(var a in r)if(n=r[a],t[n]){var h;for(var a in t[n]){if(h=t[n][parseInt(a)],e/n>this.options.scoreLimit&&o>0)return s;if(s.push(h),o++,this.options.limit>0&&o>this.options.limit)return s}}return s}}),WayfinderEvents=Class.extend({init:function(){this.events={"map-click":[],"language-change":[]}},listen:function(t,e){"object"!=typeof this.events[t]&&(this.events[t]=[]),this.events[t].push(e)},trigger:function(){var t=Array.prototype.slice.call(arguments);if(t.length>0){var e=t[0];if(t.shift(),this.events[e])for(var i,n=0,s=this.events[e].length;n<s;n++)"function"==typeof(i=this.events[e][n])&&i.apply(this,t)}}}),Building=Class.extend({init:function(t,e){this.name=t["building.name"],this.address=t["building.address"],this.link=new Translations(t["building.link"]),this.description=new Translations(t["building.description"]),this.logoID=t["building.logo"],this.backgroundID=t["building.background"],this.floors={}},addFloor:function(t){this.floors[t.id]=t},removeFloor:function(t){delete this.floors[t.id]},getFloors:function(){return this.floors},getSortedFloors:function(){return new ArrayUtility(this.floors).sort(function(t,e){return t.index<e.index})},setActiveFloors:function(t){if("object"==typeof t){var e;for(var i in this.floors)"object"==typeof(e=this.floors[i])&&e.setActive&&e.setActive(!1);t.setActive(!0)}}}),Settings=Class.extend({init:function(){this.data={}},has:function(t){return t in this.data},get:function(t,e,i){return i&&i.settings.data&&i.settings.data[t]?i.settings.data[t].value:t in this.data?this.data[t]:e},getInt:function(t,e,i){return parseInt(this.get(t,e,i))},getFloat:function(t,e,i){return parseFloat(this.get(t,e,i))},getColor:function(t,e,i){return(new Color).fromHex(this.get(t,e,i))},getBoolean:function(t,e,i){return!0===this.get(t,e,i)},getModel:function(t,e,i){var n=this.getInt(t,0,i);return 0===n?e:n},set:function(t,e){this.data[t]=e},override:function(t){for(var e in t)this.data[e]=t[e]}}),NavigationNode=Class.extend({init:function(t){this.id=t.id,this.floor_id=t.level_id,this.type=t.type,this.position=vec3.fromValues(-parseFloat(t.x),parseFloat(t.y),parseFloat(t.z)),this.rotation=vec3.fromValues(parseFloat(t.rotation_x),parseFloat(t.rotation_y),parseFloat(t.rotation_z)),this.floor=!1,this.pois=[],this.weight=0,t.weight&&(this.weight=parseFloat(t.weight)),this.zoom=0,t.zoom&&(this.zoom=parseFloat(t.zoom))},setFloor:function(t){t instanceof Floor&&t.id==this.floor_id&&(this.floor=t)},addPOI:function(t){t instanceof POI&&t.node_id==this.id&&(t.setNode(this),this.pois.push(t))},getID:function(){return this.id},getFloor:function(){return this.floor},getPOIs:function(){return this.pois}}),Floor=Class.extend({init:function(t,e){this.id=parseInt(t.id,10),this.name_id=parseInt(t.name_id,10),this.model_id=parseInt(t.model_id,10),this.index=parseInt(t.index,10),this.y=parseFloat(t.y,10),this.lightmap_id=parseInt(t.lightmap_id,10),this.showInMenu=0!==parseInt(t.show_in_menu,10),this.names=new Translations,this.active=!1,this.svg=t.svg;for(var i in e)this.names.set(i,t[i]);this.pois=[],this.nodes=[]},getID:function(){return this.id},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},addPOI:function(t){t instanceof POI&&(t.setFloor(this),this.pois.push(t))},addNode:function(t){t instanceof NavigationNode&&t.floor_id==this.id&&(t.setFloor(this),this.nodes.push(t))},getPOIs:function(){return this.pois},getNodes:function(){return this.nodes},getShowInMenu:function(){return this.showInMenu},setActive:function(t){this.active=t},getActive:function(){return this.active}}),POI=Class.extend({init:function(t,e){this.id=parseInt(t.id),this.type=t.type,this.node_id=parseInt(t.node_id),this.mesh_id=parseInt(t.mesh_id),this.room_id=t.room_id,this.image_id=parseInt(t.image_id),this.icon=null,this.background_id=parseInt(t.background_id),this.background=null,this.showInMenu=0!=parseInt(t.show_in_menu),this.alwaysVisible=0!=parseInt(t.always_visible),this.mesh_name=t.mesh_name,this.settings={},this.names=new Translations,this.descriptions=new Translations,this.hasName=!1;for(var i in e)this.names.set(i,t["names_"+i]),this.descriptions.set(i,t["descriptions_"+i]),this.names.get(i).length>0&&(this.hasName=!0);this.floor=!1,this.node=!1,this.groups=[],this.advertisements=[],this.groupNames={},this.tags=""},getID:function(){return this.id},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},getDescription:function(t){return this.descriptions.get(t)},getDescriptions:function(){return this.descriptions},getShowInMenu:function(){return this.showInMenu&&this.hasName},setShowInMenu:function(t){this.showInMenu=t},setFloor:function(t){t instanceof Floor&&(this.floor=t)},getFloor:function(){return this.floor},setNode:function(t){t instanceof NavigationNode&&(this.node=t)},getNode:function(){return this.node},addGroup:function(t){this.groups.push(t)},getGroups:function(){return this.groups},getGroupNames:function(){if(this.groupNames[n])return this.groupNames[n];var t={};for(var e in this.groups)if("object"==typeof this.groups[e]){var i=this.groups[e].getNames();for(var n in i.getAll())t[n]||(t[n]=[]),t[n].push(i.get(n))}return this.groupNames[n]=t,t},addAdvertisement:function(t){this.advertisements.push(t)},getAdvertisements:function(){return this.advertisements},getTags:function(){return this.tags},setTags:function(t){this.tags=t},setIcon:function(t){this.icon=t},getIcon:function(){return this.icon},setBackground:function(t){this.background=t},getBackground:function(){return this.background},getRoomId:function(){return this.room_id},isAlwaysVisible:function(){return this.alwaysVisible}}),POIAdvertisement=Class.extend({init:function(t,e,i){this.id=e.id,this.image_id=e.image_id,this.text1={},this.text2={},this.link={},this.poi=t;for(var n in i)this.link[n]=e["link_"+n],e["text1_"+n]?this.text1[n]=e["text1_"+n]:this.text1[n]=e["menu_"+n],e["text2_"+n]?this.text2[n]=e["text2_"+n]:this.text2[n]=e["3d_"+n]},getID:function(){return this.id},getPOI:function(){return this.poi},getText1:function(t){return t in this.text1&&this.text1[t]},getText2:function(t){return t in this.text2&&this.text2[t]},getLink:function(t){return t in this.link&&this.link[t]}}),POIGroup=Class.extend({init:function(t,e){this.id=t.group_id,this.names=new Translations,this.imageID=t.image_id;for(var i in e)this.names.set(i,t[i]);this.pois=[],this.showInMenu=t.show_main,this.showInTopMenu=t.show_top,this.color=(new Color).fromHex(t.color),this.parent_id=t.parent_id},getID:function(){return this.id},getNames:function(){return this.names},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},getShowInMenu:function(){return 0!=this.showInMenu},getShowInTopMenu:function(){return 0!=this.showInTopMenu},getImageID:function(){return this.imageID},addPOI:function(t){this.pois.push(t)},getPOIs:function(){return this.pois},getColor:function(){return this.color}}),Logistics=function(){var t=!1;"undefined"!=typeof window&&(t="localStorage"in window&&null!==window.localStorage);var e=[],i=[],n={},s=0,o=!1,r=null,a=null,h=null,c=null,d={loadFromLocalStorage:!1,storeToLocalStorage:!1,loadFromFile:!1,enableCORS:!0,useCookies:!1,fallbackFromStorage:!0,urlParseFunction:null},u={text:{load:function(t){P(t)},parse:function(t,e){t.data=e.responseText},store:function(t){return t.data},restore:function(t,e){return e}},json:{load:function(t){P(t)},parse:function(t,e){try{t.data=JSON.parse(e.responseText)}catch(e){"undefined"!=typeof console&&console.error&&console.error("JSON parsing failed for "+t.url,e)}},store:function(t){return JSON.stringify(t.data)},restore:function(t,e){return e?JSON.parse(e):{}}},xml:{load:function(t){P(t)},parse:function(t,e){e.responseXML?t.data=e.responseXML:t.data=I(e.responseText)},store:function(t){return XMLSerializer?(new XMLSerializer).serializeToString(t.data):""},restore:function(t,e){return I(e)}},image:{load:function(t){t&&(t.data=new Image,t.useCORS&&(t.data.crossOrigin="Anonymous"),t.data.onload=function(){t.ready()},t.data.onerror=function(){t.failed()},t.data.src=t.url)},parse:function(t){},store:function(t){var e=document.createElement("canvas");e.width=t.data.width,e.height=t.data.height;e.getContext("2d").drawImage(t.data,0,0);var i=e.toDataURL("image/png");return e=null,i},restore:function(t,e){var i=new Image;return i.src=e,i}},binary:{load:function(t){P(t)},parse:function(t,e){t.data=e.response},store:function(t){for(var e="",i=new Uint8Array(t.data),n=i.byteLength,s=0;s<n;s++)e+=String.fromCharCode(i[s]);return window.btoa(e)},restore:function(t,e){for(var i=new ArrayBuffer(2*e.length),n=new Uint16Array(i),s=0,o=e.length;s<o;s++)n[s]=e.charCodeAt(s);return i}}},l=function(t,i,n,o,r){var a="GET";"function"==typeof i?(r=n,n=i,i=void 0):i&&"object"==typeof i&&(a="POST"),"function"==typeof d.urlParseFunction&&(t=d.urlParseFunction(t));var h=new function(t,e,i,n,o,r){this.url=t,this.params=e,this.success=i,this.dataType=n,this.loaded=!1,this.data=!1,this.requestType=o,this.useCORS=!1,this.options=r||{},this.successCallback=i,this.errorCallback=!1,this.alwaysCallback=!1,this.progressCallback=!1,this.setOption=function(t,e){this.options[t]=e},this.getOption=function(t){return this.options[t]},this.ready=function(){this.loaded=!0,s++,W(this),O(this)},this.failed=function(){s++,O(this),x(this)},this.done=function(t){this.successCallback=t},this.fail=function(t){this.errorCallback=t},this.error=function(t){this.errorCallback=t},this.always=function(t){this.alwaysCallback=t},this.progress=function(t){this.progressCallback=t},this.toString=function(){return this.data}}(t,i,n,o,a,r);return d.enableCORS&&(h.useCORS=f(t)),h&&(e.push(h),g(h)),h},f=function(t){if("undefined"==typeof document)return!1;var e=t.match(/(https?:)?\/\/([^\/]+)\/(.*)/);return!!e&&(!document||e[1]!==document.location.origin)},g=function(t){return p(t),!0},p=function(t){!function(t){if(t){var e=t.getOption("stage");e&&("object"!=typeof n[e]&&(n[e]=[]),n[e].push(t))}}(t),d.loadFromLocalStorage&&m(t)?y(t):v(t.dataType,"load")(t)},m=function(e){return!(!t||null===localStorage.getItem(e.url))},y=function(t){t.data=v(t.dataType,"restore")(t,b(t)),t.ready()},v=function(t,e){return u&&u[t]&&u[t][e]?u[t][e]:u&&u[t]?u[t]:function(){"undefined"!=typeof console&&console.warn&&console.warn("Method "+e+" for "+t+" not found")}},P=function(t){var e=w(t);if(!e||!t)throw"http failed";var i=t.url,n=null;if(e.open(t.requestType,i,!0),e.overrideMimeType&&e.overrideMimeType("text/xml"),"binary"==t.dataType&&(e.responseType="arraybuffer",t.useCORS&&e.setRequestHeader("Content-Type","application/x-3dtechdata")),"default"==t.dataType&&(e.responseType="arraybuffer",t.useCORS&&e.setRequestHeader("Content-Type","application/octet-stream")),t.options.headers){console.log("dt.headers",t);for(var s in t.options.headers)console.log("h",s,t.options.headers[s]),e.setRequestHeader(s,t.options.headers[s])}if(t.params){n=new FormData;for(var o in t.params)n.append(o,t.params[o])}t.useCORS&&d.useCookies&&(e.withCredentials=!0),e.onreadystatechange=function(){if(4==e.readyState){var i=e.status;200==i||0==i||300==i?(v(t.dataType,"parse")(t,e),t.ready()):t.failed()}else"function"==typeof t.progressCallback&&t.progressCallback(e)},e.ontimeout=function(){t.failed()},e.onerror=function(){t.failed()},O(t),e.send(n)},I=function(t){var e=null;if(!t||"string"!=typeof t)return e;if(window&&window.DOMParser){e=(new DOMParser).parseFromString(t,"text/xml")}else(e=new ActiveXObject("Microsoft.XMLDOM")).async=!1,e.loadXML(t);if(!e||e.getElementsByTagName("parsererror").length)throw"XML parsing failed";return e},w=function(t){var e=!1;if(t.useCORS&&window&&window.XDomainRequest)try{e=new XDomainRequest}catch(t){e=!1}else if(XMLHttpRequest)try{e=new XMLHttpRequest}catch(t){e=!1}else if("undefined"!=typeof ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP"),alert(2)}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP"),alert(3)}catch(t){e=!1}}return e},A=function(e){if(t)try{localStorage[e.url]=v(e.dataType,"store")(e)}catch(t){console.warn("localStorage limit exceeded")}else console.warn("localStorage isn't supported")},b=function(t){return localStorage[t.url]},W=function(t){t&&"function"==typeof t.successCallback&&(t.successCallback(t.data,"success",t),S()),t&&d.storeToLocalStorage&&A(t)},x=function(t){if(t&&d.fallbackFromStorage&&m(t))y(t);else{if(!t||"function"!=typeof t.errorCallback)throw"Resource "+t.url+" not loaded";t.errorCallback(t,"error",""),S()}},O=function(t){a&&"function"==typeof a&&e.length&&s&&a(s/e.length),t&&t.getOption("stage")&&L(t)},L=function(t){if(h&&"function"==typeof h){for(var e=n[t.getOption("stage")],i=e.length,s=0,o=0;o<i;o++)e[o]&&e[o].loaded&&s++;i>0&&h(t.getOption("stage"),s/i)}},S=function(){null===c&&(c=setTimeout(M,5))},M=function(){c=null,e.length==s&&r&&"function"==typeof r&&r()},R=function(t,e){return function(){return e.apply(t,arguments)}};return{count:function(){return e.length},loadedCount:function(){return s},clear:function(){e=[],i=[],s=0,o=!1},get:function(t,e,i,n,s){return l(t,e,i,toLowerCase(n),s)},getJSON:function(t,e,i,n){return l(t,e,i,"json",n)},getImage:function(t,e,i,n){return l(t,e,i,"image",n)},getBinary:function(t,e,i,n){return l(t,e,i,"binary",n)},getXML:function(t,e,i,n){return l(t,e,i,"xml",n)},getText:function(t,e,i,n){return l(t,e,i,"text",n)},getMultiple:function(t,e,n){!function(t,e,n){var s=new function(t,e,i){this.urls=t,this.results={},this.loadedCount=0,this.count=0,this.successCallback=e,i=i||{},this.load=function(){var t=null,e=null;for(var n in this.urls)this.urls.hasOwnProperty(n)&&this.count++;for(var s in this.urls)if((e=this.urls[s])&&e.url&&e.type)try{(t=l(e.url,void 0,R(this,this.ready,s),e.type,JSON.parse(JSON.stringify(i)))).setOption("logistics.multi.key",s),t.fail(R(this,this.fail))}catch(t){this.fail()}},this.ready=function(t,e,i){var n=i.getOption("logistics.multi.key");this.results[n]=t,this.loadedCount++,this.checkIfAllReady()},this.fail=function(t){this.loadedCount++,this.checkIfAllReady()},this.getKeyForURL=function(t){},this.checkIfAllReady=function(){this.loadedCount>=this.count&&"function"==typeof this.successCallback&&this.successCallback(this.results)}}(t,e,n);i.push(s),s.load()}(t,e,n)},store:function(){!function(){if(t)for(var i in e)A(e[i]);else console.warn("localStorage isn't supported")}()},clearStorage:function(){localStorage.clear()},types:function(){return u},onFinishedLoading:function(t){r=t},onProgress:function(t){a=t},onStageProgress:function(t){h=t},getQueue:function(){return e},getTypeFunction:function(t,e){return v(t,e)},setTypeFunction:function(t,e){return function(t,e){t&&e&&(u[t]=e)}(t,e)},getOption:function(t){return function(t){return d[t]}(t)},setOption:function(t,e){!function(t,e){d[t]=e}(t,e)},start:function(){return start()}}}(),Language=Class.extend({init:function(t){this.name=t.name,this.id=t.id,this.nativeName=t.native,this.textDirection=t.text_direction?t.text_direction.toLowerCase():"ltr",this.flagImage=t.flag,console.log("language:",this)},getName:function(){return this.name},getID:function(){return this.id},getNativeName:function(){return this.nativeName},getTextDirection:function(){return this.textDirection}}),Translator=Class.extend({init:function(t,e){this.language=t,this.translations=e},setTranslations:function(t){this.translations=t},setLanguage:function(t){this.language=t},getLanguage:function(){return this.language},_isJQueryObject:function(t){return"undefined"!=typeof jQuery&&t instanceof jQuery},get:function(t,e){if(this.translations&&t&&this.translations[t]&&this.translations[t][this.language]){var i=this.translations[t][this.language];return e&&(i=this.replaceValues(i,e)),i}return t},translate:function(t){if(t&&(this.language=t),"undefined"!=typeof document&&document.querySelectorAll){for(var e=document.querySelectorAll("[data-translation-element]"),i=0;i<e.length;i++)this.translateElement(e[i],e[i].getAttribute("data-translation-element"));for(var e=document.querySelectorAll("[data-translation-attributes]"),i=0;i<e.length;i++)for(var n=e[i].getAttribute("data-translation-attributes").split(","),s="",o=0;o<n.length;o++)s=e[i].getAttribute("data-translation-attribute-"+n[o]),e[i]&&s&&e[i].setAttribute(n[o],this.get(s))}},setElement:function(t,e){t&&e&&(this._isJQueryObject(t)&&(t=t[0]),t.setAttribute("data-translation-element",e))},setAttribute:function(t,e,i){if(t&&i&&e){this._isJQueryObject(t)&&(t=t[0]);var n=[];t.getAttribute("data-translation-attributes")&&(n=t.getAttribute("data-translation-attributes").split(",")),n.push(e),t.setAttribute("data-translation-attributes",n.join(",")),t.setAttribute("data-translation-attribute-"+e,i)}},translateElement:function(t,e,i){if(t)if(this._isJQueryObject(t)&&(t=t[0]),e&&this.exists(e)){var n=this.get(e,i);this.setElement(t,e),t.innerHTML=n}else t.classList&&t.classList.add("no-translation")},translateAttribute:function(t,e,i,n){if(t&&e&&i){this._isJQueryObject(t)&&(t=t[0]);var s=this.get(i,n);this.setAttribute(t,e,i),t.setAttribute(e,s),!this.exists(i)&&t.classList&&t.classList.add("no-translation")}},replaceValues:function(t,e){if(t&&e){var i=0;for(var n in e)t=t.replace("%"+i++,e[n])}return t},exists:function(t){return!!(this.translations&&t&&this.translations[t]&&this.translations[t][this.language])}}),Translations=Class.extend({init:function(t){this.translations=t||{}},set:function(t,e){this.translations[t]=e},get:function(t){return!!this.translations[t]&&this.translations[t]},setAll:function(t){this.translations=t},getAll:function(){return this.translations},setTranslations:function(t,e){if(t&&e){for(var i in this.translations)t.attr("data-lang-"+i,this.translations[i]);this.translations[e]?t.html(this.translations[e]):t.html("no translation"),t.attr("data-translated",!0)}}}),TranslationsMap=Class.extend({init:function(){this.translations={}},add:function(t,e){if(!(e instanceof Translations))throw"Only Translation instances can be added to translations map";this.translations[t]=e},get:function(t){return this.translations[t]?this.translations[t]:new Translations({english:"--missing--"})}}),WFStatistics=Class.extend({init:function(t){this.wayfinder=t,this.session_id=0,this.storageSupport="undefined"!=typeof window&&"localStorage"in window&&null!==window.localStorage,this.storagePrefix="wfstats_",this.device_id=0,this.searchPhrase="",this.checkStorage()},start:function(){var t=this;"undefined"!=typeof screen&&WayfinderAPI.statistics.device(screen.width,screen.height,this.wayfinder.getKiosk(),function(e){e&&(t.device_id=e.data.id,t.store("deviceId",e.data.id),console.log("Device created",e))})},onSessionStart:function(){var t=this,e=this.wayfinder.languages[this.wayfinder.getLanguage()];e&&e.getID()&&this.wayfinder.getKiosk()&&WayfinderAPI.statistics.startSession(e.getID(),this.wayfinder.getKiosk(),this.wayfinder.options.application,this.wayfinder.getLayout(),this.device_id,function(e){try{e&&(t.session_id=e.data)}catch(t){console.log("Something went wrong sending startSession")}})},onSessionEnd:function(){var t=this;if(this.session_id){var e=this.wayfinder.languages[this.wayfinder.getLanguage()];WayfinderAPI.statistics.endSession(this.session_id,e.getID(),function(){t.session_id=0,console.log("Session ended!")})}},onClick:function(t,e){WayfinderAPI.statistics.click(t,this.session_id,e)},onLanguageChange:function(t){},onSearch:function(t,e){WayfinderAPI.statistics.search(t,this.session_id,e)},checkStorage:function(){this.storageSupport&&(this.deviceId=localStorage.getItem(this.storagePrefix+"deviceId"))},getTime:function(){},store:function(t,e){this.storageSupport&&(localStorage[this.storagePrefix+t]=JSON.stringify(e))},isOnline:function(){}}),Wayfinder2DLogic=Class.extend({init:function(t){this.wayfinder=t,this.currentFloor=!1},setCurrentFloor:function(t){this.currentFloor=t,this.wayfinder.map.setCurrentFloor(t)},setDefaultView:function(t){this.wayfinder.pathComponent&&this.wayfinder.pathComponent.clearPath(),this.setKioskView(t)},setNodeView:function(t,e,i){}}),WayfinderFactory2D=WayfinderFactory.extend({createOverlays:function(t){if(t){var e,i;for(e in t)if(e in this.wayfinder.pois){this.wayfinder.overlays[e]||(this.wayfinder.overlays[e]=[]);for(i in t[e])this.wayfinder.overlays[e].push(new Overlay(this.wayfinder.pois[e],t[e][i],this.wayfinder.options.map2DRotation))}}},addNode2DData:function(t){if(this.wayfinder.nodes)for(var e in this.wayfinder.nodes){var i=this.wayfinder.nodes[e];if(t[i.floor_id]){var n=t[i.floor_id][i.id];n&&(i.setPosition2D(n.x,n.y),i.setWeight(n.weight))}}},createEdges:function(t){if(t)for(var e in t)if(e in this.wayfinder.nodes)for(var i in t[e])t[e][i]in this.wayfinder.nodes&&this.wayfinder.nodes[e].addNeighbour(this.wayfinder.nodes[t[e][i]])},createNode:function(t){return new NavigationNode2D(t)}}),Wayfinder2D=Wayfinder.extend({init:function(t,e){t&&t instanceof Wayfinder2DOptions||(t=new Wayfinder2DOptions),this._super(t,new WayfinderFactory2D(this)),this.logic=new Wayfinder2DLogic(this),this.overlays={},this.adImage=!1,this.yahImage=!1,this.paused=!1,this.path=!1,e&&(this.canvas=e)},open:function(t){this._super(t),this.setup()},startLoading:function(){Logistics.getJSON(WayfinderAPI["2d"].bundle.url(),null,ClassCallback(this,this.onBundleData),{stage:"settings"})},setup:function(){this.canvas||(this.canvas=document.getElementById(this.options.map)),this.map=new Map2D(this),this.map.onPOIClick=ClassCallback(this,this.onPOIClick),this.map.getTransformer().cbOnZoomChange=ClassCallback(this,this.onZoomChange)},isCanvasSupported:function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},onBundleData:function(t){var e=this;this._super(t);var i=t.data;this.factory.addNode2DData(i["2d"].nodes),this.factory.createOverlays(i["2d"].overlays),this.options.maxLOD=parseInt(i["2d"].lodcount)-1;var n=this.settings.getInt("kiosk.you-are-here-image",0),s=0!==n?WayfinderAPI.getURL("images","get",[n]):"images/yah.png";Logistics.getImage(s,function(t,i){e.yahImage=t}),this.loadMapImages(),this.loadPOIIcons(),this.onDataLoaded()},showPath:function(t,e){if(!1!==this.getKiosk()&&!1!==t){var i=new PathFinder2D(this.nodes);if(this.path=i.find(this.getKiosk(),t.id),!1!==this.path){var n=this;return this.settings.getBoolean("camera.2d.disableMap2DMovement",!1)||this.settings.getBoolean("camera.2d.disableZooming",!1)||this.map.fitPathInView(this.path),this.map.pathRenderer.reset(),this.map.setCurrentFloor(this.getKioskNode().floor),this.map.redraw(),this.map.pathRenderer.setPath(this.path,function(){e&&(n.clearHighlights(),n.clearDisplaying(),n.setHighlights([e]),n.setDisplaying([e])),n.map.redraw(),"function"==typeof n.cbOnPathFinished&&n.cbOnPathFinished(n.path,t,e)}),this.path}}},showPathFromPOIToPOI:function(t,e){if("object"==typeof t&&"object"==typeof e){var i=new PathFinder2D(this.nodes);if(this.path=i.find(t.node.id,e.node.id),!1!==this.path){var n=this;return this.settings.getBoolean("camera.2d.disableMap2DMovement",!1)||this.settings.getBoolean("camera.2d.disableZooming",!1)||this.map.fitPathInView(this.path),this.map.pathRenderer.reset(),this.map.setCurrentFloor(t.node.floor),this.map.redraw(),this.map.pathRenderer.setPath(this.path,function(){e&&(n.clearHighlights(),n.clearDisplaying(),n.setHighlights([e]),n.setDisplaying([e])),n.map.redraw(),"function"==typeof n.cbOnPathFinished&&n.cbOnPathFinished(n.path,e.node,e)}),this.path}}},updatePath:function(t,e,i){if(!1!==this.getKiosk()&&!1!==e){var n=new PathFinder2D(this.nodes);if(this.path=n.find(t.id,e.id),!1!==this.path){var s=this;return this.map.pathRenderer.reset(),this.map.redraw(),this.map.pathRenderer.updatePath(this.path,function(){i&&(s.clearHighlights(),s.setHighlights([i])),s.map.redraw(),"function"==typeof s.cbOnPathFinished&&s.cbOnPathFinished(s.path,e,i)}),this.path}console.log("updatePath","No path found",t,e)}},getNearestPOIs:function(t,e,i){for(var n,s,o=new PathFinder2D(this.nodes),r=[],a=0,h=e.length;a<h;a++)if((s=e[a])&&s.node&&s.node.position2d){if(i&&vec2.dist(t.position2d,s.node.position2d)>=i)continue;(n=o.find(t.id,s.node.id))?i>=n.getDistance()&&r.push(s):console.log("No path for",s)}return r},showFloor:function(t){this._super(t),this.logic.setCurrentFloor(t)},onSettings:function(){this._super(),this.overrideOptions(),this.map.setup()},onDataLoaded:function(){if(this._super(),this.cbOnDataLoaded&&"function"==typeof this.cbOnDataLoaded&&this.cbOnDataLoaded(),this.padding=this.settings.getInt("path.2d.padding",this.options.pathZoomPadding),this.resize(),this.setupFloor(),this.map.currentFloorID)if(this.settings.getBoolean("camera.2d.disablezooming",!1))this.showKiosk();else{var t=this.building.getFloors()[this.map.currentFloorID];"object"==typeof t&&this.map.fitMultiplePOIsInView(t.pois)}this.cbOnMapReady&&"function"==typeof this.cbOnMapReady&&this.cbOnMapReady(),"undefined"!=typeof document&&document.addEventListener("visibilitychange",ClassCallback(this,this.onVisibilityChange)),this.map.start(),this.map.update(!0),this.showKiosk()},onPOIsLoaded:function(t){this._super(t),Logistics.getMultiple({nodes_2d:{url:WayfinderAPI.getURL("2d","nodes",[]),type:"json"},overlays:{url:WayfinderAPI.getURL("2d","overlays",[]),type:"json"},location:{url:WayfinderAPI.getURL("building","location",[]),type:"json"},lodcount:{url:WayfinderAPI.getURL("2d","lodcount",[]),type:"json"},"ad-image":{url:"images/ad.png",type:"image"},"yah-image":{url:"images/yah.png",type:"image"}},ClassCallback(this,this.on2DDataLoaded),{stage:"settings"}),this.loadMapImages()},on2DDataLoaded:function(t){var e=t.nodes_2d.data,i=t.overlays.data;this.adImage=t["ad-image"],this.yahImage=this.settings.getInt("kiosk.you-are-here-image",0)?this.settings.getInt("kiosk.you-are-here-image",0):t["yah-image"],this.options.maxLOD=parseInt(t.lodcount.data)-1,this.factory.addNode2DData(e),this.factory.createOverlays(i),this.map.update(!0),this.onDataLoaded()},overrideOptions:function(){this.options.disableMap2DMovement=this.settings.getBoolean("camera.2d.disableMap2DMovement",!1)},setupFloor:function(){var t=!1;if(this.getKioskNode()&&this.getKioskNode().floor)t=this.getKioskNode().floor;else{var e=0;for(var i in this.building.getFloors())(t=this.building.getFloors()[i]).index>=e&&(e=t.index)}t&&(this.map.currentFloorID=t,this.showFloor(t))},loadMapImages:function(){var t,e=this,i=function(t,i,n){e.map.addLODImage(n.params.floor_id,0,0,0,t)};for(var n in this.building.getFloors())t=this.building.getFloors()[n],Logistics.getImage(WayfinderAPI.getURL("2d","image",[t.id]),{floor_id:t.id},i,{stage:"floors"})},resize:function(){if(this._super(),this.map){var t=1;if(this.options.upscale>0){var e=this.map.renderer.context,i=window.devicePixelRatio||1,n=this.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;t=Math.max(this.options.upscale,i/n)}this.map.resize(this.canvas.width*t,this.canvas.height*t,t),this.map.redraw()}},setZoom:function(t){this.map.setZoom(t),this.map.update(!0)},zoomIn:function(){this.map.zoomIn(),this.map.update(!0)},zoomOut:function(){this.map.zoomOut(),this.map.update(!0)},setHighlights:function(t){this.map.setHighlights(t),this.map.update(!0)},clearHighlights:function(){this.map.clearHighlights(),this.map.update(!0)},clearDisplaying:function(){this.map.clearDisplaying(),this.map.update(!0)},setDisplaying:function(t){this.map.setDisplaying(t),this.map.update(!0)},showKiosk:function(){!1!==this.getKiosk()&&(this.map.pathRenderer.reset(),this.map.setCurrentFloor(this.getKioskNode().floor),this.map.currentFloorID&&(this.settings.getBoolean("camera.2d.disableZooming",!1)?this.setZoom(0):this.map.fitMultiplePOIsInView(this.building.getFloors()[this.map.currentFloorID].pois)),"function"==typeof this.cbOnFloorChange&&this.cbOnFloorChange(this.getKioskNode().floor),this.map.redraw())},clearPath:function(){this.map.pathRenderer.clearPath(),this.map.pathRenderer.reset(),this.map.update(!0)},setLanguage:function(t){this._super(t),this.map.update(!0)},switchCanvas:function(t){this.canvas=t,this.map.updateCanvas(this.canvas),this.resize(),this.map.update(!0)},findNearestNodeOnFloor:function(t,e,i){return this.map.findNearestNodeOnFloor(t,e,i)},pause:function(){this.paused=!0},run:function(){this.paused=!1},onVisibilityChange:function(){"undefined"!=typeof document&&document.hidden?this.pause():this.run()}}),Wayfinder2DOptions=WayfinderOptions.extend({init:function(){this._super(),this.pathDisplayInstructions=!0,this.pathZoomPadding=50,this.pathColor="rgba(255,0,0,0.8)",this.pathPauseTime=2e3,this.pathSpotRadius=3,this.pathStride=10,this.pathSpeed=60,this.poiColor="rgba(100,100,100,0.5)",this.poiRadius=5,this.mapSize=[1024,1024],this.forceFullMapUpdate=!1,this.enableLOD=!0,this.maxLOD=2,this.enableUserLocation=!0,this.overlayHighlightColor="#ff0000dd",this.mapPadding=.1,this.enableUserYAHSetting=!1,this.application="2D",this.pathZoomIn=!1,this.poi2DTitlePadding=12,this.path2DMessageSize=16,this.map2DRotation=0,this.disableMap2DMovement=!1,this.debug=!1,this.debugBeacons=!1,this.debugMouseLocation=!1,this.upscale=1,this.yahRotation=0,this.poi2DTitleWeight="normal"}}),NavigationNode2D=NavigationNode.extend({init:function(t){this._super(t),this.position2d=!1,this.weight=!1,this.neighbours=[]},setPosition2D:function(t,e){this.position2d=vec2.fromValues(parseFloat(t),parseFloat(e))},setWeight:function(t){this.weight=parseFloat(t)},addNeighbour:function(t){t instanceof NavigationNode2D&&this.neighbours.push(t)}}),Overlay=Class.extend({init:function(t,e,i){this.visible="1"==e.visible,this.polygon=this.createPolygon(e.polygon),this.poi=t,this.rotate=i||0,this.bounds=this.calculateBounds(this.polygon,0),this.rotatedAreaBounds=this.calculateRotatedAreaBounds(this.polygon)},createPolygon:function(t){var e=[];if(t)for(var i=0;i<t.length;i++)t[i]&&t[i].x&&t[i].y&&e.push(vec2.fromValues(t[i].x,t[i].y));return e},contains:function(t){var e,i,n=!1;for(e=0,i=this.polygon.length-1;e<this.polygon.length;i=e++)this.polygon[e][1]>t[1]!=this.polygon[i][1]>t[1]&&t[0]<(this.polygon[i][0]-this.polygon[e][0])*(t[1]-this.polygon[e][1])/(this.polygon[i][1]-this.polygon[e][1])+this.polygon[e][0]&&(n=!n);return n},calculateBounds:function(t,e){if(!t)return!1;for(var i,n=1/0,s=1/0,o=-1/0,r=-1/0,a=0;a<t.length;a++)i=t[a],e&&(i=this.rotatePoint(i,e)),n=Math.min(n,i[0]),s=Math.min(s,i[1]),o=Math.max(o,i[0]),r=Math.max(r,i[1]);return i=this.rotatePoint(vec2.fromValues(n,s),-e),[i[0],i[1],o-n,r-s,o,r]},calculateArea:function(t){var e,i,n,s,o=0;for(e=0,i=t.length-1;e<t.length;i=e,e++)n=t[e],s=t[i],o+=n[0]*s[1],o-=n[1]*s[0];return o/=2},calculateCenter:function(t){for(var e=vec2.create(),i=0;i<t.length;i++)vec2.add(e,e,t[i]);return vec2.divide(e,e,vec2.fromValues(t.length,t.length))},calculateRotatedAreaBounds:function(t,e){var i,n,s,o,r,a,h,c,d,u,l,f,g,p,m,y,v,P,I,w,A,b,W,x,O,L,S,M,R,D,T,C,N,U,F,z,E,_,V,H,Z,J,B,q,X,j;if("array"==typeof t&&t.length<3)return null;if([],.5,5,null==e&&(e={}),e.maxAspectRatio=15,e.minWidth=0,e.minHeight=0,e.tolerance=3,e.nTries=20,r=[-90,-30,0,30,90],0===Math.abs(this.calculateArea(t)))return null;if(A=this.bounds[4]-this.bounds[2],b=this.bounds[5]-this.bounds[3],y=this.bounds[4],v=this.bounds[5],J=Math.min(y-A,v-b)*e.tolerance,Z=function(){var e,i,n;for(n=[],e=0,i=t.length;e<i;e++)S=t[e],n.push({x:S[0],y:S[1]});return n}(),J>0&&(Z=this.findConvexHull(Z,J),t=function(){var t,e,i;for(i=[],t=0,e=Z.length;t<e;t++)S=Z[t],i.push([S[0],S[1]]);return i}()),[[A,b],[y,b],[y,v],[A,v]],h=Math.abs(y-A),a=Math.abs(v-b),q=Math.min(h,a)/50,!L){L=[],c=this.calculateCenter(t),this.pointInPoly(c,t)&&L.push(c);for(var Y=0;L.length<e.nTries;)if(V=Math.random()*h+A,H=Math.random()*a+b,_=[V,H],this.pointInPoly(_,t)&&L.push(_),++Y>15e3)return console.log("Failed to find bounds",t.length,this.poi.getName("en")),!1}l=0,p=null;for(var K=0,Q=r.length;K<Q;K++){o=-(s=r[K])*Math.PI/180;for(var G=k=0,$=L.length;k<$;G=++k){x=L[G],R=(N=this.intersectPoints(t,x,o))[0],T=N[1],M=(U=this.intersectPoints(t,x,o+Math.PI/2))[0],D=U[1],W=[],null!=R&&null!=T&&W.push([(R[0]+T[0])/2,(R[1]+T[1])/2]),null!=M&&null!=D&&W.push([(M[0]+D[0])/2,(M[1]+D[1])/2]);for(var tt=0,et=W.length;tt<et;tt++)if(O=W[tt],F=this.intersectPoints(t,O,o),R=F[0],T=F[1],null!==R&&null!==T&&(w=Math.min(this.squaredDist(O,R),this.squaredDist(O,T)),m=2*Math.sqrt(w),z=this.intersectPoints(t,O,o+Math.PI/2),M=z[0],D=z[1],null!==M&&null!==D&&(I=Math.min(this.squaredDist(O,M),this.squaredDist(O,D)),g=2*Math.sqrt(I),!(m*g<l)))){P=Math.max(1,e.minWidth/g,l/(g*g)),f=Math.min(e.maxAspectRatio,m/e.minHeight,m*m/l),n=[];for(G=P;G<f+.5;G+=.5)n.push(G);for(var it=0,nt=n.length;it<nt;it++)if(i=n[it],u=Math.max(e.minWidth,Math.sqrt(l*i)),!((E=Math.min(m,g*i))*g<l))for(;E-u>=q;)d=(B=(u+E)/2)/i,C=[[(X=O[0])-B/2,(j=O[1])-d/2],[X+B/2,j-d/2],[X+B/2,j+d/2],[X-B/2,j+d/2]],C=this.rotatePoly(C,o,O),this.polyInsidePoly(C,t)?(!0,l=B*d,p={cx:X,cy:j,width:B,height:d,angle:s},u=B):(!1,E=B)}}}return!!p&&{angle:-p.angle*Math.PI/180,bounds:{width:p.width,height:p.height},center:[p.cx,p.cy]}},squaredDist:function(t,e){var i,n;return i=e[0]-t[0],n=e[1]-t[1],i*i+n*n},rayIntersectsSegment:function(t,e,i){var n,s,o,r;return r=e[1]<i[1]?[e,i]:[i,e],n=r[0],s=r[1],t[1]!==s[1]&&t[1]!==n[1]||(t[1]+=Number.MIN_VALUE),!(t[1]>s[1]||t[1]<n[1])&&(!(t[0]>n[0]&&t[0]>s[0])&&(t[0]<n[0]&&t[0]<s[0]||(o=(s[1]-n[1])/(s[0]-n[0]),(t[1]-n[1])/(t[0]-n[0])>o)))},pointInPoly:function(t,e){var i,n,s,o,r;for(o=-1,n=e[(r=e.length)-1],s=0;++o<r;)i=n,n=e[o],this.rayIntersectsSegment(t,i,n)&&s++;return s%2!=0},pointInSegmentBox:function(t,e,i){var n,s;return 1e-9,n=t[0],s=t[1],!(n<Math.min(e[0],i[0])-1e-9||n>Math.max(e[0],i[0])+1e-9||s<Math.min(e[1],i[1])-1e-9||s>Math.max(e[1],i[1])+1e-9)},lineIntersection:function(t,e,i,n){var s,o,r,a,h,c,d,u,l;return 1e-9,a=t[0]-e[0],c=t[1]-e[1],h=i[0]-n[0],d=i[1]-n[1],r=a*d-c*h,Math.abs(r)<1e-9?null:(s=t[0]*e[1]-t[1]*e[0],o=i[0]*n[1]-i[1]*n[0],u=(s*h-o*a)/r,l=(s*d-o*c)/r,[u,l])},segmentsIntersect:function(t,e,i,n){var s;return null!=(s=this.lineIntersection(t,e,i,n))&&this.pointInSegmentBox(s,t,e)&&this.pointInSegmentBox(s,i,n)},polyInsidePoly:function(t,e){var i,n,s,o,r,a,h,c;for(r=-1,h=t.length,c=e.length,s=t[h-1];++r<h;)for(i=s,s=t[r],a=-1,o=e[c-1];++a<c;)if(n=o,o=e[a],this.segmentsIntersect(i,s,n,o))return!1;return this.pointInPoly(t[0],e)},rotatePoint:function(t,e,i){var n,s,o,r;return null==i&&(i=[0,0]),o=t[0]-i[0],r=t[1]-i[1],n=Math.cos(e),s=Math.sin(e),[n*o-s*r+i[0],s*o+n*r+i[1]]},rotatePoly:function(t,e,i){var n,s,o,r;for(r=[],n=0,s=t.length;n<s;n++)o=t[n],r.push(this.rotatePoint(o,e,i));return r},intersectPoints:function(t,e,i){var n,s,o,r,a,h,c,d,u,l,f,g,p,m;for(1e-9,p=(e=[e[0]+1e-9*Math.cos(i),e[1]+1e-9*Math.sin(i)])[0],m=e[1],f=[p+Math.cos(i),m+Math.sin(i)],h=0,Math.abs(f[0]-p)<1e-9&&(h=1),a=-1,s=t[(u=t.length)-1],c=Number.MAX_VALUE,d=Number.MAX_VALUE,o=null,r=null;++a<u;)n=s,s=t[a],null!=(l=this.lineIntersection(e,f,n,s))&&this.pointInSegmentBox(l,n,s)&&(g=this.squaredDist(e,l),l[h]<e[h]?g<c&&(c=g,o=l):l[h]>e[h]&&g<d&&(d=g,r=l));return[o,r]},findConvexHull:function(){var t,e=[],i=0;if(this.polygon.length>0){for(var n=this.polygon[0],s=1;s<this.polygon.length;s++)this.polygon[s][0]<n[0]&&(n=this.polygon[s]);var o=this.polygon;do{i++,e.push(n),t=o[0];for(var r=1;r<o.length;r++)n!=t&&-1!=this.getOrientation(n,t,o[r])||(t=o[r]);if(i>1e3){console.log("Hull finding is ending to infinity loop!",this.poi);break}n=t}while(e[0]!==t)}return e},getOrientation:function(t,e,i){var n=(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]);return n>0?-1:n<0?1:0},getBounds:function(){return this.bounds},getRotatedAreaBounds:function(){return this.rotatedAreaBounds}}),Renderer2D=Class.extend({init:function(t){this.wayfinder=!1,this.context=!1,this.enabled=!0,this.damaged=!0,this.renderQueue=t},onAdd:function(){},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},damage:function(){this.damaged=!0},undamage:function(){this.damaged=!1},setContext:function(t){this.context=t},setWayfinder:function(t){this.wayfinder=t},render:function(t){}}),FloorRenderer2D=Renderer2D.extend({init:function(){this._super(1),this.lod=0,this.debugPoint=vec2.create(),this.mapImages=[]},setLOD:function(t){this.lod=t},getLOD:function(){return lod},getRequiredTiles:function(t){for(var e=[],i=Math.pow(2,this.lod),n=this.wayfinder.options.mapSize[0]/i,s=this.wayfinder.options.mapSize[1]/i,o=0;o<i;o++)for(var r=0;r<i;r++){var a=new Rectangle(o*n,r*s,n,s);t.intersects(a)&&e.push(vec2.fromValues(o,r))}return e},clear:function(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)},renderDefault:function(){var t=this.wayfinder.map.getTransformer(),e=this.wayfinder.map.getCurrentLOD(0,0,0);e&&(this.context.save(),this.clear(),this.context.translate(t.getViewWidth()/2,t.getViewHeight()/2),this.context.rotate(this.wayfinder.options.map2DRotation*Math.PI/180),this.context.translate(-t.getViewWidth()/2,-t.getViewHeight()/2),this.context.translate(t.getZoomedMapPosition()[0],t.getZoomedMapPosition()[1]),this.context.scale(t.getZoom(),t.getZoom()),this.context.drawImage(e,0,0),this.context.restore())},renderTile:function(t){if(!1!==t.image){var e=this.wayfinder.map.getTransformer(),i=Math.pow(2,this.lod),n=this.wayfinder.options.mapSize[0]/i,s=this.wayfinder.options.mapSize[1]/i;this.context.save(),this.context.translate(e.getViewWidth()/2,e.getViewHeight()/2),this.context.rotate(this.wayfinder.options.map2DRotation*Math.PI/180),this.context.translate(-e.getViewWidth()/2,-e.getViewHeight()/2),this.context.translate(e.getZoomedMapPosition()[0],e.getZoomedMapPosition()[1]),this.context.drawImage(t.image,t.x*n*e.getZoom(),t.y*s*e.getZoom(),n*e.getZoom(),s*e.getZoom()),this.context.restore()}},render:function(t){if(0!==this.wayfinder.map.currentFloorID){var e=this.wayfinder.map.getTransformer();if(0!==this.lod&&this.wayfinder.options.enableLOD){for(var i=[],n=this.getRequiredTiles(t),s=!1,o=0;o<n.length;o++){var r=this.wayfinder.map.getCurrentLOD(this.lod,n[o][0],n[o][1]);i.push({x:n[o][0],y:n[o][1],image:r}),!1===r&&(s=!0)}for(s&&this.renderDefault(),this.clear(),o=0;o<n.length;o++)this.renderTile(i[o])}else this.renderDefault();if(this.wayfinder.options.debugMouseLocation){this.context.save();var a=e.transformPoint(this.debugPoint);this.context.beginPath(),this.context.fillStyle="rgba(255,0,0,0.7)",this.context.arc(a[0],a[1],5,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.restore()}}}}),POIsRenderer2D=Renderer2D.extend({init:function(){this._super(4)},onAdd:function(){this.overlayColor=this.wayfinder.settings.getColor("poi.2d.overlay.color",this.wayfinder.options.overlayHighlightColor),this.drawAlwaysNames=this.wayfinder.settings.getBoolean("poi.2d.display-names-always",!1),this.overlayColorFromGroup=this.wayfinder.settings.getBoolean("poi.2d.overlay-group-color",!1),this.fitToOverlay=this.wayfinder.settings.getBoolean("poi.2d.fit-to-overlay",!1),this.nameColor=this.wayfinder.settings.getColor("poi.2d.name.color","#000000"),this.nameBackgroundColor=this.wayfinder.settings.getColor("poi.2d.name.background-color","#ffffff"),this.nameFontSize=this.wayfinder.settings.getInt("poi.2d.name.font-size",12),this.nameFontFamily=this.wayfinder.settings.get("poi.2d.name.font-family","Arial"),this.displayRoomID=this.wayfinder.settings.get("poi.2d.name.display-room-id",!0),this.fontPadding=this.wayfinder.settings.getInt("poi.2d.name.padding",this.wayfinder.options.poi2DTitlePadding)},render:function(t){var e=this.wayfinder.map.getCurrentFloor();if(e){var i=this.wayfinder.map.getTransformer();this.context.save();for(var n=0;n<e.nodes.length;n++)if(0!==e.nodes[n].pois.length){var s=!1,o=!1,r=i.transformPoint(e.nodes[n].position2d),a=!1;if(r[0]>=0&&r[0]<=i.getViewWidth()&&r[1]>=0&&r[1]<=i.getViewHeight()){for(var h=0;h<e.nodes[n].pois.length;h++){if((a=e.nodes[n].pois[h]).id in this.wayfinder.overlays&&this.isPOIinHighlights(a)){var c=this.wayfinder.overlays[a.id];if(c&&0<c.length){s=!0;for(var d in c)this.renderPOIOverlay(c[d])}}if(a.getAdvertisements().length>0){o=!0;break}a.alwaysVisible||this.isPOIinDisplaying(a)?0!==a.image_id?(this.renderPOIIcon(a,r),s=!0):a.hasName&&(this.renderPOIName(a,r),s=!0):this.drawAlwaysNames&&a.showInMenu&&(this.renderPOIName(a,r),s=!0)}s||a.showInMenu||(this.context.beginPath(),this.context.fillStyle=this.wayfinder.options.poiColor,this.context.arc(r[0],r[1],this.wayfinder.options.poiRadius,0,2*Math.PI,!0),this.context.closePath(),this.context.fill()),this.wayfinder.adImage&&o&&this.context.drawImage(this.wayfinder.adImage,r[0]-1.5*this.wayfinder.options.poiRadius,r[1]-1.5*this.wayfinder.options.poiRadius,3*this.wayfinder.options.poiRadius,3*this.wayfinder.options.poiRadius)}}this.context.restore()}},isPOIinHighlights:function(t){for(var e in this.wayfinder.map.highlights)if(this.wayfinder.map.highlights[e]==t)return!0;return!1},isPOIinDisplaying:function(t){for(var e in this.wayfinder.map.displaying)if(this.wayfinder.map.displaying[e]===t)return!0;return!1},renderPOIOverlay:function(t){if(t&&(t.visible||this.isPOIinHighlights(t.poi))&&t.polygon&&t.polygon.length>3){var e=this.wayfinder.map.getTransformer(),i=t.poi,n=null;if(i&&i.getGroups()){var s=i.getGroups()[0];s&&s.getColor()&&(n=s.getColor().toString())}this.overlayColorFromGroup&&n?this.context.fillStyle=n:this.context.fillStyle=this.overlayColor.toString();var o=e.transformPoint(t.polygon[0]);this.context.beginPath(),this.context.moveTo(o[0],o[1]);for(var r=0;r<t.polygon.length;r++)o=e.transformPoint(t.polygon[r]),this.context.lineTo(o[0],o[1]);this.context.closePath(),this.context.fill()}},renderPOIIcon:function(t,e){if(t&&t.getIcon()){var i=this.wayfinder.map.getTransformer(),n=this.wayfinder.overlays[t.id],s=t.getIcon().height/t.getIcon().width,o=(this.context,this.wayfinder.settings.getInt("poi.2d.icon-size",this.wayfinder.options.poiRadius,t)*i.getZoom()),r=this.wayfinder.settings.getInt("poi.2d.icon-size",this.wayfinder.options.poiRadius,t)*i.getZoom(),a=0;if(n&&0<n.length){var h=n[0].getRotatedAreaBounds();if(h){var c=h.bounds.width*i.getZoom(),d=h.bounds.height*i.getZoom();e=i.transformPoint(h.center),(c<o||d<r)&&(o=d<c?c*(d/o)*.9:.9*c,0!==this.wayfinder.options.map2DRotation&&this.wayfinder.options.map2DRotation<180?a=this.wayfinder.options.map2DRotation*(Math.PI/180)-Math.abs(h.angle):this.wayfinder.options.map2DRotation>=180&&(a=this.wayfinder.options.map2DRotation*(Math.PI/180)-Math.abs(h.angle)-Math.PI))}}this.isPOIinHighlights(t)&&(o*=1.1);r=o*s;this.context.save(),this.context.rotate(a),e=i.rotatePoint(e,-a),this.context.drawImage(t.getIcon(),e[0]-o/2,e[1]-r/2,Math.round(o),Math.round(r)),this.context.restore()}},renderPOIName:function(t,e){var i=t.getName(this.wayfinder.getLanguage()),n=this.wayfinder.settings.get("poi.2d.name.weight",this.wayfinder.options.poi2DTitleWeight,t);if("string"==typeof i){var s=this.wayfinder.map.getTransformer(),o=Math.floor(this.nameFontSize*s.getZoom());this.context.font=n+" "+o+"px "+this.nameFontFamily,this.context.textAlign="center";var r=this.wayfinder.overlays[t.id],a=this.context.measureText(i).width,h=o,c=0*o,d=this.wayfinder.settings.getInt("poi.text.wrap",-1,t),u=[i.replace("&shy;","")],l=0;if(d>-1){u=this.getLines(i,d),a=0,h=0;for(P=0;P<u.length;P++)a=Math.max(a,this.context.measureText(u[P]).width),h+=o+c}if(this.context.save(),r&&0<r.length){var f=r[0].getRotatedAreaBounds();if(f){var g=Math.abs(f.bounds.width),p=Math.abs(f.bounds.height),m=g*s.getZoom()-this.fontPadding,y=p*s.getZoom()-this.fontPadding;if(a>g&&1.3*g<p&&(0===(l=f.angle)&&(l+=Math.PI/2),m=g*s.getZoom()-this.fontPadding,y=p*s.getZoom()-this.fontPadding),e=s.transformPoint(f.center),m<a){l=f.angle;var v=m/a;o=Math.floor(o*v)}y<h&&(o=Math.floor(y-this.fontPadding)/u.length)}}else o=Math.max(6,Math.floor(o));0!==this.wayfinder.options.map2DRotation&&(l=this.wayfinder.options.map2DRotation*(Math.PI/180)-Math.abs(l)),a=0,h=0,this.context.textBaseline="middle",this.context.font=n+" "+o+"px "+this.nameFontFamily;for(var P=0;P<u.length;P++)a=Math.max(a,this.context.measureText(u[P]).width),h+=o+c;metrics=this.context.measureText(i);var I=a+10,w=h+10;this.context.rotate(l),e=s.rotatePoint(e,-l);var A=1==u.length?0:h/2-o/2;if(o>6){this.nameBackgroundColor.a>0&&this.roundedRect(this.context,e[0]-I/2,e[1]-w/2,I,w,5,this.nameBackgroundColor.toString()),this.context.fillStyle=this.nameColor.toString();for(var b=0;b<u.length;b++)this.context.fillText(u[b],e[0],e[1]-A),A-=o+c}this.context.restore()}},measureText:function(){},roundedRect:function(t,e,i,n,s,o,r){t.beginPath(),t.moveTo(e,i+o),t.lineTo(e,i+s-o),t.quadraticCurveTo(e,i+s,e+o,i+s),t.lineTo(e+n-o,i+s),t.quadraticCurveTo(e+n,i+s,e+n,i+s-o),t.lineTo(e+n,i+o),t.quadraticCurveTo(e+n,i,e+n-o,i),t.lineTo(e+o,i),t.quadraticCurveTo(e,i,e,i+o),t.fillStyle=r,t.fill()},renderRotatedAreaBounds:function(t,e,i,n){var s=this.wayfinder.map.getTransformer(),o=s.transformPoint(e[0]),r=vec2.add(vec2.create(),o,e[1]);vec2.scale(r,r,s.getZoom());var a=s.transformPoint(e[1]);s.transformPoint(e[0]),s.transformPoint(e[1]);this.context.beginPath(),this.context.fillStyle="rgba(255, 0, 0, 1.0)",this.context.arc(o[0],o[1],5*s.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.context.fillStyle="rgba(0, 255, 0, 1.0)",this.context.arc(r[0],r[1],3*s.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.beginPath(),this.context.fillStyle="rgba(0, 0, 255, 1.0)",this.context.arc(a[0],a[1],3*s.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill()},calcNiceAngle:function(t,e){t>Math.PI/2&&(t=Math.PI-t);var i=t/(Math.PI/2),n=Math.round(i)-i;return Math.abs(n)<.27&&(t=Math.round(i)*(Math.PI/2)),t},nearPI:function(t){var e=t/(Math.PI/2),i=Math.round(e)-e;return Math.abs(i)<.27},getBoundsMidPoint:function(t){var e=vec2.sub(vec2.create(),t[1],t[0]);vec2.scale(e,e,.5);var i=vec2.fromValues(-e[1],e[0]);vec2.normalize(i,i),vec2.scale(i,i,t[2]/2);var n=vec2.add(vec2.create(),t[0],e);return vec2.sub(n,n,i),n},getPOILocationOnMap:function(t){var e=this.wayfinder.map.getTransformer(),i=vec2.scale(vec2.create(),e.transformPoint(t.getNode().position2d),1/e.getViewScale());return i[0]>=0&&i[0]<=e.getViewWidth()&&i[1]>=0&&i[1]<=e.getViewHeight()&&i},getPOIOverlayLocationOnMap:function(t){var e=this.wayfinder.overlays[t.id];if(e&&e.length>0){e=e[0];var i=this.wayfinder.map.getTransformer(),n=vec2.scale(vec2.create(),i.transformPoint(vec2.fromValues(e.bounds[0]+e.bounds[2]/2,e.bounds[1]+e.bounds[3]/2)),1/i.getViewScale());return n[0]>=0&&n[0]<=i.getViewWidth()&&n[1]>=0&&n[1]<=i.getViewHeight()?n:this.getPOILocationOnMap(t)}return this.getPOILocationOnMap(t)},renderPolygon:function(t,e,i){var n=this.wayfinder.map.getTransformer(),s=n.transformPoint(vec2.fromValues(t[0][0],t[0][1]));this.context.fillStyle=e,this.context.beginPath(),i&&(s=n.rotatePoint(s,i)),this.context.moveTo(s[0],s[1]);for(var o=0;o<t.length;o++)s=n.transformPoint(vec2.set(s,t[o][0],t[o][1])),i&&(s=n.rotatePoint(s,i)),this.context.lineTo(s[0],s[1]);this.context.closePath(),this.context.fill()},drawRectangle:function(t,e,i,n,s,o){var r=this.wayfinder.map.getTransformer();e=r.transformPoint(e),s||(s=0),i*=r.getZoom(),n*=r.getZoom(),t.save(),t.strokeStyle=o,t.translate(e[0],e[1]),t.rotate(s),t.rect(0,0,i,n),t.stroke(),t.restore()},drawPoint:function(t,e,i){var n=this.wayfinder.map.getTransformer();this.context.beginPath(),this.context.fillStyle=i,this.context.arc(t[0],t[1],e*n.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill()},getLines:function(t,e){var i=t.replace(/\&shy;/g," &shy; ").split(" "),n=t.replace("&shy;","-").length,s=[],o=i[0];if(e<=0)return i;if(i.length<=e)return i;for(var r=1;r<i.length;r++)"&shy;"!==i[r].toLowerCase()?o.length>n/e?(s.push(o),o=i[r]):o+=" "+i[r]:o.length+1>n/e?(s.push(o+"-"),o=""):r+1<i.length&&(s.push(o+i[++r]),o="");return""!==o&&s.push(o),s}}),PathRenderer2D=Renderer2D.extend({init:function(){this._super(3),this.spots=[],this.position=0,this.timer=!1,this.animating=!1,this.paused=!1,this.msgOffset=vec2.fromValues(0,10),this.message="",this.messagePosition=vec2.fromValues(0,0)},onAdd:function(){this.spotColor=this.wayfinder.settings.getColor("path.2d.color","rgba(255,0,0,0.8)"),this.pathPauseTime=this.wayfinder.settings.getInt("path.2d.pause-time",this.wayfinder.options.pathPauseTime),this.messageSize=this.wayfinder.settings.getInt("path.2d.message-size",this.wayfinder.options.path2DMessageSize),this.spotSize=this.wayfinder.settings.getFloat("path.2d.size",this.wayfinder.options.pathSpotRadius),this.pathSpeed=this.wayfinder.settings.getFloat("path.2d.speed",this.wayfinder.options.pathSpeed),this.pathStride=this.wayfinder.settings.getFloat("path.2d.stride",this.wayfinder.options.pathStride),this.spotSize<.1&&(this.spotSize=.1),this.pathSpeed<.05&&(this.pathSpeed=.05),this.pathStride<.05&&(this.pathStride=.05)},reset:function(){this.position=0},generatePath:function(t){this.spots=[];for(var e,i,n,s,o,r=0,a=this.pathStride,h=1,c=t.nodes.length;h<c;h++)if(i=t.nodes[h-1],n=t.nodes[h],s=vec2.normalize(vec2.create(),vec2.subtract(vec2.create(),n.position2d,i.position2d)),o=vec2.distance(i.position2d,n.position2d),"portal"===i.type&&"portal"===n.type)this.spots.push({floor:i.floor,position:i.position2d,node:i});else for(var d=r;d<o;d+=a)e={floor:i.floor,position:vec2.add(vec2.create(),i.position2d,vec2.scale(vec2.create(),s,d))},d+a>o&&(r=a-(o-d),e.node=t.nodes[h]),this.spots.push(e)},setPath:function(t,e){if(t instanceof Path2D&&!t.isEmpty()){!1!==this.timer&&(clearTimeout(this.timer),this.timer=!1),this.position=0,this.generatePath(t),vec2.set(this.messagePosition,0,0);var i=this;this.animating=!0;var n=function(){i.paused=!1;var t=i.spots[i.position];i.renderSpot(i.position),i.position++;var s=i.spots[i.position];if(t&&t.node&&i.wayfinder.cbOnPathStep(t),i.position===i.spots.length)return i.animating=!1,void(e&&"function"==typeof e&&e());var o=0;if(s&&t.floor.id!==s.floor.id){var r=function(t,e){for(var i=0,n=e+1,s=t.length;n<s;n++)if(t[n].floor.id==t[n-1].floor.id){if(2==++i)return t[n].floor}else i=0;return!1}(i.spots,i.position+1);if(o=i.pathPauseTime,r&&i.wayfinder.options.pathDisplayInstructions){i.messagePosition=i.wayfinder.map.getTransformer().transformPoint(vec2.add(i.messagePosition,t.position,i.msgOffset));var a=i.wayfinder.getLanguage();i.message=i.wayfinder.translator.get("go_to_floor",[i.wayfinder.map.getCurrentFloor().getName(a),r.getName(a)]),i.renderMessage(i.messagePosition,i.message),i.paused=!0}}else i.position>1&&i.spots[i.position-2].floor.id!==t.floor.id&&(i.wayfinder.showFloor(t.floor),i.wayfinder.map.renderer.damageAll(),i.wayfinder.map.renderer.render());i.timer=setTimeout(n,i.pathSpeed+o)};this.paused||(this.timer=setTimeout(n,this.wayfinder.options.pathSpeed)),"function"!=typeof this.wayfinder.cbOnPathStart||t.isEmpty()||this.wayfinder.cbOnPathStart(t.nodes[t.nodes.length-1])}},updatePath:function(t){this.animating||(this.generatePath(t),this.position=this.spots.length)},clearPath:function(){this.position=0,this.spots=[],clearTimeout(this.timer)},renderMessage:function(t,e){var i=this.wayfinder.map.getTransformer();this.context.save(),this.context.font="bold "+this.messageSize*i.getViewScale()+"px sans-serif",this.context.textBaseline="top",this.context.textAlign="center",this.context.fillStyle="rgba(40, 40, 40, 0.75)";var n=this.context.measureText(e).width;this.context.fillRect(t[0]-(n+20)/2,t[1],n+20,this.messageSize*i.getViewScale()+20),this.context.fillStyle="rgba(255,255,255,1.0)",this.context.fillText(e,t[0],t[1]+10),this.context.restore()},renderSpot:function(t){var e=this.wayfinder.map.getTransformer();this.context.save();var i=e.transformPoint(this.spots[t].position);this.context.beginPath(),this.context.fillStyle=this.spotColor.toString(),this.context.arc(i[0],i[1],this.spotSize*e.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.restore()},render:function(t){if(0!==this.spots.length){var e=this.wayfinder.map.getCurrentFloor();this.context.save();for(var i=0,n=this.position;i<n;i++)this.spots[i].floor.id===e.id&&this.renderSpot(i);this.paused&&this.renderMessage(this.messagePosition,this.message),this.context.restore()}}}),NodesRenderer2D=Renderer2D.extend({init:function(){this._super(2)},render:function(t){var e=this.wayfinder.map.getTransformer(),i=this.wayfinder.map.getCurrentFloor();if(i){this.context.save();for(var n in i.nodes){var s=e.transformPoint(i.nodes[n].position2d);this.context.beginPath(),this.context.fillStyle="rgba(60,120,0,0.7)",this.context.arc(s[0],s[1],2,0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.fillText(i.nodes[n].id,s[0]+2,s[1]+2)}this.context.restore()}}}),EdgesRenderer2D=Renderer2D.extend({init:function(){this._super(2)},render:function(t){var e=this.wayfinder.map.getTransformer(),i=this.wayfinder.map.getCurrentFloor();if(i){this.context.save();for(var n in i.nodes){var s=e.transformPoint(i.nodes[n].position2d);for(var o in i.nodes[n].neighbours){var r=e.transformPoint(i.nodes[n].neighbours[o].position2d);this.context.lineWidth=1,this.context.strokeStyle="rgba(10,10,10,0.1)",this.context.beginPath(),this.context.moveTo(s[0],s[1]),this.context.lineTo(r[0],r[1]),this.context.closePath(),this.context.stroke()}}this.context.restore()}}}),ExtrasRenderer2D=Renderer2D.extend({init:function(){this._super(5),this.yahSize=30},onAdd:function(){this.yahSize=this.wayfinder.settings.getInt("poi.2d.icon-size",this.wayfinder.options.poiRadius)},render:function(t){var e=this.wayfinder.map.getTransformer();if(this.context.save(),this.yahImage="",this.wayfinder.options.enableUserLocation&&"function"==typeof this.wayfinder.getCurrentPosition&&this.wayfinder.getCurrentPosition()){var i=this.wayfinder.getCurrentPosition(),n=e.transformPoint(i.location);this.context.beginPath(),this.context.fillStyle="rgba(0, 0, 200, 0.5)",this.context.arc(n[0],n[1],5*e.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill();this.context.fill()}if(this.wayfinder.yahImage&&this.wayfinder.options.drawKioskIcon&&!1!==this.wayfinder.getKioskNode()&&this.wayfinder.getKioskNode().floor.id==this.wayfinder.map.currentFloorID){var s=this.wayfinder.yahImage,o=e.transformPoint(this.wayfinder.getKioskNode().position2d),r=this.yahSize*e.getZoom(),a=r/s.width*s.height;0===this.wayfinder.options.yahRotation?this.context.drawImage(s,o[0]-r/2,o[1]-a,r,a):(this.context.save(),this.context.translate(o[0],o[1]),this.context.rotate(this.wayfinder.options.yahRotation*Math.PI/180),this.context.drawImage(s,-r/2,-a/2,r,a),this.context.restore())}this.context.restore()}}),DebugRenderer2D=Renderer2D.extend({init:function(){this._super(5),this.yahSize=30},onAdd:function(){this.debugBeacons=this.wayfinder.options.debugBeacons},render:function(t){var e=this.wayfinder.map.getTransformer();if(this.context.save(),this.debugBeacons&&this.wayfinder.mobileLogic){var i,n,s,o=this.wayfinder.mobileLogic.mobileData.ibeacons,r=this.wayfinder.mobileLogic.device.locationManager?this.wayfinder.mobileLogic.device.locationManager.locator.foundBeacons:{};for(var a in o)if(s=o[a],(i=this.wayfinder.nodes[parseInt(s.node_id)])&&this.wayfinder.map.getCurrentFloor().id===i.floor.id&&(n=e.transformPoint(i.position2d),i.position2d)){this.context.beginPath(),r[parseInt(i.id)]?this.context.fillStyle="rgba(0, 200, 0, 0.9)":this.context.fillStyle="rgba(0, 0, 200, 0.9)",this.context.arc(n[0],n[1],8*e.getZoom(),0,2*Math.PI,!0),this.context.closePath(),this.context.fill(),this.context.font=7*e.getZoom()+"px Arial";i.id.split(".");this.context.fillStyle="white",this.context.fillText(s.major+"."+s.minor,n[0]-7*e.getZoom(),n[1]+2*e.getZoom())}}this.context.restore()}}),Wayfinder2DRendering=Class.extend({init:function(t){this.wayfinder=null,this.context=null,this.renderers=[],t&&t instanceof Wayfinder&&(this.wayfinder=t),this.wayfinder&&(this.context=this.wayfinder.canvas.getContext("2d"))},damageAll:function(){for(var t=0;t<this.renderers.length;t++)this.renderers[t].damage()},render:function(){for(var t=this.wayfinder.map.getTransformer(),e=new Rectangle(t.getX(),t.getY(),t.getUnzoomedViewWidth(),t.getUnzoomedViewHeight()),i=0;i<this.renderers.length;i++)this.renderers[i]&&this.renderers[i].enabled&&this.renderers[i].damaged&&(this.renderers[i].render(e),this.renderers[i].undamage(),!0)},add:function(t){if(!(t instanceof Renderer2D))return!1;t.setContext(this.context),t.setWayfinder(this.wayfinder);for(var e=0;e<this.renderers.length;e++)if(t.renderQueue<this.renderers[e].renderQueue)return this.renderers.splice(e,0,t),t.onAdd(),!0;return this.renderers.push(t),t.onAdd(),!0},updateRenderers:function(){for(var t=0;t<this.renderers.length;t++)this.renderers[t].setContext(this.context)}}),Map2D=Class.extend({init:function(t){this.wayfinder=t,this.currentFloorID=-1,this.highlights=[],this.displaying=[],this.LODImages=[],this.onUpdateCallback=null,this.renderAll=!1,this.renderOnlyBase=!1,this.renderCycle=null,this.renderInterval=22,this.wayfinder.padding=0,this.mapClickAll=this.wayfinder.settings.getBoolean("poi.2d.map-click-all",!1),this.onPOIClick=!1,this.renderer,this.wayfinder.cbOnPositionUpdate=ClassCallback(this,this.onPositionUpdate)},setup:function(){this.renderer=new Wayfinder2DRendering(this.wayfinder),this.mapMover=new Map2DMover(this.wayfinder.canvas,this.wayfinder.options,ClassCallback(this,this.update)),this.mapMover.cbOnClick=ClassCallback(this,this.onClick),this.mapMover.cbOnLongClick=ClassCallback(this,this.onLongClick),this.pathRenderer=new PathRenderer2D,this.floorRenderer=new FloorRenderer2D,this.poisRenderer=new POIsRenderer2D,this.extrasRenderer=new ExtrasRenderer2D,this.wayfinder.options.debug&&(this.debugRenderer=new DebugRenderer2D),this.addRenderers()},updateCanvas:function(t){this.renderer.context=t.getContext("2d"),this.renderer.updateRenderers(),this.mapMover.view=t,this.mapMover.bindEvents()},start:function(){var t=this;this.renderAll=!0;var e=function(){t.renderAll?(t.renderer.damageAll(),t.renderer.render(),t.renderAll=!1,t.renderOnlyBase=!1):t.renderOnlyBase&&(t.floorRenderer.damage(),t.renderer.render(),t.renderOnlyBase=!1),t.renderCycle=requestAnimFrame(e,this.renderInterval)};this.renderCycle=requestAnimFrame(e,this.renderInterval)},addLODImage:function(t,e,i,n,s){this.LODImages&&(this.LODImages[t]||(this.LODImages[t]=[]),this.LODImages[t][e]||(this.LODImages[t][e]=[]),this.LODImages[t][e][i]||(this.LODImages[t][e][i]=[]),this.LODImages[t][e][i][n]||(this.LODImages[t][e][i][n]=[]),this.LODImages[t][e][i][n]=s)},getLODImage:function(t,e,i,n){return!!(this.LODImages[t]&&this.LODImages[t][e]&&this.LODImages[t][e][i]&&this.LODImages[t][e][i][n])&&this.LODImages[t][e][i][n]},getContainerNeededLevel:function(){var t=Math.max(this.getTransformer().getZoomedMapWidth(),this.getTransformer().getZoomedMapHeight()),e=Math.floor(t/this.wayfinder.options.mapSize[0]);return Math.min(e,this.wayfinder.options.maxLOD)},getMaxLODLevel:function(t){var e=0;if(this.LODImages[t]){for(var i=0;i<=this.wayfinder.options.maxLOD;i++)this.LODImages[t][i]&&this.LODImages[t][i].length==Math.pow(2,i)&&this.imagesInLevel(t,i)==Math.pow(4,i)&&(e=i);e=Math.max(0,Math.min(e,this.wayfinder.options.maxLOD))}return e},imagesInLevel:function(t,e){var i=0;if(this.LODImages[t]&&this.LODImages[t][e])for(var n in this.LODImages[t][e])this.LODImages[t][e][n]&&(i+=this.LODImages[t][e][n].length);return i},addRenderers:function(){this.renderer.add(this.floorRenderer),this.renderer.add(this.poisRenderer),this.renderer.add(this.pathRenderer),this.renderer.add(this.pathRenderer),this.renderer.add(this.extrasRenderer),this.renderer.add(this.debugRenderer)},onPositionUpdate:function(){var t=this.wayfinder.geolocation.currentPosition,e=this.wayfinder.geolocation.currentGeoPosition;console.log("=== Position Update ==="),console.log("Geo.pos: ("+e[0]+", "+e[1]+")",e),console.log("Map.pos: ("+t[0]+", "+t[1]+")",t);var i;!1!==(i=void 0===t[0]?this.findNearestNodeOnFloor(this.getCurrentFloor(),vec2.fromValues(t.x,t.y)):this.findNearestNodeOnFloor(this.getCurrentFloor(),t))&&(this.wayfinder.kiosk=i),this.update(!0)},onClick:function(t){var e=this.getCurrentFloor();if(e){var i=t,n=[];this.wayfinder.options.debugMouseLocation&&(this.floorRenderer.debugPoint=i);for(var s in e.nodes)if("object"==typeof e.nodes[s]&&0!==e.nodes[s].pois.length)for(var o=0;o<e.nodes[s].pois.length;o++){var r=e.nodes[s].pois[o];if(this.wayfinder.overlays[r.id])for(var a in this.wayfinder.overlays[r.id])"object"!=typeof this.wayfinder.overlays[r.id][a]||!this.wayfinder.overlays[r.id][a].contains(i)||(n.push(r),this.mapClickAll);!(vec2.distance(i,e.nodes[s].position2d)<this.wayfinder.options.poiRadius)||(n.push(r),this.mapClickAll)}if(n.length>0){var h=vec2.scale(vec2.create(),t,1/this.getTransformer().getViewScale());this.openPOI(n[0],h),this.wayfinder.events.trigger("map-click",n,h)}}},openPOI:function(t,e){this.clearHighlights(),this.clearDisplaying(),this.wayfinder.settings.getBoolean("poi.highlight",!0,t)&&this.highlights.push(t),this.wayfinder.settings.getBoolean("poi.display",!0,t)&&this.displaying.push(t),this.pathRenderer.clearPath(),this.update(!0),this.onPOIClick&&"function"==typeof this.onPOIClick&&this.onPOIClick(t,e)},onLongClick:function(t){if(this.wayfinder.options.enableUserYAHSetting){var e=this.getTransformer().inverseTransformPoint(t),i=this.findNearestNodeOnFloor(this.getCurrentFloor(),e);!1!==i&&(this.wayfinder.kiosk=i,this.update(!0))}},update:function(t){this.wayfinder.paused||(this.wayfinder.options.enableLOD&&this.checkLODLevels(),t||!0===this.wayfinder.options.forceFullMapUpdate?this.renderAll=!0:this.renderOnlyBase=!0,"function"==typeof this.wayfinder.cbOnMapUpdate&&this.wayfinder.cbOnMapUpdate(t))},resize:function(t,e,i){if(this.wayfinder.canvas.setAttribute("width",t+"px"),this.wayfinder.canvas.setAttribute("height",e+"px"),this.getTransformer()){var n=this.getTransformer();n.setViewSize(vec2.fromValues(t,e)),n.setViewScale(i),n.setZoom(0),this.update(!0)}},getTransformer:function(){return!!this.mapMover&&this.mapMover.mapTransformer},getCurrentFloor:function(){return this.currentFloorID in this.wayfinder.building.getFloors()&&this.wayfinder.building.getFloors()[this.currentFloorID]},setCurrentFloor:function(t){t instanceof Floor&&(this.currentFloorID=t.id,this.update(!0))},fitPathInView:function(t){if(!1!==t){var e=t.getBounds(),i=this.getTransformer(),n=vec2.fromValues(this.wayfinder.padding,this.wayfinder.padding),s=vec2.add(vec2.create(),e.size,n),o=-1;e.size[0]>e.size[1]?((o=i.getViewWidth()/s[0])<i.getZoom()||this.wayfinder.options.pathZoomIn)&&i.setZoom(o):((o=i.getViewHeight()/s[1])<i.getZoom()||this.wayfinder.options.pathZoomIn)&&i.setZoom(o),i.setPosition(e.min[0]-(i.getUnzoomedViewWidth()/2-e.size[0]/2),e.min[1]-(i.getUnzoomedViewHeight()/2-e.size[1]/2))}},fitPOIInView:function(t){if(!1!==t){var e=this.wayfinder.overlays[t.id],i=[0,0,0,0];i=e&&e.length>0?e[0].getBounds():[t.getNode().position2d[0],t.getNode().position2d[1],1,1];var n=this.getTransformer(),s=[Math.max(i[0]-this.wayfinder.padding,0),Math.max(i[1]-this.wayfinder.padding,0),Math.min(i[2]+2*this.wayfinder.padding,n.getMapWidth()),Math.min(i[3]+2*this.wayfinder.padding,n.getMapHeight())];i[2]>i[3]?n.setZoom(Math.min(n.getZoom(),n.getViewWidth()/s[2])):n.setZoom(Math.min(n.getZoom(),n.getViewHeight()/s[3]));var o=n.getPosition(),r=0,a=0;r=Math.min(0,s[0]-o[0]),a=Math.min(0,s[1]-o[1]),r=Math.max(r,s[0]+s[2]-o[0]-n.getViewWidth()),a=Math.max(a,s[1]+s[3]-o[1]-n.getViewHeight()),n.setPosition(o[0]+r,o[1]+a)}},fitMultiplePOIsInView:function(t){if(!1!==t){var e=!1,i=1024,n=1024,s=0,o=0;this.wayfinder.kiosk&&(s=this.wayfinder.kiosk.position2d[0],o=this.wayfinder.kiosk.position2d[1]);for(var r=!1,a=0;a<t.length;a++)(e=t[a])&&e.getNode()&&((r=this.wayfinder.overlays[e.id])&&r.length>0&&r[0].getBounds()?(i=Math.min(i,r[0].getBounds()[0]),n=Math.min(n,r[0].getBounds()[1]),s=Math.max(s,r[0].getBounds()[0]+r[0].getBounds()[2]),o=Math.max(o,r[0].getBounds()[1]+r[0].getBounds()[3])):e.getNode().position2d&&(i=Math.min(i,e.getNode().position2d[0]),n=Math.min(n,e.getNode().position2d[1]),s=Math.max(s,e.getNode().position2d[0]),o=Math.max(o,e.getNode().position2d[1])));var h=[i,n,s-i,o-n],c=this.getTransformer();h[0]=Math.max(1,h[0]-this.wayfinder.padding),h[1]=Math.max(1,h[1]-this.wayfinder.padding),h[2]=Math.min(c.mapSize[0],h[2]+2*this.wayfinder.padding),h[3]=Math.min(c.mapSize[1],h[3]+2*this.wayfinder.padding);var d=c.getViewWidth()/h[2];d=Math.min(d,c.getViewHeight()/h[3]),c.setZoom(d),c.setPosition(h[0]-(c.getUnzoomedViewWidth()/2-h[2]/2),h[1]-(c.getUnzoomedViewHeight()/2-h[3]/2))}},checkLODLevels:function(){if(this.currentFloorID>-1){var t=this.getMaxLODLevel(this.currentFloorID),e=this.getContainerNeededLevel(),i=this.isLODLoading(this.currentFloorID,e);this.isLODLoaded(this.currentFloorID,e)?this.floorRenderer.setLOD(e):this.floorRenderer.setLOD(t),i||this.preloadNextLODLevel(this.currentFloorID,e)}},isLODLoading:function(t,e){return!(!this.LODImages[t]||!this.LODImages[t][e])},isLODLoaded:function(t,e){return!!(this.LODImages[t]&&this.LODImages[t][e]&&this.LODImages[t][e]&&this.LODImages[t][e].length==Math.pow(2,e)&&this.imagesInLevel(t,e)==Math.pow(4,e))},getCurrentLOD:function(t,e,i){if(t>-1){var n=this.getLODImage(this.currentFloorID,t,e,i);if(n)return n}return!1},preloadNextLODLevel:function(t,e){if(t&&e<=this.wayfinder.options.maxLOD){var i=this,n=Math.pow(2,e);this.LODImages[t]||(this.LODImages[t]=[]),this.LODImages[t][e]||(this.LODImages[t][e]=[]);for(var s={},o=0;o<n;o++)for(var r=0;r<n;r++)s[t+"_"+e+"_"+o+"_"+r]={url:WayfinderAPI.getURL("2d","lod",[t,e,o,r]),type:"image"};Logistics.getMultiple(s,function(n){var s=[];for(var o in n)s=o.split("_"),i.addLODImage(s[0],s[1],s[2],s[3],n[o]);i.afterPreload(t,e)})}},afterPreload:function(t,e){this.update(!0)},setHighlights:function(t){for(var e in t)this.highlights.push(t[e])},clearHighlights:function(){this.highlights=[]},setDisplaying:function(t){for(var e in t)this.displaying.push(t[e])},clearDisplaying:function(){this.displaying=[]},findNearestNodeOnFloor:function(t,e,i){if(!(t instanceof Floor))return!1;var n,s=1/0,o=!1;for(var r in t.nodes)if(n=t.nodes[r],!i||!n.neighbours||n.neighbours.length>0){var a=vec2.distance(e,n.position2d);a<s&&(o=n,s=a)}return o},setZoom:function(t){this.getTransformer().setZoomPercentage(t)},zoomIn:function(){this.mapMover.mapTransformer.zoomIn()},zoomOut:function(){this.mapMover.mapTransformer.zoomOut()},redraw:function(){this.renderer&&(this.renderer.damageAll(),this.renderer.render())},getPOILocationOnMap:function(t){return this.poisRenderer.getPOILocationOnMap(t)},getPOIOverlayLocationOnMap:function(t){return this.poisRenderer.getPOIOverlayLocationOnMap(t)},onMapUpdate:function(){"function"==typeof this.wayfinder.cbOnMapUpdate&&this.wayfinder.cbOnMapUpdate()}}),Map2DFallback=Map2D.extend({init:function(t){this.wayfinder=!1,t instanceof Wayfinder&&(this.wayfinder=t),this.currentFloorID=0,this.highlights=new Array,this.LODImages=new Array,this.onPOIClick=!1,this.wayfinder.cbOnPositionUpdate=ClassCallback(this,this.onPositionUpdate),this.map=$("<div id='"+this.wayfinder.options.map+"_fallback''></div>"),$("#"+this.wayfinder.options.map).parent().append(this.map),this.map.text("Your browser does not support this application. Please upgrade your browser.")},update:function(){if(this.currentFloorID>0){var t=this.getCurrentLOD(this.currentFloorID,0,0);log(this.currentFloorID,t),t&&this.map.append(t)}},fitPathInView:function(){},fitMultiplePOIsInView:function(){},resize:function(t,e){},zoomIn:function(){},zoomOut:function(){},addRenderers:function(){},redraw:function(){}}),Map2DMover=Class.extend({init:function(t,e,i){this.view=t,this.options=e,this.cbUpdate=i,this.cbOnClick=!1,this.cbOnLongClick=!1,this.mouseDelta=vec2.create(),this.mouseDown=!1,this.mouseDelta=vec2.create(),this.smoothPanning=!0,this.dragTimeout=null,this.panInterval=10,this.panSensitivity=.3,this.lastPinch=0,this.rendering=!1,this.lastDraw=-1,this.waitForFullRedraw=300,this.fullRedrawTimer=null,this._dragVec=vec2.create(),this.zeroVec=vec2.create(),this.setup()},setup:function(){this.mapTransformer=new Map2DTransformer(vec2.fromValues(this.options.mapSize[0],this.options.mapSize[1]),vec2.fromValues(this.view.offsetWidth,this.view.offsetHeight),!0,this.options),this.options.disableMap2DMovement?Hammer(this.view).on("tap",ClassCallback(this,this.onTap)):this.bindEvents()},bindEvents:function(){Hammer(this.view).on("pinch",ClassCallback(this,this.onPinch)),Hammer(this.view).on("hold",ClassCallback(this,this.onHold)),Hammer(this.view).on("tap",ClassCallback(this,this.onTap)),Hammer(this.view).on("release",ClassCallback(this,this.stop)),Hammer(this.view).on("drag",ClassCallback(this,this.onDrag)),Hammer(this.view).on("dragend",ClassCallback(this,this.onEndDrag)),Hammer(this.view).on("dragstart",ClassCallback(this,this.onStartDrag)),this.bindMouseWheel(ClassCallback(this,this.onWheel))},stop:function(t){this.cbUpdate(!0),this.lastPinch=0,this.mouseDelta=vec2.create()},getRelativeMousePosition:function(t){var e=this.view.getBoundingClientRect().left+document.body.scrollLeft,i=this.view.getBoundingClientRect().top+document.body.scrollTop,n=vec2.sub(vec2.create(),t,vec2.fromValues(e,i));return n=this.mapTransformer.inverseTransformPoint(n)},bindMouseWheel:function(t){this.view.addEventListener?(this.view.addEventListener("mousewheel",t,!1),this.view.addEventListener("DOMMouseScroll",t,!1)):this.view.attachEvent("onmousewheel",t)},onStartDrag:function(t){this.stop(),this.mouseDelta=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY)},onDrag:function(t){if(t.gesture.preventDefault(),!this.rendering&&"drag"==t.type){var e=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY);vec2.scale(e,e,this.mapTransformer.getViewScale());var i=vec2.sub(this._dragVec,this.mouseDelta,e);this.pan(i,!1),this.mouseDelta=e}},pan:function(t,e){if(this.rendering=!0,void 0===e&&(e=!0),0!==this.options.map2DRotation){var i=vec2.len(t);t=this.mapTransformer.rotatePointAroundCenter(t,this.zeroVec,-this.options.map2DRotation),vec2.normalize(t,t),vec2.scale(t,t,i)}this.mapTransformer.move(t),this.cbUpdate&&"function"==typeof this.cbUpdate&&(this.cbUpdate(e),this.lastDraw=(new Date).getTime()),null===this.fullRedrawTimer&&(this.fullRedrawTimer=setTimeout(ClassCallback(this,this.checkFullDraw),this.waitForFullRedraw)),this.rendering=!1},checkFullDraw:function(){var t=(new Date).getTime();this.lastDraw>0&&t-this.lastDraw>this.waitForFullRedraw?("function"==typeof this.cbUpdate&&this.cbUpdate(!0),this.fullRedrawTimer=null,this.lastDraw=-1):-1!==this.lastDraw&&(this.fullRedrawTimer=setTimeout(ClassCallback(this,this.checkFullDraw),this.waitForFullRedraw))},onEndDrag:function(t){if(void 0!==t&&"dragend"===t.type&&t.gesture){t.gesture.preventDefault(),this.timeout&&clearTimeout(this.timeout);var e=vec2.fromValues(t.gesture.velocityX,t.gesture.velocityY);if(this.smoothPanning&&vec2.sqrLen(e)>.3){var i=vec2.fromValues(t.gesture.deltaX,t.gesture.deltaY),n=vec2.create();vec2.multiply(n,i,e);var s=this,o=function(){var t=vec2.create();vec2.div(t,n,vec2.fromValues(13,13)),vec2.sub(n,n,t);if(vec2.sqrLen(t)>3){if(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(o,s.panInterval),!this.rendering){var e=vec2.negate(vec2.create(),t);s.pan(e,!1)}}else s.pan(vec2.create(),!0),s.lastDraw=-1};this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(o,this.panInterval)}this.pan(vec2.create(),!0),this.lastDraw=-1}},onHold:function(t){this.cbOnLongClick&&"function"==typeof this.cbOnLongClick&&this.cbOnLongClick(vec2.fromValues(t.gesture.center.pageX,t.gesture.center.pageY))},onTap:function(t){t.gesture.preventDefault(),this.timeout&&clearTimeout(this.timeout),this.cbOnClick&&"function"==typeof this.cbOnClick&&this.cbOnClick(this.getRelativeMousePosition(vec2.fromValues(t.gesture.center.pageX,t.gesture.center.pageY)))},onWheel:function(t){(t=window.event||t).preventDefault?t.preventDefault():t.returnValue=!1;var e=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),i=function(t){return t<0?-1:t>0?1:0},n=0;if(void 0!==e?n=i(e):void 0!==t.detail&&(n=-i(t.detail)),n>0)this.mapTransformer.zoomIn();else{if(!(n<0))return;this.mapTransformer.zoomOut()}this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)},onPinch:function(t){if(t.gesture.preventDefault(),!this.rendering&&t.gesture){0===this.lastPinch&&(this.lastPinch=this.mapTransformer.getZoom());var e=this.lastPinch*t.gesture.scale;this.pinch(e)}},pinch:function(t){this.rendering=!0,0!==t&&(this.mapTransformer.setZoom(t),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)),this.rendering=!1},onDoubleTap:function(t){var e=t.gesture.center,i=(this.mapTransformer.getZoom(),this.mapTransformer.getZoomStep(),vec2.create());vec2.sub(i,vec2.fromValues(e.pageX,e.pageY),vec2.fromValues(this.view.getBoundingClientRect().left,this.view.getBoundingClientRect().top));var n=this.mapTransformer.inverseTransformPoint(e.pageX,e.pageY);this.mapTransformer.setPosition(n.x,n.y),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)},onZoomInPressed:function(t){this.mapTransformer.zoomIn(),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0),this.zoomTimer=setTimeout(ClassCallback(this,this.onZoomInPressed),this.zoomInterval)},onZoomOutPressed:function(t){this.mapTransformer.zoomOut(),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0),this.zoomTimer=setTimeout(ClassCallback(this,this.onZoomOutPressed),this.zoomInterval)},onZoomEnd:function(){!1!==this.zoomTimer&&(clearTimeout(this.zoomTimer),this.zoomTimer=!1),this.cbUpdate&&"function"==typeof this.cbUpdate&&this.cbUpdate(!0)},viewScale:function(){var t=vec2.fromValues(this.view.offsetWidth,this.view.offsetHeight),e=window,i=document,n=i.documentElement,s=i.getElementsByTagName("body")[0],o=e.innerWidth||n.clientWidth||s.clientWidth,r=e.innerHeight||n.clientHeight||s.clientHeight,a=vec2.fromValues(o,r);return vec2.sqrLen(t)/vec2.sqrLen(a)}}),Map2DTransformer=Class.extend({init:function(t,e,i,n){this.position=vec2.create(),this.zoom=1,this.options=n,this.mapSize=t,this.viewSize=e,this.viewScale=1,this.zoomRange=vec2.fromValues(.1,2*this.options.maxLOD*this.viewScale),this.zoomSteps=30,this.centering=void 0===i||i,this.padding=void 0!==this.options.pathZoomPadding?this.options.pathZoomPadding:0,this.centerIfZoomedOut(),this.cbOnZoomChange=null},getPosition:function(){return this.position},getViewSize:function(){return this.viewSize},getViewScale:function(){return this.viewScale},getMapPosition:function(){return vec2.negate(vec2.create(),this.position)},getZoomedMapPosition:function(){return vec2.negate(vec2.create(),this.getZoomedPosition())},getZoomedPosition:function(){return vec2.scale(vec2.create(),this.position,this.zoom)},getX:function(){return this.position[0]},getY:function(){return this.position[1]},getZoomedX:function(){return this.position[0]*this.zoom},getZoomedY:function(){return this.position[1]*this.zoom},getZoom:function(){return this.zoom},getZoomRange:function(){return this.zoomRange},getZoomStep:function(){return(this.zoomRange[1]-this.zoomRange[0])/this.zoomSteps},setPosition:function(t,e){this.position[0]=t,this.position[1]=e,this.position[0]=Math.min(this.position[0],this.getMapWidth()-this.getUnzoomedViewWidth()),this.position[1]=Math.min(this.position[1],this.getMapHeight()-this.getUnzoomedViewHeight()),this.position[0]=Math.max(this.position[0],0),this.position[1]=Math.max(this.position[1],0),this.centerIfZoomedOut()},setZoomedPosition:function(t,e){this.setPosition(t/this.getZoom(),e/this.getZoom())},move:function(t){this.setPosition(this.position[0]+t[0]/this.getZoom(),this.position[1]+t[1]/this.getZoom())},setViewSize:function(t){this.viewSize=t;var e=Math.min(this.viewSize[0],this.viewSize[1]),i=Math.max(this.viewSize[0],this.viewSize[1]);this.zoomRange[0]=e/this.mapSize[0],this.zoomRange[1]=Math.max(2*this.options.maxLOD,this.mapSize[0]*this.options.maxLOD/i)},setViewScale:function(t){this.viewScale=t},setZoom:function(t){var e=this.getUnzoomedViewWidth(),i=this.getUnzoomedViewHeight();this.zoom=t,this.zoom<this.zoomRange[0]&&(this.zoom=this.zoomRange[0]),this.zoom>this.zoomRange[1]&&(this.zoom=this.zoomRange[1]);var n=this.getUnzoomedViewWidth()-e,s=this.getUnzoomedViewHeight()-i;if(this.setPosition(this.getX()-n/2,this.getY()-s/2),this.centerIfZoomedOut(),"function"==typeof this.cbOnZoomChange){var o=(this.zoomRange[1]-this.zoom)/(this.zoomRange[1]-this.zoomRange[0]);this.cbOnZoomChange(o)}},setZoomPercentage:function(t){var e=this.zoomRange[1]-(this.zoomRange[1]-this.zoomRange[0])*(1-t);this.setZoom(e)},centerIfZoomedOut:function(){this.centering&&(this.getUnzoomedViewWidth()>=this.getMapWidth()&&(this.position[0]=-(this.getUnzoomedViewWidth()-this.getMapWidth())/2),this.getUnzoomedViewHeight()>=this.getMapHeight()&&(this.position[1]=-(this.getUnzoomedViewHeight()-this.getMapHeight())/2))},zoomIn:function(){this.setZoom(this.getZoom()+this.getZoomStep())},zoomOut:function(){this.setZoom(this.getZoom()-this.getZoomStep())},zoomToFit:function(){this.mapSize[0]>this.mapSize[1]?this.zoom=this.viewSize[0]/this.mapSize[0]:this.zoom=this.viewSize[1]/this.mapSize[1],this.getZoomedMapHeight()>this.getViewHeight()&&(this.zoom=Math.min(this.viewSize[0],this.viewSize[1])/Math.min(this.mapSize[0],this.mapSize[1])),this.setZoom(this.zoom)},getMapWidth:function(){return this.mapSize[0]},getMapHeight:function(){return this.mapSize[1]},getZoomedMapWidth:function(){return this.mapSize[0]*this.zoom},getZoomedMapHeight:function(){return this.mapSize[1]*this.zoom},getViewWidth:function(){return this.viewSize[0]},getViewHeight:function(){return this.viewSize[1]},getUnzoomedViewWidth:function(){return this.viewSize[0]/this.zoom},getUnzoomedViewHeight:function(){return this.viewSize[1]/this.zoom},transformPoint:function(t){var e=vec2.add(vec2.create(),this.getZoomedMapPosition(),vec2.scale(vec2.create(),t,this.zoom));return 0!==this.options.map2DRotation?this.rotatePointAroundCenter(e,vec2.fromValues(this.getViewWidth()/2,this.getViewHeight()/2),this.options.map2DRotation):e},inverseTransformPoint:function(t){if(0!==this.options.map2DRotation){var e=vec2.fromValues(this.getViewWidth()/(2*this.getViewScale()),this.getViewHeight()/(2*this.getViewScale()));t=this.rotatePointAroundCenter(t,e,-this.options.map2DRotation)}return vec2.scale(t,t,this.viewScale),vec2.add(t,t,this.getZoomedPosition()),vec2.scale(t,t,1/this.zoom),t},getDrawingArea:function(){this.viewSize;return vec2.add(vec2.create(),this.viewSize,this.getZoomedPosition())},rotatePoint:function(t,e){var i=t[0]*Math.cos(e)-t[1]*Math.sin(e),n=t[1]*Math.cos(e)+t[0]*Math.sin(e);return vec2.fromValues(i,n)},rotatePointAroundCenter:function(t,e,i){return i=i*Math.PI/180,vec2.fromValues(Math.cos(i)*(t[0]-e[0])-Math.sin(i)*(t[1]-e[1])+e[0],Math.sin(i)*(t[0]-e[0])+Math.cos(i)*(t[1]-e[1])+e[1])}}),Path2D=Class.extend({init:function(){this.nodes=[]},isEmpty:function(){return 0===this.nodes.length},getBounds:function(t){var e={min:vec2.create(),max:vec2.create(),center:vec2.create(),size:vec2.create()};if(this.nodes.length>0){e.min[0]=this.nodes[0].position2d[0],e.min[1]=this.nodes[0].position2d[1],e.max[0]=this.nodes[0].position2d[0],e.max[1]=this.nodes[0].position2d[1];for(var i=1;i<this.nodes.length;i++){var n=this.nodes[i].position2d[0],s=this.nodes[i].position2d[1];n<e.min[0]&&(e.min[0]=n),s<e.min[1]&&(e.min[1]=s),n>e.max[0]&&(e.max[0]=n),s>e.max[1]&&(e.max[1]=s)}}return t&&"function"==typeof t&&(e.min=t(e.min),e.max=t(e.max)),e.size[0]=e.max[0]-e.min[0],e.size[1]=e.max[1]-e.min[1],e.center[0]=e.min[0]+e.size[0]/2,e.center[1]=e.min[1]+e.size[1]/2,e},getDistance:function(){var t=0;if(0==this.nodes.length)return t;for(var e=this.nodes[0],i=1,n=this.nodes.length;i<n;i++)t+=vec2.dist(e.position2d,this.nodes[i].position2d),e=this.nodes[i];return t}}),PathFinder2D=Class.extend({init:function(t){this.nodes=t,this.Infinity=Infinity,this.reset()},reset:function(){this.dist={},this.previous={},this.Q=[],this.searched={}},getNodeWithSmallestDistance:function(){for(var t=1/0,e=0,i=1;i<this.Q.length;i++)this.dist[this.Q[i]]<t&&(t=this.dist[this.Q[i]],e=i);return e},isSearched:function(t){return t in this.searched},decreaseKey:function(t){for(var e=0;e<this.Q.length&&this.Q[e]!=t;e++);for(var i=e-1;i>0&&this.dist[this.Q[e]]<this.dist[this.Q[i]];i--){var n=this.Q[i];this.Q[i]=this.Q[e],this.Q[e]=n,e=i}},distanceBetween:function(t,e){return vec3.len(vec3.fromValues(e.position[0]-t.position[0],e.position[1]-t.position[1],e.position[2]-t.position[2]))},find:function(t,e){if(this.reset(),!(t in this.nodes&&e in this.nodes))return!1;for(var i in this.nodes)this.dist[i]=this.Infinity,this.previous[i]=null,this.Q.push(i);for(this.dist[t]=0;this.Q.length>0;){var n=this.getNodeWithSmallestDistance(),s=this.Q[n];if(this.dist[s]==this.Infinity)break;if(this.Q.splice(n,1),this.searched[s]=!0,s==e){var o=new Path2D;for(s=e;null!==this.previous[s];)o.nodes.push(this.nodes[s]),s=this.previous[s];return o.nodes.push(this.nodes[t]),o.nodes.reverse(),o}for(i=0;i<this.nodes[s].neighbours.length;i++){var r=this.nodes[s].neighbours[i];if(!this.isSearched(r.id)){var a=this.dist[s]+this.distanceBetween(this.nodes[s],r)+r.weight;a<this.dist[r.id]&&(this.dist[r.id]=a,this.previous[r.id]=s,this.decreaseKey(r.id))}}}return!1}});