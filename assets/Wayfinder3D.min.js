function ClassCallback(t,e){return function(){return e.apply(t,arguments)}}var Class=function(){};!function(){var t=!1,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function n(){!t&&this.init&&this.init.apply(this,arguments)}var o=this.prototype;t=!0;var a=new this;t=!1;for(var s in i)a[s]="function"==typeof i[s]&&"function"==typeof o[s]&&e.test(i[s])?function(t,e){return function(){var i=this._super;this._super=o[t];var n=e.apply(this,arguments);return this._super=i,n}}(s,i[s]):i[s];return n.prototype=a,n.prototype.constructor=n,n.extend=arguments.callee,n}}();var Callback=ClassCallback;if(void 0===Float32Array)var Float32Array=function(){return[0,0]};"undefined"!=typeof window&&(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,16)},window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),"function"!=typeof String.prototype.format&&(String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,i){return void 0!==t[i]?t[i]:e})}),window.log=function(){log.history=log.history||[],log.history.push(arguments),this.console&&console.log(Array.prototype.slice.call(arguments))}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),window.console=window.console||{log:function(){},error:function(){}};var Logistics=function(){var t=!1;"undefined"!=typeof window&&(t="localStorage"in window&&null!==window.localStorage);var e=[],i=[],n={},o=0,a=!1,s=null,r=null,h=null,l=null,d={loadFromLocalStorage:!1,storeToLocalStorage:!1,loadFromFile:!1,enableCORS:!0,useCookies:!1,fallbackFromStorage:!0,urlParseFunction:null},c={text:{load:function(t){P(t)},parse:function(t,e){t.data=e.responseText},store:function(t){return t.data},restore:function(t,e){return e}},json:{load:function(t){P(t)},parse:function(t,e){try{t.data=JSON.parse(e.responseText)}catch(e){"undefined"!=typeof console&&console.error&&console.error("JSON parsing failed for "+t.url,e)}},store:function(t){return JSON.stringify(t.data)},restore:function(t,e){return e?JSON.parse(e):{}}},xml:{load:function(t){P(t)},parse:function(t,e){e.responseXML?t.data=e.responseXML:t.data=I(e.responseText)},store:function(t){return XMLSerializer?(new XMLSerializer).serializeToString(t.data):""},restore:function(t,e){return I(e)}},image:{load:function(t){t&&(t.data=new Image,t.useCORS&&(t.data.crossOrigin="Anonymous"),t.data.onload=function(){t.ready()},t.data.onerror=function(){t.failed()},t.data.src=t.url)},parse:function(t){},store:function(t){var e=document.createElement("canvas");e.width=t.data.width,e.height=t.data.height;e.getContext("2d").drawImage(t.data,0,0);var i=e.toDataURL("image/png");return e=null,i},restore:function(t,e){var i=new Image;return i.src=e,i}},binary:{load:function(t){P(t)},parse:function(t,e){t.data=e.response},store:function(t){for(var e="",i=new Uint8Array(t.data),n=i.byteLength,o=0;o<n;o++)e+=String.fromCharCode(i[o]);return window.btoa(e)},restore:function(t,e){for(var i=new ArrayBuffer(2*e.length),n=new Uint16Array(i),o=0,a=e.length;o<a;o++)n[o]=e.charCodeAt(o);return i}}},f=function(t,i,n,a,s){var r="GET";"function"==typeof i?(s=n,n=i,i=void 0):i&&"object"==typeof i&&(r="POST"),"function"==typeof d.urlParseFunction&&(t=d.urlParseFunction(t));var h=new function(t,e,i,n,a,s){this.url=t,this.params=e,this.success=i,this.dataType=n,this.loaded=!1,this.data=!1,this.requestType=a,this.useCORS=!1,this.options=s||{},this.successCallback=i,this.errorCallback=!1,this.alwaysCallback=!1,this.progressCallback=!1,this.setOption=function(t,e){this.options[t]=e},this.getOption=function(t){return this.options[t]},this.ready=function(){this.loaded=!0,o++,C(this),O(this)},this.failed=function(){o++,O(this),W(this)},this.done=function(t){this.successCallback=t},this.fail=function(t){this.errorCallback=t},this.error=function(t){this.errorCallback=t},this.always=function(t){this.alwaysCallback=t},this.progress=function(t){this.progressCallback=t},this.toString=function(){return this.data}}(t,i,n,a,r,s);return d.enableCORS&&(h.useCORS=u(t)),h&&(e.push(h),g(h)),h},u=function(t){if("undefined"==typeof document)return!1;var e=t.match(/(https?:)?\/\/([^\/]+)\/(.*)/);return!!e&&(!document||e[1]!==document.location.origin)},g=function(t){return p(t),!0},p=function(t){!function(t){if(t){var e=t.getOption("stage");e&&("object"!=typeof n[e]&&(n[e]=[]),n[e].push(t))}}(t),d.loadFromLocalStorage&&m(t)?y(t):v(t.dataType,"load")(t)},m=function(e){return!(!t||null===localStorage.getItem(e.url))},y=function(t){t.data=v(t.dataType,"restore")(t,b(t)),t.ready()},v=function(t,e){return c&&c[t]&&c[t][e]?c[t][e]:c&&c[t]?c[t]:function(){"undefined"!=typeof console&&console.warn&&console.warn("Method "+e+" for "+t+" not found")}},P=function(t){var e=A(t);if(!e||!t)throw"http failed";var i=t.url,n=null;if(e.open(t.requestType,i,!0),e.overrideMimeType&&e.overrideMimeType("text/xml"),"binary"==t.dataType&&(e.responseType="arraybuffer",t.useCORS&&e.setRequestHeader("Content-Type","application/x-3dtechdata")),"default"==t.dataType&&(e.responseType="arraybuffer",t.useCORS&&e.setRequestHeader("Content-Type","application/octet-stream")),t.options.headers){console.log("dt.headers",t);for(var o in t.options.headers)console.log("h",o,t.options.headers[o]),e.setRequestHeader(o,t.options.headers[o])}if(t.params){n=new FormData;for(var a in t.params)n.append(a,t.params[a])}t.useCORS&&d.useCookies&&(e.withCredentials=!0),e.onreadystatechange=function(){if(4==e.readyState){var i=e.status;200==i||0==i||300==i?(v(t.dataType,"parse")(t,e),t.ready()):t.failed()}else"function"==typeof t.progressCallback&&t.progressCallback(e)},e.ontimeout=function(){t.failed()},e.onerror=function(){t.failed()},O(t),e.send(n)},I=function(t){var e=null;if(!t||"string"!=typeof t)return e;if(window&&window.DOMParser){e=(new DOMParser).parseFromString(t,"text/xml")}else(e=new ActiveXObject("Microsoft.XMLDOM")).async=!1,e.loadXML(t);if(!e||e.getElementsByTagName("parsererror").length)throw"XML parsing failed";return e},A=function(t){var e=!1;if(t.useCORS&&window&&window.XDomainRequest)try{e=new XDomainRequest}catch(t){e=!1}else if(XMLHttpRequest)try{e=new XMLHttpRequest}catch(t){e=!1}else if("undefined"!=typeof ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP"),alert(2)}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP"),alert(3)}catch(t){e=!1}}return e},w=function(e){if(t)try{localStorage[e.url]=v(e.dataType,"store")(e)}catch(t){console.warn("localStorage limit exceeded")}else console.warn("localStorage isn't supported")},b=function(t){return localStorage[t.url]},C=function(t){t&&"function"==typeof t.successCallback&&(t.successCallback(t.data,"success",t),S()),t&&d.storeToLocalStorage&&w(t)},W=function(t){if(t&&d.fallbackFromStorage&&m(t))y(t);else{if(!t||"function"!=typeof t.errorCallback)throw"Resource "+t.url+" not loaded";t.errorCallback(t,"error",""),S()}},O=function(t){r&&"function"==typeof r&&e.length&&o&&r(o/e.length),t&&t.getOption("stage")&&M(t)},M=function(t){if(h&&"function"==typeof h){for(var e=n[t.getOption("stage")],i=e.length,o=0,a=0;a<i;a++)e[a]&&e[a].loaded&&o++;i>0&&h(t.getOption("stage"),o/i)}},S=function(){null===l&&(l=setTimeout(N,5))},N=function(){l=null,e.length==o&&s&&"function"==typeof s&&s()},D=function(t,e){return function(){return e.apply(t,arguments)}};return{count:function(){return e.length},loadedCount:function(){return o},clear:function(){e=[],i=[],o=0,a=!1},get:function(t,e,i,n,o){return f(t,e,i,toLowerCase(n),o)},getJSON:function(t,e,i,n){return f(t,e,i,"json",n)},getImage:function(t,e,i,n){return f(t,e,i,"image",n)},getBinary:function(t,e,i,n){return f(t,e,i,"binary",n)},getXML:function(t,e,i,n){return f(t,e,i,"xml",n)},getText:function(t,e,i,n){return f(t,e,i,"text",n)},getMultiple:function(t,e,n){!function(t,e,n){var o=new function(t,e,i){this.urls=t,this.results={},this.loadedCount=0,this.count=0,this.successCallback=e,i=i||{},this.load=function(){var t=null,e=null;for(var n in this.urls)this.urls.hasOwnProperty(n)&&this.count++;for(var o in this.urls)if((e=this.urls[o])&&e.url&&e.type)try{(t=f(e.url,void 0,D(this,this.ready,o),e.type,JSON.parse(JSON.stringify(i)))).setOption("logistics.multi.key",o),t.fail(D(this,this.fail))}catch(t){this.fail()}},this.ready=function(t,e,i){var n=i.getOption("logistics.multi.key");this.results[n]=t,this.loadedCount++,this.checkIfAllReady()},this.fail=function(t){this.loadedCount++,this.checkIfAllReady()},this.getKeyForURL=function(t){},this.checkIfAllReady=function(){this.loadedCount>=this.count&&"function"==typeof this.successCallback&&this.successCallback(this.results)}}(t,e,n);i.push(o),o.load()}(t,e,n)},store:function(){!function(){if(t)for(var i in e)w(e[i]);else console.warn("localStorage isn't supported")}()},clearStorage:function(){localStorage.clear()},types:function(){return c},onFinishedLoading:function(t){s=t},onProgress:function(t){r=t},onStageProgress:function(t){h=t},getQueue:function(){return e},getTypeFunction:function(t,e){return v(t,e)},setTypeFunction:function(t,e){return function(t,e){t&&e&&(c[t]=e)}(t,e)},getOption:function(t){return function(t){return d[t]}(t)},setOption:function(t,e){!function(t,e){d[t]=e}(t,e)},start:function(){return start()}}}();!function(t,e){"use strict";var i=function t(e,i){return new t.Instance(e,i||{})};i.VERSION="1.1.2",i.defaults={behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},i.DOCUMENT=document,i.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,i.HAS_TOUCHEVENTS="ontouchstart"in t,i.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),i.NO_MOUSEEVENTS=i.HAS_TOUCHEVENTS&&i.IS_MOBILE||i.HAS_POINTEREVENTS,i.CALCULATE_INTERVAL=25;var n={},o=i.DIRECTION_DOWN="down",a=i.DIRECTION_LEFT="left",s=i.DIRECTION_UP="up",r=i.DIRECTION_RIGHT="right",h=i.POINTER_MOUSE="mouse",l=i.POINTER_TOUCH="touch",d=i.POINTER_PEN="pen",c=i.EVENT_START="start",f=i.EVENT_MOVE="move",u=i.EVENT_END="end",g=i.EVENT_RELEASE="release",p=i.EVENT_TOUCH="touch";i.READY=!1,i.plugins=i.plugins||{},i.gestures=i.gestures||{};var m=i.utils={extend:function(t,i,n){for(var o in i)!i.hasOwnProperty(o)||t[o]!==e&&n||(t[o]=i[o]);return t},on:function(t,e,i){t.addEventListener(e,i,!1)},off:function(t,e,i){t.removeEventListener(e,i,!1)},each:function(t,i,n){var o,a;if("forEach"in t)t.forEach(i,n);else if(t.length!==e){for(o=0,a=t.length;a>o;o++)if(!1===i.call(n,t[o],o,t))return}else for(o in t)if(t.hasOwnProperty(o)&&!1===i.call(n,t[o],o,t))return},inStr:function(t,e){return t.indexOf(e)>-1},inArray:function(t,e){if(t.indexOf){var i=t.indexOf(e);return-1!==i&&i}for(var n=0,o=t.length;o>n;n++)if(t[n]===e)return n;return!1},toArray:function(t){return Array.prototype.slice.call(t,0)},hasParent:function(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1},getCenter:function(t){var e=[],i=[],n=[],o=[],a=Math.min,s=Math.max;return 1===t.length?{pageX:t[0].pageX,pageY:t[0].pageY,clientX:t[0].clientX,clientY:t[0].clientY}:(m.each(t,function(t){e.push(t.pageX),i.push(t.pageY),n.push(t.clientX),o.push(t.clientY)}),{pageX:(a.apply(Math,e)+s.apply(Math,e))/2,pageY:(a.apply(Math,i)+s.apply(Math,i))/2,clientX:(a.apply(Math,n)+s.apply(Math,n))/2,clientY:(a.apply(Math,o)+s.apply(Math,o))/2})},getVelocity:function(t,e,i){return{x:Math.abs(e/t)||0,y:Math.abs(i/t)||0}},getAngle:function(t,e){var i=e.clientX-t.clientX,n=e.clientY-t.clientY;return 180*Math.atan2(n,i)/Math.PI},getDirection:function(t,e){return Math.abs(t.clientX-e.clientX)>=Math.abs(t.clientY-e.clientY)?t.clientX-e.clientX>0?a:r:t.clientY-e.clientY>0?s:o},getDistance:function(t,e){var i=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(i*i+n*n)},getScale:function(t,e){return t.length>=2&&e.length>=2?this.getDistance(e[0],e[1])/this.getDistance(t[0],t[1]):1},getRotation:function(t,e){return t.length>=2&&e.length>=2?this.getAngle(e[1],e[0])-this.getAngle(t[1],t[0]):0},isVertical:function(t){return t==s||t==o},setPrefixedCss:function(t,e,i,n){var o=["","Webkit","Moz","O","ms"];e=m.toCamelCase(e);for(var a=0;a<o.length;a++){var s=e;if(o[a]&&(s=o[a]+s.slice(0,1).toUpperCase()+s.slice(1)),s in t.style){t.style[s]=(null==n||n)&&i||"";break}}},toggleBehavior:function(t,e,i){if(e&&t&&t.style){m.each(e,function(e,n){m.setPrefixedCss(t,n,e,i)});var n=i&&function(){return!1};"none"==e.userSelect&&(t.onselectstart=n),"none"==e.userDrag&&(t.ondragstart=n)}},toCamelCase:function(t){return t.replace(/[_-]([a-z])/g,function(t){return t[1].toUpperCase()})}},y=i.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(t,e,i,n){var o=e.split(" ");m.each(o,function(e){m.on(t,e,i),n&&n(e)})},off:function(t,e,i,n){var o=e.split(" ");m.each(o,function(e){m.off(t,e,i),n&&n(e)})},onTouch:function(t,e,o){var a=this,s=function(n){var s,r=n.type.toLowerCase(),h=i.HAS_POINTEREVENTS,l=m.inStr(r,"mouse");l&&a.preventMouseEvents||(l&&e==c&&0===n.button?(a.preventMouseEvents=!1,a.shouldDetect=!0):h&&e==c?a.shouldDetect=1===n.buttons:l||e!=c||(a.preventMouseEvents=!0,a.shouldDetect=!0),h&&e!=u&&v.updatePointer(e,n),a.shouldDetect&&(s=a.doDetect.call(a,n,e,t,o)),s==u&&(a.preventMouseEvents=!1,a.shouldDetect=!1,v.reset()),h&&e==u&&v.updatePointer(e,n))};return this.on(t,n[e],s),s},doDetect:function(t,e,i,n){var o=this.getTouchList(t,e),a=o.length,s=e,r=o.trigger,h=a;e==c?r=p:e==u&&(r=g,h=o.length-(t.changedTouches?t.changedTouches.length:1)),h>0&&this.started&&(s=f),this.started=!0;var l=this.collectEventData(i,s,o,t);return e!=u&&n.call(P,l),r&&(l.changedLength=h,l.eventType=r,n.call(P,l),l.eventType=s,delete l.changedLength),s==u&&(n.call(P,l),this.started=!1),s},determineEventTypes:function(){var e;return e=i.HAS_POINTEREVENTS?t.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:i.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],n[c]=e[0],n[f]=e[1],n[u]=e[2],n},getTouchList:function(t,e){if(i.HAS_POINTEREVENTS)return v.getTouchList();if(t.touches){if(e==f)return t.touches;var n=[],o=[].concat(m.toArray(t.touches),m.toArray(t.changedTouches)),a=[];return m.each(o,function(t){!1===m.inArray(n,t.identifier)&&a.push(t),n.push(t.identifier)}),a}return t.identifier=1,[t]},collectEventData:function(t,e,i,n){var o=l;return m.inStr(n.type,"mouse")||v.matchType(h,n)?o=h:v.matchType(d,n)&&(o=d),{center:m.getCenter(i),timeStamp:Date.now(),target:n.target,touches:i,eventType:e,pointerType:o,srcEvent:n,preventDefault:function(){var t=this.srcEvent;t.preventManipulation&&t.preventManipulation(),t.preventDefault&&t.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return P.stopDetect()}}}},v=i.PointerEvent={pointers:{},getTouchList:function(){var t=[];return m.each(this.pointers,function(e){t.push(e)}),t},updatePointer:function(t,e){t==u||t!=u&&1!==e.buttons?delete this.pointers[e.pointerId]:(e.identifier=e.pointerId,this.pointers[e.pointerId]=e)},matchType:function(t,e){if(!e.pointerType)return!1;var i=e.pointerType,n={};return n[h]=i===(e.MSPOINTER_TYPE_MOUSE||h),n[l]=i===(e.MSPOINTER_TYPE_TOUCH||l),n[d]=i===(e.MSPOINTER_TYPE_PEN||d),n[t]},reset:function(){this.pointers={}}},P=i.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(t,e){this.current||(this.stopped=!1,this.current={inst:t,startEvent:m.extend({},e),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(e))},detect:function(t){if(this.current&&!this.stopped){t=this.extendEventData(t);var e=this.current.inst,i=e.options;return m.each(this.gestures,function(n){return!this.stopped&&e.enabled&&i[n.name]&&!1===n.handler.call(n,t,e)?(this.stopDetect(),!1):void 0},this),this.current&&(this.current.lastEvent=t),t.eventType==u&&this.stopDetect(),t}},stopDetect:function(){this.previous=m.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(t,e,n,o,a){var s=this.current,r=!1,h=s.lastCalcEvent,l=s.lastCalcData;h&&t.timeStamp-h.timeStamp>i.CALCULATE_INTERVAL&&(e=h.center,n=t.timeStamp-h.timeStamp,o=t.center.clientX-h.center.clientX,a=t.center.clientY-h.center.clientY,r=!0),(t.eventType==p||t.eventType==g)&&(s.futureCalcEvent=t),(!s.lastCalcEvent||r)&&(l.velocity=m.getVelocity(n,o,a),l.angle=m.getAngle(e,t.center),l.direction=m.getDirection(e,t.center),s.lastCalcEvent=s.futureCalcEvent||t,s.futureCalcEvent=t),t.velocityX=l.velocity.x,t.velocityY=l.velocity.y,t.interimAngle=l.angle,t.interimDirection=l.direction},extendEventData:function(t){var e=this.current,i=e.startEvent,n=e.lastEvent||i;(t.eventType==p||t.eventType==g)&&(i.touches=[],m.each(t.touches,function(t){i.touches.push({clientX:t.clientX,clientY:t.clientY})}));var o=t.timeStamp-i.timeStamp,a=t.center.clientX-i.center.clientX,s=t.center.clientY-i.center.clientY;return this.getCalculatedData(t,n.center,o,a,s),m.extend(t,{startEvent:i,deltaTime:o,deltaX:a,deltaY:s,distance:m.getDistance(i.center,t.center),angle:m.getAngle(i.center,t.center),direction:m.getDirection(i.center,t.center),scale:m.getScale(i.touches,t.touches),rotation:m.getRotation(i.touches,t.touches)}),t},register:function(t){var n=t.defaults||{};return n[t.name]===e&&(n[t.name]=!0),m.extend(i.defaults,n,!0),t.index=t.index||1e3,this.gestures.push(t),this.gestures.sort(function(t,e){return t.index<e.index?-1:t.index>e.index?1:0}),this.gestures}};i.Instance=function(t,e){var n=this;i.READY||(y.determineEventTypes(),m.each(i.gestures,function(t){P.register(t)}),y.onTouch(i.DOCUMENT,f,P.detect),y.onTouch(i.DOCUMENT,u,P.detect),i.READY=!0),this.element=t,this.enabled=!0,m.each(e,function(t,i){delete e[i],e[m.toCamelCase(i)]=t}),this.options=m.extend(m.extend({},i.defaults),e||{}),this.options.behavior&&m.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=y.onTouch(t,c,function(t){n.enabled&&t.eventType==c?P.startDetect(n,t):t.eventType==p&&P.detect(t)}),this.eventHandlers=[]},i.Instance.prototype={on:function(t,e){var i=this;return y.on(i.element,t,e,function(t){i.eventHandlers.push({gesture:t,handler:e})}),i},off:function(t,e){var i=this;return y.off(i.element,t,e,function(t){var n=m.inArray({gesture:t,handler:e});!1!==n&&i.eventHandlers.splice(n,1)}),i},trigger:function(t,e){e||(e={});var n=i.DOCUMENT.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e;var o=this.element;return m.hasParent(e.target,o)&&(o=e.target),o.dispatchEvent(n),this},enable:function(t){return this.enabled=t,this},dispose:function(){var t,e;for(m.toggleBehavior(this.element,this.options.behavior,!1),t=-1;e=this.eventHandlers[++t];)m.off(this.element,e.gesture,e.handler);return this.eventHandlers=[],y.off(this.element,n[c],this.eventStartHandler),null}},function(t){var e=!1;i.gestures.Drag={name:t,index:50,handler:function(i,n){var h=P.current;if(!(n.options.dragMaxTouches>0&&i.touches.length>n.options.dragMaxTouches))switch(i.eventType){case c:e=!1;break;case f:if(i.distance<n.options.dragMinDistance&&h.name!=t)return;var l=h.startEvent.center;if(h.name!=t&&(h.name=t,n.options.dragDistanceCorrection&&i.distance>0)){var d=Math.abs(n.options.dragMinDistance/i.distance);l.pageX+=i.deltaX*d,l.pageY+=i.deltaY*d,l.clientX+=i.deltaX*d,l.clientY+=i.deltaY*d,i=P.extendEventData(i)}(h.lastEvent.dragLockToAxis||n.options.dragLockToAxis&&n.options.dragLockMinDistance<=i.distance)&&(i.dragLockToAxis=!0);var p=h.lastEvent.direction;i.dragLockToAxis&&p!==i.direction&&(i.direction=m.isVertical(p)?i.deltaY<0?s:o:i.deltaX<0?a:r),e||(n.trigger(t+"start",i),e=!0),n.trigger(t,i),n.trigger(t+i.direction,i);var y=m.isVertical(i.direction);(n.options.dragBlockVertical&&y||n.options.dragBlockHorizontal&&!y)&&i.preventDefault();break;case g:e&&i.changedLength<=n.options.dragMaxTouches&&(n.trigger(t+"end",i),e=!1);break;case u:e=!1}},defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),i.gestures.Gesture={name:"gesture",index:1337,handler:function(t,e){e.trigger(this.name,t)}},function(t){var e;i.gestures.Hold={name:t,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:function(i,n){var o=n.options,a=P.current;switch(i.eventType){case c:clearTimeout(e),a.name=t,e=setTimeout(function(){a&&a.name==t&&n.trigger(t,i)},o.holdTimeout);break;case f:i.distance>o.holdThreshold&&clearTimeout(e);break;case g:clearTimeout(e)}}}}("hold"),i.gestures.Release={name:"release",index:1/0,handler:function(t,e){t.eventType==g&&e.trigger(this.name,t)}},i.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:.6,swipeVelocityY:.6},handler:function(t,e){if(t.eventType==g){var i=t.touches.length,n=e.options;if(i<n.swipeMinTouches||i>n.swipeMaxTouches)return;(t.velocityX>n.swipeVelocityX||t.velocityY>n.swipeVelocityY)&&(e.trigger(this.name,t),e.trigger(this.name+t.direction,t))}}},function(t){var e=!1;i.gestures.Tap={name:t,index:100,handler:function(i,n){var o,a,s=n.options,r=P.current,h=P.previous;switch(i.eventType){case c:e=!1;break;case f:e=e||i.distance>s.tapMaxDistance;break;case u:"touchcancel"!=i.srcEvent.type&&i.deltaTime<s.tapMaxTime&&!e&&(o=h&&h.lastEvent&&i.timeStamp-h.lastEvent.timeStamp,a=!1,h&&h.name==t&&o&&o<s.doubleTapInterval&&i.distance<s.doubleTapDistance&&(n.trigger("doubletap",i),a=!0),(!a||s.tapAlways)&&(r.name=t,n.trigger(r.name,i)))}},defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),i.gestures.Touch={name:"touch",index:-1/0,defaults:{preventDefault:!1,preventMouse:!1},handler:function(t,e){return e.options.preventMouse&&t.pointerType==h?void t.stopDetect():(e.options.preventDefault&&t.preventDefault(),void(t.eventType==p&&e.trigger("touch",t)))}},function(t){var e=!1;i.gestures.Transform={name:t,index:45,defaults:{transformMinScale:.01,transformMinRotation:1},handler:function(i,n){switch(i.eventType){case c:e=!1;break;case f:if(i.touches.length<2)return;var o=Math.abs(1-i.scale),a=Math.abs(i.rotation);if(o<n.options.transformMinScale&&a<n.options.transformMinRotation)return;P.current.name=t,e||(n.trigger(t+"start",i),e=!0),n.trigger(t,i),a>n.options.transformMinRotation&&n.trigger("rotate",i),o>n.options.transformMinScale&&(n.trigger("pinch",i),n.trigger("pinch"+(i.scale<1?"in":"out"),i));break;case g:e&&i.changedLength<2&&(n.trigger(t+"end",i),e=!1)}}}}("transform"),"function"==typeof define&&define.amd?define(function(){return i}):"undefined"!=typeof module&&module.exports?module.exports=i:t.Hammer=i}(window);var WayfinderAPI={LOCATION:"//api.3dwayfinder.com/",PROJECT:!1,getJSON:function(t,e){Logistics.getJSON(t,e).error(function(t){console&&console.log&&console.log("Failed to get JSON: "+JSON.stringify(t))})},getURL:function(t,e,i){if(!1===WayfinderAPI.PROJECT)throw"No project opened! Call WayfinderAPI.open(<project name>);";return i=i||[],[WayfinderAPI.LOCATION,"public",WayfinderAPI.PROJECT,t,e].concat(i).join("/")},open:function(t){WayfinderAPI.PROJECT=t}};WayfinderAPI["2d"]={},WayfinderAPI["3d"]={},WayfinderAPI.access={},WayfinderAPI.advertisements={},WayfinderAPI.beacons={},WayfinderAPI.building={},WayfinderAPI.guitranslations={},WayfinderAPI.images={},WayfinderAPI.languages={},WayfinderAPI.lights={},WayfinderAPI.locationgroups={},WayfinderAPI.locations={},WayfinderAPI.materials={},WayfinderAPI.mobile={},WayfinderAPI.models={},WayfinderAPI.navigation={},WayfinderAPI.poisettings={},WayfinderAPI.svg={},WayfinderAPI.settings={},WayfinderAPI.statistics={},WayfinderAPI.templates={},WayfinderAPI.textures={},WayfinderAPI["2d"].bundle=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","bundle",[]),t)},WayfinderAPI["2d"].bundle.url=function(){return WayfinderAPI.getURL("2d","bundle",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].edges=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","edges",[]),t)},WayfinderAPI["2d"].edges.url=function(){return WayfinderAPI.getURL("2d","edges",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].getWatermark=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","getWatermark",[]),t)},WayfinderAPI["2d"].getWatermark.url=function(){return WayfinderAPI.getURL("2d","getWatermark",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].image=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","image",[t]),e)},WayfinderAPI["2d"].image.url=function(t){return WayfinderAPI.getURL("2d","image",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].lod=function(t,e,i,n,o){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","lod",[t,e,i,n]),o)},WayfinderAPI["2d"].lod.url=function(t,e,i,n){return WayfinderAPI.getURL("2d","lod",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].lodcount=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","lodcount",[]),t)},WayfinderAPI["2d"].lodcount.url=function(){return WayfinderAPI.getURL("2d","lodcount",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].nodes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","nodes",[]),t)},WayfinderAPI["2d"].nodes.url=function(){return WayfinderAPI.getURL("2d","nodes",Array.prototype.slice.call(arguments,0))},WayfinderAPI["2d"].overlays=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("2d","overlays",[]),t)},WayfinderAPI["2d"].overlays.url=function(){return WayfinderAPI.getURL("2d","overlays",Array.prototype.slice.call(arguments,0))},WayfinderAPI["3d"].getWatermark=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("3d","getWatermark",[]),t)},WayfinderAPI["3d"].getWatermark.url=function(){return WayfinderAPI.getURL("3d","getWatermark",Array.prototype.slice.call(arguments,0))},WayfinderAPI["3d"].scene=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("3d","scene",[]),t)},WayfinderAPI["3d"].scene.url=function(){return WayfinderAPI.getURL("3d","scene",Array.prototype.slice.call(arguments,0))},WayfinderAPI.access.hasWatermark=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("access","hasWatermark",[]),t)},WayfinderAPI.access.hasWatermark.url=function(){return WayfinderAPI.getURL("access","hasWatermark",Array.prototype.slice.call(arguments,0))},WayfinderAPI.access.template=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("access","template",[t]),e)},WayfinderAPI.access.template.url=function(t){return WayfinderAPI.getURL("access","template",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.all=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","all",[]),t)},WayfinderAPI.advertisements.all.url=function(){return WayfinderAPI.getURL("advertisements","all",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.data=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","data",[t]),e)},WayfinderAPI.advertisements.data.url=function(t){return WayfinderAPI.getURL("advertisements","data",Array.prototype.slice.call(arguments,0))},WayfinderAPI.advertisements.frames=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("advertisements","frames",[t,e,i]),n)},WayfinderAPI.advertisements.frames.url=function(t,e,i){return WayfinderAPI.getURL("advertisements","frames",Array.prototype.slice.call(arguments,0))},WayfinderAPI.beacons.getBeacon=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("beacons","getBeacon",[t]),e)},WayfinderAPI.beacons.getBeacon.url=function(t){return WayfinderAPI.getURL("beacons","getBeacon",Array.prototype.slice.call(arguments,0))},WayfinderAPI.beacons.getBeacons=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("beacons","getBeacons",[]),t)},WayfinderAPI.beacons.getBeacons.url=function(){return WayfinderAPI.getURL("beacons","getBeacons",Array.prototype.slice.call(arguments,0))},WayfinderAPI.building.levels=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("building","levels",[]),t)},WayfinderAPI.building.levels.url=function(){return WayfinderAPI.getURL("building","levels",Array.prototype.slice.call(arguments,0))},WayfinderAPI.building.location=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("building","location",[]),t)},WayfinderAPI.building.location.url=function(){return WayfinderAPI.getURL("building","location",Array.prototype.slice.call(arguments,0))},WayfinderAPI.guitranslations.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("guitranslations","get",[]),t)},WayfinderAPI.guitranslations.get.url=function(){return WayfinderAPI.getURL("guitranslations","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.checkImage=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","checkImage",[t]),e)},WayfinderAPI.images.checkImage.url=function(t){return WayfinderAPI.getURL("images","checkImage",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.get=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","get",[t]),e)},WayfinderAPI.images.get.url=function(t){return WayfinderAPI.getURL("images","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.images.thumbnail=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("images","thumbnail",[t]),e)},WayfinderAPI.images.thumbnail.url=function(t){return WayfinderAPI.getURL("images","thumbnail",Array.prototype.slice.call(arguments,0))},WayfinderAPI.languages.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("languages","get",[]),t)},WayfinderAPI.languages.get.url=function(){return WayfinderAPI.getURL("languages","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.languages.translation=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("languages","translation",[t]),e)},WayfinderAPI.languages.translation.url=function(t){return WayfinderAPI.getURL("languages","translation",Array.prototype.slice.call(arguments,0))},WayfinderAPI.lights.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("lights","get",[]),t)},WayfinderAPI.lights.get.url=function(){return WayfinderAPI.getURL("lights","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locationgroups.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locationgroups","get",[]),t)},WayfinderAPI.locationgroups.get.url=function(){return WayfinderAPI.getURL("locationgroups","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.byfloor=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","byfloor",[]),t)},WayfinderAPI.locations.byfloor.url=function(){return WayfinderAPI.getURL("locations","byfloor",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.bygroup=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","bygroup",[]),t)},WayfinderAPI.locations.bygroup.url=function(){return WayfinderAPI.getURL("locations","bygroup",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.bynode=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","bynode",[t]),e)},WayfinderAPI.locations.bynode.url=function(t){return WayfinderAPI.getURL("locations","bynode",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","get",[]),t)},WayfinderAPI.locations.get.url=function(){return WayfinderAPI.getURL("locations","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.location=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","location",[t]),e)},WayfinderAPI.locations.location.url=function(t){return WayfinderAPI.getURL("locations","location",Array.prototype.slice.call(arguments,0))},WayfinderAPI.locations.tags=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("locations","tags",[]),t)},WayfinderAPI.locations.tags.url=function(){return WayfinderAPI.getURL("locations","tags",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","get",[]),t)},WayfinderAPI.materials.get.url=function(){return WayfinderAPI.getURL("materials","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.textureMaterialNames=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","textureMaterialNames",[t]),e)},WayfinderAPI.materials.textureMaterialNames.url=function(t){return WayfinderAPI.getURL("materials","textureMaterialNames",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.textures=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","textures",[t]),e)},WayfinderAPI.materials.textures.url=function(t){return WayfinderAPI.getURL("materials","textures",Array.prototype.slice.call(arguments,0))},WayfinderAPI.materials.uniforms=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("materials","uniforms",[t]),e)},WayfinderAPI.materials.uniforms.url=function(t){return WayfinderAPI.getURL("materials","uniforms",Array.prototype.slice.call(arguments,0))},WayfinderAPI.mobile.bundle=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("mobile","bundle",[]),t)},WayfinderAPI.mobile.bundle.url=function(){return WayfinderAPI.getURL("mobile","bundle",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.all=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","all",[]),t)},WayfinderAPI.models.all.url=function(){return WayfinderAPI.getURL("models","all",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.allmeshes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","allmeshes",[]),t)},WayfinderAPI.models.allmeshes.url=function(){return WayfinderAPI.getURL("models","allmeshes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","get",[]),t)},WayfinderAPI.models.get.url=function(){return WayfinderAPI.getURL("models","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.instances=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","instances",[]),t)},WayfinderAPI.models.instances.url=function(){return WayfinderAPI.getURL("models","instances",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.json=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","json",[t]),e)},WayfinderAPI.models.json.url=function(t){return WayfinderAPI.getURL("models","json",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshes=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshes",[t]),e)},WayfinderAPI.models.meshes.url=function(t){return WayfinderAPI.getURL("models","meshes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshesOfInstances=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshesOfInstances",[]),t)},WayfinderAPI.models.meshesOfInstances.url=function(){return WayfinderAPI.getURL("models","meshesOfInstances",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.meshesbyfloor=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","meshesbyfloor",[]),t)},WayfinderAPI.models.meshesbyfloor.url=function(){return WayfinderAPI.getURL("models","meshesbyfloor",Array.prototype.slice.call(arguments,0))},WayfinderAPI.models.model=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("models","model",[t]),e)},WayfinderAPI.models.model.url=function(t){return WayfinderAPI.getURL("models","model",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.allAttributes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","allAttributes",[]),t)},WayfinderAPI.navigation.allAttributes.url=function(){return WayfinderAPI.getURL("navigation","allAttributes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.attributes=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","attributes",[t]),e)},WayfinderAPI.navigation.attributes.url=function(t){return WayfinderAPI.getURL("navigation","attributes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.edges=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","edges",[]),t)},WayfinderAPI.navigation.edges.url=function(){return WayfinderAPI.getURL("navigation","edges",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.node=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","node",[t]),e)},WayfinderAPI.navigation.node.url=function(t){return WayfinderAPI.getURL("navigation","node",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.nodes=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","nodes",[]),t)},WayfinderAPI.navigation.nodes.url=function(){return WayfinderAPI.getURL("navigation","nodes",Array.prototype.slice.call(arguments,0))},WayfinderAPI.navigation.nodesbytype=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("navigation","nodesbytype",[t]),e)},WayfinderAPI.navigation.nodesbytype.url=function(t){return WayfinderAPI.getURL("navigation","nodesbytype",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","get",[]),t)},WayfinderAPI.poisettings.get.url=function(){return WayfinderAPI.getURL("poisettings","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.getAllPOISettings=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","getAllPOISettings",[]),t)},WayfinderAPI.poisettings.getAllPOISettings.url=function(){return WayfinderAPI.getURL("poisettings","getAllPOISettings",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.getText=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","getText",[t]),e)},WayfinderAPI.poisettings.getText.url=function(t){return WayfinderAPI.getURL("poisettings","getText",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.getTexts=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","getTexts",[]),t)},WayfinderAPI.poisettings.getTexts.url=function(){return WayfinderAPI.getURL("poisettings","getTexts",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","map",[]),t)},WayfinderAPI.poisettings.map.url=function(){return WayfinderAPI.getURL("poisettings","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.poisettings.setting=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("poisettings","setting",[t]),e)},WayfinderAPI.poisettings.setting.url=function(t){return WayfinderAPI.getURL("poisettings","setting",Array.prototype.slice.call(arguments,0))},WayfinderAPI.svg.bundle=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("svg","bundle",[]),t)},WayfinderAPI.svg.bundle.url=function(){return WayfinderAPI.getURL("svg","bundle",Array.prototype.slice.call(arguments,0))},WayfinderAPI.svg.get=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("svg","get",[t]),e)},WayfinderAPI.svg.get.url=function(t){return WayfinderAPI.getURL("svg","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.get=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","get",[]),t)},WayfinderAPI.settings.get.url=function(){return WayfinderAPI.getURL("settings","get",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.getText=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","getText",[t]),e)},WayfinderAPI.settings.getText.url=function(t){return WayfinderAPI.getURL("settings","getText",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.getTexts=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","getTexts",[]),t)},WayfinderAPI.settings.getTexts.url=function(){return WayfinderAPI.getURL("settings","getTexts",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","map",[]),t)},WayfinderAPI.settings.map.url=function(){return WayfinderAPI.getURL("settings","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.settings.setting=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("settings","setting",[t]),e)},WayfinderAPI.settings.setting.url=function(t){return WayfinderAPI.getURL("settings","setting",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.click=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","click",[t,e,i]),n)},WayfinderAPI.statistics.click.url=function(t,e,i){return WayfinderAPI.getURL("statistics","click",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.device=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","device",[t,e,i]),n)},WayfinderAPI.statistics.device.url=function(t,e,i){return WayfinderAPI.getURL("statistics","device",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.endSession=function(t,e,i){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","endSession",[t,e]),i)},WayfinderAPI.statistics.endSession.url=function(t,e){return WayfinderAPI.getURL("statistics","endSession",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.search=function(t,e,i,n){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","search",[t,e,i]),n)},WayfinderAPI.statistics.search.url=function(t,e,i){return WayfinderAPI.getURL("statistics","search",Array.prototype.slice.call(arguments,0))},WayfinderAPI.statistics.startSession=function(t,e,i,n,o,a){WayfinderAPI.getJSON(WayfinderAPI.getURL("statistics","startSession",[t,e,i,n,o]),a)},WayfinderAPI.statistics.startSession.url=function(t,e,i,n,o){return WayfinderAPI.getURL("statistics","startSession",Array.prototype.slice.call(arguments,0))},WayfinderAPI.templates.css=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("templates","css",[t]),e)},WayfinderAPI.templates.css.url=function(t){return WayfinderAPI.getURL("templates","css",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.count=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","count",[]),t)},WayfinderAPI.textures.count.url=function(){return WayfinderAPI.getURL("textures","count",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.map=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","map",[]),t)},WayfinderAPI.textures.map.url=function(){return WayfinderAPI.getURL("textures","map",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.mipmap=function(t,e,i){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","mipmap",[t,e]),i)},WayfinderAPI.textures.mipmap.url=function(t,e){return WayfinderAPI.getURL("textures","mipmap",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.names=function(t){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","names",[]),t)},WayfinderAPI.textures.names.url=function(){return WayfinderAPI.getURL("textures","names",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.texture=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","texture",[t]),e)},WayfinderAPI.textures.texture.url=function(t){return WayfinderAPI.getURL("textures","texture",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.texturebyid=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","texturebyid",[t]),e)},WayfinderAPI.textures.texturebyid.url=function(t){return WayfinderAPI.getURL("textures","texturebyid",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.thumbnail=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","thumbnail",[t]),e)},WayfinderAPI.textures.thumbnail.url=function(t){return WayfinderAPI.getURL("textures","thumbnail",Array.prototype.slice.call(arguments,0))},WayfinderAPI.textures.thumbnailbyid=function(t,e){WayfinderAPI.getJSON(WayfinderAPI.getURL("textures","thumbnailbyid",[t]),e)},WayfinderAPI.textures.thumbnailbyid.url=function(t){return WayfinderAPI.getURL("textures","thumbnailbyid",Array.prototype.slice.call(arguments,0))};var WF_DEBUG=!1,Wayfinder=Class.extend({init:function(t,e){t&&t instanceof WayfinderOptions||(t=new WayfinderOptions),e||(e=new WayfinderFactory(this)),this.factory=e,this.setOptions(t),this.settings=new Settings,this.statistics=new WFStatistics(this),this.firstFinishedLoading=!1,this.debugLog=!1,this.kiosk=!1,this.dataLoaded=!1,t.debugLog&&DebugLog&&"DebugLog"==typeof DebugLog&&(this.debugLog=new DebugLog(t.debugLog)),Logistics.onStageProgress(ClassCallback(this,this.onStageProgress)),Logistics.onProgress(ClassCallback(this,this.onProgress)),this.languages={},this.pois={},this.poisArray=[],this.poiGroups={},this.nodes={},this.edges={},this.attributes={},this.poisettings=new Settings,this.poiAdvertisements={},this.advertisements={},this.translator=new Translator(this.options.language,{}),this.building=null,this.firstLanguageChange=!0,this.search=new WayfinderSearch(this),this.events=new WayfinderEvents(this),this.accessibility=""},cbOnPOIClick:function(t){},cbOnDataLoaded:function(){},cbOnProgress:function(t){},cbOnStageProgress:function(t,e){},cbOnLanguageChange:function(t){},cbOnBeforeFloorChange:function(t){},cbOnFloorChange:function(t){},cbOnZoomChange:function(t){},cbOnPathStep:function(t,e){},cbOnPathStart:function(t,e){},cbOnPathFinished:function(t){},cbOnTouch:function(t,e){},cbOnMapUpdate:function(){},cbOnMapReady:function(){},cbOnLocationChange:function(t){},finishedLoading:function(t){this.firstFinishedLoading||(this.firstFinishedLoading=!0,this.onDataLoaded())},setOptions:function(t){this.options=t,this.options.project=this.readProjectName(),this.options.loadFromURL()},setStyle:function(t){$("head").append('<link rel="stylesheet" type="text/css" href="{0}">'.format(WayfinderAPI.templates.css.url(t)))},open:function(t){void 0!==t&&(this.options.project=t),WayfinderAPI.open(this.options.project),this.startLoading(),console.log("Open",this.options.project)},readProjectName:function(){if("undefined"!=typeof document)for(var t=document.location.pathname.split("/"),e=0;e<t.length;e++)if("projects"==t[e]&&t.length>e+1)return t[e+1];return this.options.project},getLayout:function(){if("undefined"!=typeof document){var t=document.getElementsByTagName("meta");for(var e in t)if("layout"==t[e].name)return t[e].content;for(var i=document.location.pathname.split("/"),e=0;e<i.length;e++)if("projects"==i[e]&&i.length>e+2)return i[e+2]}return"default"},log:function(){this.debugLog&&this.debugLog.logArray(this.log.arguments)},getProject:function(){return this.options.project},getAPILocation:function(){return WayfinderAPI&&WayfinderAPI.LOCATION?WayfinderAPI.LOCATION:this.options.apiLocation},setKiosk:function(t){this.options.kiosk=t},getKiosk:function(){return this.options.kiosk},getKioskNode:function(){return!!(this.options.kiosk&&this.options.kiosk in this.nodes)&&this.nodes[this.options.kiosk]},showPath:function(t,e){},showKiosk:function(){},showFloor:function(t,e){"object"==typeof t&&this.building.setActiveFloors(t),this.cbOnFloorChange&&"function"==typeof this.cbOnFloorChange&&this.cbOnFloorChange(t)},getLanguage:function(){return this.translator.getLanguage()},setLanguage:function(t){this.translator.translate(t),"function"==typeof this.cbOnLanguageChange&&(this.cbOnLanguageChange(t),this.events.trigger("language-change",t))},startLoading:function(){},onBundleData:function(t){var e=t.data;this.settings.data=e.settings,this.poisettings.data=e.poisettings,this.texts=e.texts,this.onSettings(),e.guitranslations&&this.translator.setTranslations(e.guitranslations),this.factory.createLanguages(e.languages),this.factory.createFloors(e.levels),this.factory.createLocations(e)},onDataCreated:function(){this.finishedLoading()},loadPOIIcons:function(t){if(this.pois){for(var e in this.pois)this.pois[e].image_id&&0!==this.pois[e].image_id&&this.pois[e].alwaysVisible&&Logistics.getImage(WayfinderAPI.getURL("images","get",[this.pois[e].image_id]),null,ClassCallback(this.pois[e],this.pois[e].setIcon),{stage:"locations"})}},loadSecondaryResources:function(){var t=this;setTimeout(function(){t.loadHiddenPOIIcons()},1e3)},loadHiddenPOIIcons:function(t){if(this.pois)for(var e in this.pois)this.pois[e].image_id&&0!==this.pois[e].image_id&&!this.pois[e].alwaysVisible&&Logistics.getImage(WayfinderAPI.getURL("images","thumbnail",[this.pois[e].image_id]),ClassCallback(this.pois[e],this.pois[e].setIcon))},onAdvertisementsLoaded:function(t){this.advertisements=t.data},onSettings:function(){this.building=this.factory.createBuilding(this.settings.data),this.options.language=this.settings.get("language.default",this.options.language),this.setLanguage(this.options.language),!1===this.options.kiosk&&this.setKiosk(this.settings.getInt("kiosk.default",0))},onDataLoaded:function(){this.setKiosk(this.options.kiosk),this.statistics.start(),this.dataLoaded=!0,this.loadSecondaryResources(),this.cbOnProgress(100),this.cbOnDataLoaded()},createTranslations:function(t){this.translator&&t&&this.translator.setTranslations(t.data)},onProgress:function(t){"function"==typeof this.cbOnProgress&&this.cbOnProgress(t)},onStageProgress:function(t,e){"function"==typeof this.cbOnStageProgress&&this.cbOnStageProgress(t,e)},resize:function(){if("undefined"!=typeof document){var t=document.getElementById(this.options.map);if(t&&"undefined"!=typeof window){var e=window.getComputedStyle(t.parentNode,null);t.setAttribute("width",e.width),t.setAttribute("height",e.height)}}},onPOIClick:function(t,e,i){"function"==typeof this.cbOnPOIClick&&this.cbOnPOIClick(t)},onZoomChange:function(t){"function"==typeof this.cbOnZoomChange&&this.cbOnZoomChange(t)},setZoom:function(t){},zoomIn:function(){},zoomOut:function(){},pathToText:function(t){},textPathSimplification:function(t){function e(t){return t>=45&&t<135?"right":t>=135&&t<225?"around":t>=225&&t<315&&"left"}var i={},n="generic portal kiosk landmark";if(i.distance=0,i.steps=[],t&&t.length>0){for(var o=!1,a=t[t.length-1].bNode,s=0,r=0;r<t.length;r++)i.distance+=t[r].distance,s+=t[r].distance,o=e(t[r].angle),t[r].type&&"landmark"==t[r].type&&(t[r].bNode&&t[r].bNode.pois&&t[r].bNode.pois.length>0?i.steps.push({landmark:t[r].bNode.pois,endNode:t[r].bNode,startNode:a,in:s}):t[r].aNode&&t[r].aNode.pois&&t[r].aNode.pois.length>0&&i.steps.push({landmark:t[r].aNode.pois,endNode:t[r].aNode,startNode:a,in:s})),o&&("string"==typeof t[r].type&&-1==n.indexOf(t[r].type)||(s>0&&i.steps.push({walk:s/100,endNode:t[r].bNode,startNode:a}),i.steps.push({turn:o,endNode:t[r].bNode,startNode:a,in:s})),a=t[r].bNode,s=0),t[r].type&&-1==n.indexOf(t[r].type)&&(r>0&&r<t.length-1&&t[r].type!==t[r+1].type&&(s>0&&i.steps.push({walk:lastDistanc/100,endNode:t[r].bNode,startNode:a}),i.steps.push({use:t[r].type,endNode:t[r].bNode,startNode:a,in:s}),a=t[r].bNode),s=0),t[r].go_to_floor&&(s>0&&i.steps({walk:s/100,endNode:t[r].bNode,startNode:a}),s=0,i.steps.push({go_to_floor:t[r].go_to_floor,endNode:t[r].bNode,startNode:a}),a=t[r].bNode);s>0&&i.steps.push({walk:s/100,endNode:t[t.length-1].bNode,startNode:a})}return i},getPOIWithExternalId:function(t){for(var e in this.pois)if(this.pois[e].room_id==t)return this.pois[e];return!1},getNearestPOI:function(t,e){},restoreDefaultState:function(){this.options.language&&this.setLanguage(this.options.language),this.clearHighlights(),this.showKiosk()},showScreensaver:function(){},hideScreensaver:function(){},setHighlights:function(t){},clearHighlights:function(){},setDisplaying:function(t){},clearDisplaying:function(){},onSetLanguage:function(t){},getLanguages:function(){return this.languages},getPOIs:function(){return this.pois},getPOIsArray:function(){return this.poisArray},getPOIGroups:function(){return this.poiGroups},getNodes:function(){return this.nodes},getEdges:function(){return this.edges},clearPath:function(){},zoomOnPathSegment:function(t,e){},getCurrentFloor:function(){return this.logic.currentFloor},findNearestNodeOnFloor:function(t,e){},getImageData:function(){return!1}}),WayfinderFactory=Class.extend({init:function(t){this.wayfinder=t},createFloors:function(t){if(t&&this.wayfinder.building)for(var e in t)"object"==typeof t[e]&&this.wayfinder.building.addFloor(this.createFloor(t[e],this.wayfinder.languages))},createNodes:function(t){if(t)for(var e=this.wayfinder.settings.getInt("kiosk.default",0),i=this.wayfinder.building.getFloors(),n=0;n<t.length;n++){var o=this.createNode(t[n]);o&&(this.wayfinder.nodes[t[n].id]=o,o.floor_id in i&&i[o.floor_id].addNode(o),t[n].id==e&&(this.wayfinder.kiosk=o))}},createAttributes:function(t){t&&(this.wayfinder.attributes=t)},createPOIs:function(t){for(var e=0;e<t.length;e++){var i=this.createPOI(t[e],this.wayfinder.languages);this.wayfinder.pois[t[e].id]=i,this.wayfinder.poisArray.push(i),i.node_id in this.wayfinder.nodes&&this.wayfinder.nodes[i.node_id].addPOI(i),this.wayfinder.poisettings&&this.wayfinder.poisettings.data&&this.wayfinder.poisettings.data[i.id]&&(i.settings.data=this.wayfinder.poisettings.data[i.id])}},createTags:function(t){if(t)for(var e in t){var i=t[e],n=this.wayfinder.pois[i.poi_id];n&&n.setTags(i.tags)}},filterPOIs:function(t){if(t&&t.length>0){var e,i="";for(var n in t)if((i=t[n].trim())&&""!==i)for(var o in this.wayfinder.pois)(e=this.wayfinder.pois[o]).setShowInMenu(!1),e.getTags().indexOf(i)>-1&&e.setShowInMenu(!0)}},createGroups:function(t,e){if(e&&t){var i,n;for(n in t)i=this.createPOIGroup(t[n],this.wayfinder.languages),this.wayfinder.poiGroups[i.getID()]=i;for(var o in e){n=e[o];for(var a in n){var s=this.wayfinder.pois[n[a]];i=this.wayfinder.poiGroups[o],s&&i&&(i.addPOI(s),s.addGroup(i))}}}},createAdvertisements:function(t){if(t)for(var e in t){var i=t[e],n=this.wayfinder.pois[i.poi_id];if(n){var o=this.createPOIAdvertisement(n,i,this.wayfinder.languages);this.wayfinder.poiAdvertisements[i.id]=o,n.addAdvertisement(o)}}},addPOIsToFloor:function(t){for(var e in t){var i=this.wayfinder.building.getFloors();if(e in i){var n=i[e];for(var o in t[e])t[e][o]in this.wayfinder.pois&&n.addPOI(this.wayfinder.pois[t[e][o]])}}},createEdges:function(t){this.wayfinder.edges=t},createBuilding:function(t){return new Building(t)},createFloor:function(t,e){return new Floor(t,e)},createNode:function(t){return new NavigationNode(t)},createPOI:function(t,e){return new POI(t,e)},createPOIGroup:function(t,e){return new POIGroup(t,e)},createPOIAdvertisement:function(t,e,i){return new POIAdvertisement(t,e,i)},createLanguages:function(t){for(var e in t)this.wayfinder.languages[e]=new Language(t[e]),e.toLowerCase()==this.wayfinder.options.language.toLowerCase()&&(this.wayfinder.translator.language=e);this.wayfinder.translator.translate()},createLocations:function(t){this.wayfinder.factory.createNodes(t.navigation.nodes),this.wayfinder.factory.createEdges(t.navigation.edges),this.wayfinder.factory.createPOIs(t.locations.all),this.wayfinder.factory.addPOIsToFloor(t.locations.byfloor),this.wayfinder.factory.createGroups(t.locations.groups,t.locations.bygroup),this.wayfinder.factory.createTags(t.locations.tags),this.wayfinder.options.filterPOIs&&this.wayfinder.factory.filterPOIs(this.wayfinder.options.filterPOIs.trim().split(",")),this.wayfinder.advertisements=t.a,Logistics.getJSON(WayfinderAPI.navigation.allAttributes.url(),null,ClassCallback(this.wayfinder.factory,this.wayfinder.factory.createAttributes),{stage:"settings"})}}),WayfinderOptions=Class.extend({init:function(){this.application="wayfinder",this.map="map",this.project="demo",this.kiosk=!1,this.debugLog=!1,this.debugPOIs=!1,this.debugTranslations=!1,this.drawKioskIcon=!0,this.apiLocation="../../api/",this.language="en",this.disablePathDrawing=!1,this.searchScroreLimiter=3,this.searchMinimumScrore=10,this.filterPOIs="",this.factory=new WayfinderFactory},loadFromURL:function(){if(location.hash.length>=2&&location.hash.indexOf("{")>-1){var t=unescape(location.hash.substring(1)).split("#");if(t.length>=1&&t[0].indexOf("{")>-1&&t[0].indexOf("}")>-1){i=JSON.parse(t[0]);for(var e in i)console.log("Overriding option: "+e+"="+i[e]),this[e]=i[e],"kiosk"===e&&(this["kiosk.default"]=i[e])}}else if(location.search.length>=2){var i=unescape(location.search.substring(1)).split("&");if(console.log("location.search.1",i),i.length>=1){var n;for(var e in i)(n=i[e].split("=")).length>1&&(console.log("Overriding option: "+n[0]+"="+n[1]),this[n[0]]=n[1],"kiosk"===n[0]&&(this["kiosk.default"]=n[1]))}}}}),DebugLog=Class.extend({init:function(t){this.enabled=t,this.element=$("#log .content"),this.shown=!1,this.enabled&&$("#log").show(),$("#log .toggle").click(function(){$("#log .content").toggle()})},logArray:function(t){var e=$("<div></div>");for(var i in t)e.append(JSON.stringify(t[i])+", ");this.element.prepend(e)}}),ArrayUtility=Class.extend({init:function(t){if(t instanceof Object){var e=t;this.data=[];for(var i in e)this.data.push(e[i])}else{if(!(t instanceof Array))throw"Argument objectOrArray must be an object or array";this.data=t}},get:function(){return this.data},sort:function(t){return this.data.sort(function(e,i){return t(e,i)?1:t(i,e)?-1:0}),this.data}}),Building=Class.extend({init:function(t,e){this.name=t["building.name"],this.address=t["building.address"],this.link=new Translations(t["building.link"]),this.description=new Translations(t["building.description"]),this.logoID=t["building.logo"],this.backgroundID=t["building.background"],this.floors={}},addFloor:function(t){this.floors[t.id]=t},removeFloor:function(t){delete this.floors[t.id]},getFloors:function(){return this.floors},getSortedFloors:function(){return new ArrayUtility(this.floors).sort(function(t,e){return t.index<e.index})},setActiveFloors:function(t){if("object"==typeof t){var e;for(var i in this.floors)"object"==typeof(e=this.floors[i])&&e.setActive&&e.setActive(!1);t.setActive(!0)}}}),Settings=Class.extend({init:function(){this.data={}},has:function(t){return t in this.data},get:function(t,e,i){return i&&i.settings.data&&i.settings.data[t]?i.settings.data[t].value:t in this.data?this.data[t]:e},getInt:function(t,e,i){return parseInt(this.get(t,e,i))},getFloat:function(t,e,i){return parseFloat(this.get(t,e,i))},getColor:function(t,e,i){return(new Color).fromHex(this.get(t,e,i))},getBoolean:function(t,e,i){return!0===this.get(t,e,i)},getModel:function(t,e,i){var n=this.getInt(t,0,i);return 0===n?e:n},set:function(t,e){this.data[t]=e},override:function(t){for(var e in t)this.data[e]=t[e]}}),NavigationNode=Class.extend({init:function(t){this.id=t.id,this.floor_id=t.level_id,this.type=t.type,this.position=vec3.fromValues(-parseFloat(t.x),parseFloat(t.y),parseFloat(t.z)),this.rotation=vec3.fromValues(parseFloat(t.rotation_x),parseFloat(t.rotation_y),parseFloat(t.rotation_z)),this.floor=!1,this.pois=[],this.weight=0,t.weight&&(this.weight=parseFloat(t.weight)),this.zoom=0,t.zoom&&(this.zoom=parseFloat(t.zoom))},setFloor:function(t){t instanceof Floor&&t.id==this.floor_id&&(this.floor=t)},addPOI:function(t){t instanceof POI&&t.node_id==this.id&&(t.setNode(this),this.pois.push(t))},getID:function(){return this.id},getFloor:function(){return this.floor},getPOIs:function(){return this.pois}}),Floor=Class.extend({init:function(t,e){this.id=parseInt(t.id,10),this.name_id=parseInt(t.name_id,10),this.model_id=parseInt(t.model_id,10),this.index=parseInt(t.index,10),this.y=parseFloat(t.y,10),this.lightmap_id=parseInt(t.lightmap_id,10),this.showInMenu=0!==parseInt(t.show_in_menu,10),this.names=new Translations,this.active=!1,this.svg=t.svg;for(var i in e)this.names.set(i,t[i]);this.pois=[],this.nodes=[]},getID:function(){return this.id},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},addPOI:function(t){t instanceof POI&&(t.setFloor(this),this.pois.push(t))},addNode:function(t){t instanceof NavigationNode&&t.floor_id==this.id&&(t.setFloor(this),this.nodes.push(t))},getPOIs:function(){return this.pois},getNodes:function(){return this.nodes},getShowInMenu:function(){return this.showInMenu},setActive:function(t){this.active=t},getActive:function(){return this.active}}),POI=Class.extend({init:function(t,e){this.id=parseInt(t.id),this.type=t.type,this.node_id=parseInt(t.node_id),this.mesh_id=parseInt(t.mesh_id),this.room_id=t.room_id,this.image_id=parseInt(t.image_id),this.icon=null,this.background_id=parseInt(t.background_id),this.background=null,this.showInMenu=0!=parseInt(t.show_in_menu),this.alwaysVisible=0!=parseInt(t.always_visible),this.mesh_name=t.mesh_name,this.settings={},this.names=new Translations,this.descriptions=new Translations,this.hasName=!1;for(var i in e)this.names.set(i,t["names_"+i]),this.descriptions.set(i,t["descriptions_"+i]),this.names.get(i).length>0&&(this.hasName=!0);this.floor=!1,this.node=!1,this.groups=[],this.advertisements=[],this.groupNames={},this.tags=""},getID:function(){return this.id},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},getDescription:function(t){return this.descriptions.get(t)},getDescriptions:function(){return this.descriptions},getShowInMenu:function(){return this.showInMenu&&this.hasName},setShowInMenu:function(t){this.showInMenu=t},setFloor:function(t){t instanceof Floor&&(this.floor=t)},getFloor:function(){return this.floor},setNode:function(t){t instanceof NavigationNode&&(this.node=t)},getNode:function(){return this.node},addGroup:function(t){this.groups.push(t)},getGroups:function(){return this.groups},getGroupNames:function(){if(this.groupNames[n])return this.groupNames[n];var t={};for(var e in this.groups)if("object"==typeof this.groups[e]){var i=this.groups[e].getNames();for(var n in i.getAll())t[n]||(t[n]=[]),t[n].push(i.get(n))}return this.groupNames[n]=t,t},addAdvertisement:function(t){this.advertisements.push(t)},getAdvertisements:function(){return this.advertisements},getTags:function(){return this.tags},setTags:function(t){this.tags=t},setIcon:function(t){this.icon=t},getIcon:function(){return this.icon},setBackground:function(t){this.background=t},getBackground:function(){return this.background},getRoomId:function(){return this.room_id},isAlwaysVisible:function(){return this.alwaysVisible}}),POIAdvertisement=Class.extend({init:function(t,e,i){this.id=e.id,this.image_id=e.image_id,this.text1={},this.text2={},this.link={},this.poi=t;for(var n in i)this.link[n]=e["link_"+n],e["text1_"+n]?this.text1[n]=e["text1_"+n]:this.text1[n]=e["menu_"+n],e["text2_"+n]?this.text2[n]=e["text2_"+n]:this.text2[n]=e["3d_"+n]},getID:function(){return this.id},getPOI:function(){return this.poi},getText1:function(t){return t in this.text1&&this.text1[t]},getText2:function(t){return t in this.text2&&this.text2[t]},getLink:function(t){return t in this.link&&this.link[t]}}),POIGroup=Class.extend({init:function(t,e){this.id=t.group_id,this.names=new Translations,this.imageID=t.image_id;for(var i in e)this.names.set(i,t[i]);this.pois=[],this.showInMenu=t.show_main,this.showInTopMenu=t.show_top,this.color=(new Color).fromHex(t.color),this.parent_id=t.parent_id},getID:function(){return this.id},getNames:function(){return this.names},getName:function(t){return this.names.get(t)},getNames:function(){return this.names},getShowInMenu:function(){return 0!=this.showInMenu},getShowInTopMenu:function(){return 0!=this.showInTopMenu},getImageID:function(){return this.imageID},addPOI:function(t){this.pois.push(t)},getPOIs:function(){return this.pois},getColor:function(){return this.color}}),WayfinderSearch=Class.extend({init:function(t){this.wayfinder=t,this.searchParams=[],this.limit=0,this.options={maxSearchParams:15,stringSearch:"relative",minimumScore:1,splitKeywords:!0,limit:1/0,scoreLimit:1.25,searchStringLength:2,poi:{name:1,description:.5,tags:1,room_id:.5}},this.results={},this.highScore=0,this.scores=[],this.providers={},this.setupProviders()},overrideOptions:function(t){for(var e in t)this.options[e]=t[e]},setupProviders:function(){this.providers.poi=ClassCallback(this,this.POIsProvider)},clearResults:function(){this.results={},this.highScore=0,this.scores=[]},search:function(t,e,i){var n="poi";if(this.clearResults(),"string"==typeof e&&(n=e),this.overrideOptions(i),void 0!==t&&t.length>=this.options.searchStringLength){t=t.trim().toLowerCase(),this.options.splitKeywords?this.searchParams=t.split(" "):this.searchParams.push(t),this.searchParams.length>this.options.maxSearchParams&&this.searchParams.splice(this.options.maxSearchParams,this.searchParams.length-this.options.maxSearchParams);this.wayfinder.pois;for(var o=0;o<this.searchParams.length;o++)this.providers[n]&&"function"==typeof this.providers[n]&&this.providers[n](this.searchParams[o],this.wayfinder)}return this.order(this.results,this.highScore,this.scores)},pushResult:function(t,e,i){t>=this.options.minimumScore&&(t=parseFloat(parseFloat(t).toFixed(2)),this.results[t]||(this.results[t]={}),-1==this.scores.indexOf(t)&&this.scores.push(t),this.results[t][e]=i,this.highScore=Math.max(this.highScore,t))},POIsProvider:function(t,e){function i(t,e){var i=0;return o.options.poi.name&&t.getName(n)&&(i=o.searchString(t.getName(n),e,o.options.poi.name)),o.options.poi.description&&t.getDescription(n)&&(i=Math.max(i,o.searchString(t.getDescription(n),e,o.options.poi.description))),o.options.poi.tags&&t.getTags()&&(i=Math.max(i,o.searchString(t.getTags(),e,o.options.poi.tags))),o.options.poi.room_id&&t.getRoomId()&&(i=Math.max(i,o.searchString(t.getRoomId(),e,o.options.poi.room_id))),i}var n=this.wayfinder.getLanguage(),o=this,a=e.pois;for(var s in a)a[s].getShowInMenu()&&(score=i(a[s],t),this.pushResult(score,a[s].getID(),a[s]))},findWithChar:function(t){var e=[],i=this.wayfinder.getLanguage();e[0]=[];var n=this.sortPOIs(this.wayfinder.pois);for(var o in n)n[o].getShowInMenu()&&n[o].getName(i).charAt(0)==t&&e[0].push(n[o])},searchString:function(t,e,i){if("string"==typeof t&&"string"==typeof e)switch(t=t.toLowerCase().trim(),e=e.toLowerCase().trim(),this.options.stringSearch){case"strict":return this.searchStringStrict(t,e,i);case"relative":return this.searchStringRelatively(t,e,i);default:return this.searchStringStrict(t,e,i)}return 0},searchStringStrict:function(t,e,i){if(!t||!e)return 0;var n=e.indexOf(t);if(n>-1){return((n=n/t.length*100)+e.length/t.length*100)/2}return 0},searchStringRelatively:function(t,e,i){function n(t,e,i){for(var n=0,o=0,a=0,s=-1,r=0;r<t.length;r++)s==t[r]-1?(o++,n=Math.max(n,o)):(a+=t[r]-s-1,o=1),s=t[r];var h=n/i.length*1.4;return h+=0===t[0]?1:0,h+=1-a/i.length,h+=t.length/e,h+=n/e*1.2,h+=e>i.length?0:t.length/i.length*1.3,10*(h+=e.length==i.length?1:0)}if(!t||!e)return 0;var o=e.split(""),a=t.split(/,\s*|\s/),s=0,r=0,h=[],l=-1,d=0;i||(i=1);for(var c=0;c<a.length;c++)if((t=a[c]).length>1){for(;r<t.length;){if(t[r]===o[s]){if(d=r,h.push(r),++s>=o.length)break}else r==t.length-1&&s<o.length&&(r=d,s++);r++}l=h.length>0?Math.max(l,n(h,o.length,t)):Math.max(l,-1),s=0,r=0,h.length=0}return l=Math.round(l*i)},order:function(t,e,i){if(!t||0==t.length)return[];var n,o=[],a=0,s=i.sort(function(t,e){return t-e}).reverse();for(var r in s)if(n=s[r],t[n]){var h;for(var r in t[n]){if(h=t[n][parseInt(r)],e/n>this.options.scoreLimit&&a>0)return o;if(o.push(h),a++,this.options.limit>0&&a>this.options.limit)return o}}return o}}),WayfinderEvents=Class.extend({init:function(){this.events={"map-click":[],"language-change":[]}},listen:function(t,e){"object"!=typeof this.events[t]&&(this.events[t]=[]),this.events[t].push(e)},trigger:function(){var t=Array.prototype.slice.call(arguments);if(t.length>0){var e=t[0];if(t.shift(),this.events[e])for(var i,n=0,o=this.events[e].length;n<o;n++)"function"==typeof(i=this.events[e][n])&&i.apply(this,t)}}}),Language=Class.extend({init:function(t){this.name=t.name,this.id=t.id,this.nativeName=t.native,this.textDirection=t.text_direction?t.text_direction.toLowerCase():"ltr",this.flagImage=t.flag,console.log("language:",this)},getName:function(){return this.name},getID:function(){return this.id},getNativeName:function(){return this.nativeName},getTextDirection:function(){return this.textDirection}}),Translator=Class.extend({init:function(t,e){this.language=t,this.translations=e},setTranslations:function(t){this.translations=t},setLanguage:function(t){this.language=t},getLanguage:function(){return this.language},_isJQueryObject:function(t){return"undefined"!=typeof jQuery&&t instanceof jQuery},get:function(t,e){if(this.translations&&t&&this.translations[t]&&this.translations[t][this.language]){var i=this.translations[t][this.language];return e&&(i=this.replaceValues(i,e)),i}return t},translate:function(t){if(t&&(this.language=t),"undefined"!=typeof document&&document.querySelectorAll){for(var e=document.querySelectorAll("[data-translation-element]"),i=0;i<e.length;i++)this.translateElement(e[i],e[i].getAttribute("data-translation-element"));for(var e=document.querySelectorAll("[data-translation-attributes]"),i=0;i<e.length;i++)for(var n=e[i].getAttribute("data-translation-attributes").split(","),o="",a=0;a<n.length;a++)o=e[i].getAttribute("data-translation-attribute-"+n[a]),e[i]&&o&&e[i].setAttribute(n[a],this.get(o))}},setElement:function(t,e){t&&e&&(this._isJQueryObject(t)&&(t=t[0]),t.setAttribute("data-translation-element",e))},setAttribute:function(t,e,i){if(t&&i&&e){this._isJQueryObject(t)&&(t=t[0]);var n=[];t.getAttribute("data-translation-attributes")&&(n=t.getAttribute("data-translation-attributes").split(",")),n.push(e),t.setAttribute("data-translation-attributes",n.join(",")),t.setAttribute("data-translation-attribute-"+e,i)}},translateElement:function(t,e,i){if(t)if(this._isJQueryObject(t)&&(t=t[0]),e&&this.exists(e)){var n=this.get(e,i);this.setElement(t,e),t.innerHTML=n}else t.classList&&t.classList.add("no-translation")},translateAttribute:function(t,e,i,n){if(t&&e&&i){this._isJQueryObject(t)&&(t=t[0]);var o=this.get(i,n);this.setAttribute(t,e,i),t.setAttribute(e,o),!this.exists(i)&&t.classList&&t.classList.add("no-translation")}},replaceValues:function(t,e){if(t&&e){var i=0;for(var n in e)t=t.replace("%"+i++,e[n])}return t},exists:function(t){return!!(this.translations&&t&&this.translations[t]&&this.translations[t][this.language])}}),Translations=Class.extend({init:function(t){this.translations=t||{}},set:function(t,e){this.translations[t]=e},get:function(t){return!!this.translations[t]&&this.translations[t]},setAll:function(t){this.translations=t},getAll:function(){return this.translations},setTranslations:function(t,e){if(t&&e){for(var i in this.translations)t.attr("data-lang-"+i,this.translations[i]);this.translations[e]?t.html(this.translations[e]):t.html("no translation"),t.attr("data-translated",!0)}}}),TranslationsMap=Class.extend({init:function(){this.translations={}},add:function(t,e){if(!(e instanceof Translations))throw"Only Translation instances can be added to translations map";this.translations[t]=e},get:function(t){return this.translations[t]?this.translations[t]:new Translations({english:"--missing--"})}}),WFStatistics=Class.extend({init:function(t){this.wayfinder=t,this.session_id=0,this.storageSupport="undefined"!=typeof window&&"localStorage"in window&&null!==window.localStorage,this.storagePrefix="wfstats_",this.device_id=0,this.searchPhrase="",this.checkStorage()},start:function(){var t=this;"undefined"!=typeof screen&&WayfinderAPI.statistics.device(screen.width,screen.height,this.wayfinder.getKiosk(),function(e){e&&(t.device_id=e.data.id,t.store("deviceId",e.data.id),console.log("Device created",e))})},onSessionStart:function(){var t=this,e=this.wayfinder.languages[this.wayfinder.getLanguage()];e&&e.getID()&&this.wayfinder.getKiosk()&&WayfinderAPI.statistics.startSession(e.getID(),this.wayfinder.getKiosk(),this.wayfinder.options.application,this.wayfinder.getLayout(),this.device_id,function(e){try{e&&(t.session_id=e.data)}catch(t){console.log("Something went wrong sending startSession")}})},onSessionEnd:function(){var t=this;if(this.session_id){var e=this.wayfinder.languages[this.wayfinder.getLanguage()];WayfinderAPI.statistics.endSession(this.session_id,e.getID(),function(){t.session_id=0,console.log("Session ended!")})}},onClick:function(t,e){WayfinderAPI.statistics.click(t,this.session_id,e)},onLanguageChange:function(t){},onSearch:function(t,e){WayfinderAPI.statistics.search(t,this.session_id,e)},checkStorage:function(){this.storageSupport&&(this.deviceId=localStorage.getItem(this.storagePrefix+"deviceId"))},getTime:function(){},store:function(t,e){this.storageSupport&&(localStorage[this.storagePrefix+t]=JSON.stringify(e))},isOnline:function(){}}),Layers={Default:1,POI:2,MaskAll:4294967295},Pathfinder3D=function(t,e){function i(){for(var t=1/0,e=0,i=0;i<u.length;i++)c[u[i]]<t&&(t=c[u[i]],e=i);return e}function n(t){return t in g}function o(t){for(var e=0;e<u.length&&u[e]!=t;e++);for(var i=e-1;i>0&&c[u[e]]<c[u[i]];i--){var n=u[i];u[i]=u[e],u[e]=n,e=i}}function a(t,e){var i=r[t].position,n=r[e].position;return vec3.distance(i,n)}function s(t,e,i){var n=vec2.subtract(vec2.create(),vec2.fromValues(t[0],t[2]),vec2.fromValues(e[0],e[2]));vec2.normalize(n,n);var o=vec2.subtract(vec2.create(),vec2.fromValues(e[0],e[2]),vec2.fromValues(i[0],i[2]));vec2.normalize(o,o);var a=Math.round(function(t){return 180*t/Math.PI}(Math.atan2(n[0]*o[1]-n[1]*o[0],n[0]*o[0]+n[1]*o[1])));return a<0&&(a=360+a),a}var r=t,h=e,l=null,d=null,c={},f={},u=[],g={};this.find=function(t,e){var s;l=t,d=e,c={},f={},u=[],g={};for(s in r)c[s]=1/0,f[s]=null,u.push(s);for(c[l]=0;u.length>0;){var p=i(),m=u[p];if(c[m]==1/0)break;if(u.splice(p,1),g[m]=!0,m==d){var y=[];for(m=d;null!==f[m];)y.push(m),m=f[m];return y.push(l),y.reverse(),y}for(s=0;s<h[m].length;s++){var v=h[m][s];if(!n(v)){var P=c[m]+a(m,v)+parseFloat(r[v].weight);P<c[v]&&(v in h||v==d)&&(c[v]=P,f[v]=m,o(v))}}}return[]},this.pathLength=function(t){var e=-1,i=null;for(var n in t)i&&n?(e+=a(i,t[n]),i=t[n]):i=t[n];return Math.round(e)},this.pathToText=function(t){var e,i=[],n=null,o=null,h=0;if(t.length>3){if(n={},r[t[0]]&&r[t[0]].rotation){var l=r[t[0]].rotation[1];o=vec2.subtract(vec2.create(),vec2.fromValues(r[t[0]].position[0],r[t[0]].position[2]),vec2.fromValues(r[t[1]].position[0],r[t[1]].position[2])),o=vec2.normalize(o,o),h=Math.round(Math.acos(vec2.dot(o,vec2.fromValues(0,1)))*(180/Math.PI)),(h+=l)<0&&(h=360+h),i.push({angle:h,distance:0}),h=0}for(var d=0;d<t.length;d++)d<t.length-1&&(n={},e=r[t[d]],o=r[t[d+1]],n.distance=Math.round(a(t[d],t[d+1])),d<t.length-2?(h=s(r[t[d]].position,r[t[d+1]].position,r[t[d+2]].position),n.angle=h):n.angle=0,r[t[d]].floor&&r[t[d+1]].floor&&r[t[d]].floor.index!=r[t[d+1]].floor.index&&(n.go_to_floor=r[t[d+1]].floor.id),r[t[d]].type&&(n.type=r[t[d]].type),n.aNode=e,n.bNode=o,i.push(n))}return i}},Floor3D=Floor.extend({init:function(t,e){this._super(t,e),this.node3D=!1,this.mapMeshPathToID={},this.mapIDToMeshPath={}},setMeshNames:function(t){for(var e in t)this.mapMeshPathToID[t[e]]=parseInt(e),this.mapIDToMeshPath[parseInt(e)]=t[e]},getMeshIDByPath:function(t){return t in this.mapMeshPathToID?this.mapMeshPathToID[t]:0},getMeshPathByID:function(t){return t in this.mapIDToMeshPath&&this.mapIDToMeshPath[t]},showYAH:function(){if(this.node3D){var t=this.node3D.find("YAHLocation/YAH");t&&t.onEachChild(function(t){var e=t.getComponent(RendererComponent);e&&e.enable();var i=t.getComponent(Billboard);i&&i.enable()})}},hideYAH:function(){if(this.node3D){var t=this.node3D.find("YAHLocation/YAH");t&&t.onEachChild(function(t){var e=t.getComponent(RendererComponent);e&&e.disable();var i=t.getComponent(Billboard);i&&i.disable()})}}}),POI3D=POI.extend({init:function(t,e){this._super(t,e),this.object=!1,this.visible=!1,this.meshNode=!1,this.submesh=!1,this.canvasBoard=!1,this.geometryCreated=!1,this.engine,this.wayfinder,this.poiComponent=!1},show:function(t){if(this.object){this.geometryCreated||this.createActualGeometry(!0);this.visible=!0,this.object.onEachChild(function(t){var e=t.getComponent(RendererComponent);e&&e.enable();var i=t.getComponent(Billboard);i&&i.enable();var n=t.getComponent(DistanceScalingComponent);n&&n.enable()})}},hide:function(){this.object&&(this.visible=!1,this.object.onEachChild(function(t){var e=t.getComponent(RendererComponent);e&&e.disable();var i=t.getComponent(Billboard);i&&i.disable();var n=t.getComponent(DistanceScalingComponent);n&&n.disable()}))},highlight:function(){this.object&&(this.geometryCreated||this.createActualGeometry(!0),this.poiComponent.startHighlight())},stopHighlight:function(){this.object&&this.poiComponent.stopHighlight()},dehighlight:function(){this.object&&this.poiComponent.dehighlight()},startAnimating:function(){this.object&&(this.geometryCreated||this.createActualGeometry(),this.object.onEachChild(function(t){var e=t.getComponent(AnimationComponent);e&&e.startAnimating()}))},setAnimation:function(t,e,i){this.object&&this.object.onEachChild(function(n){var o=n.getComponent(AnimationComponent);o&&(t&&o.setLowestPosition(t),e&&o.setHighestPosition(e),i&&o.setAnimationSpeed(i))})},stopAnimating:function(){this.object&&this.object.onEachChild(function(t){var e=t.getComponent(AnimationComponent);e&&e.finishAnimating()})},setNode:function(t){this._super(t),this.object&&this.node&&mat4.fromTranslation(this.object.transform.relative,this.node.position)},createGeometry:function(t,e){this.engine=t,this.wayfinder=e,this.object=new Node("POILocation");var i=this.wayfinder.settings.getBoolean("poi.3d.height-from-floor-enabled",!0,this);this.poiComponent=new POIComponent(this,e.getKioskNode()),this.poiComponent.heightFromFloor=i,this.object.addComponent(this.poiComponent),this.applySettings(this.wayfinder.settings,!0),this.alwaysVisible&&this.createActualGeometry(),this.poiComponent.onStart()},createActualGeometry:function(t){var e=this.wayfinder.settings.getBoolean("poi.3d.billboard",!1,this),i=this.wayfinder.settings.getBoolean("poi.3d.billboard-clickable",!0,this),n=this.wayfinder.settings.getBoolean("poi.3d.height-from-floor-enabled",!0,this),o=this.wayfinder.settings.getInt("poi.text.wrap",-1,this),a=this.wayfinder.settings.getBoolean("poi.3d.enable-canvas-board",!1,this),s=this.wayfinder.settings.getBoolean("poi.map.only-text",!1,this);0==this.mesh_id&&(e=!1);var r={billboardClickable:i,heightFromFloor:n,disableBillboard:e,wordWrap:o};a?this.createCanvasBoard(this.engine,this.wayfinder,r,this.poiComponent):this.image_id>0&&!s?this.createIconGeometry(this.engine,this.wayfinder,r,this.poiComponent):this.createNameGeometry(this.engine,this.wayfinder,r,this.poiComponent),this.geometryCreated=!0,this.applyOtherSettins(this.wayfinder.settings,!0)},createIconGeometry:function(t,e,i,n){var o=new TextureDescriptor(this.image_id);o.loadAsImage=!0;var a=new Material(t.assetsManager.addShaderSource("Transparent"),{diffuse:new UniformColor(new Color)},[new Sampler("diffuse0",t.assetsManager.texturesManager.addDescriptor(o))]);t.assetsManager.texturesManager.load(function(){}),a.name="POI_icon_"+this.getID(),a.shader.requirements.transparent=!0;var s=Primitives.plane(1,1,a);s.name="POI";var r=s.getComponent(MeshRendererComponent);r.disable(),r.castShadows=!1,r.lightContribution=0,i.billboardClickable&&s.addComponent(new MeshCollider),i.disableBillboard||s.addComponent(new Billboard(t.scene.camera,!0)),s.addComponent(new DistanceScalingComponent(t.scene.camera)),s.addComponent(new AnimationComponent),s.addComponent(n),s.layer=Layers.POI,mat4.fromTranslation(this.object.transform.relative,this.node.position),this.object.addNode(s)},createNameGeometry:function(t,e,i,n){var o=Primitives.text(this.getName(e.translator.getLanguage()),i.wordWrap);i.billboardClickable&&o.addComponent(new MeshCollider),o.addComponent(n),o.addComponent(new DistanceScalingComponent(t.scene.camera)),i.disableBillboard||o.addComponent(new Billboard(t.scene.camera,!0)),o.addComponent(new AnimationComponent),o.getComponent(TextRendererComponent).castShadows=!1,o.getComponent(TextRendererComponent).lightContribution=0,o.getComponent(TextRendererComponent).disable(),o.layer=Layers.POI;var a=o.getComponent(TextComponent);a.family="Tahoma, Geneva, sans-serif",a.color.set(1,1,1,1),a.outlineColor.set(0,0,0,1),mat4.fromTranslation(this.object.transform.relative,this.node.position),this.object.addNode(o)},createCanvasBoard:function(t,e,i){this.canvasBoard=Primitives.canvasBoard(256,256),this.canvasBoard.name="POI",i.billboardClickable&&this.canvasBoard.addComponent(new MeshCollider);var n=new POIComponent(this,e.getKioskNode());n.heightFromFloor=i.heightFromFloor,this.canvasBoard.addComponent(n),this.canvasBoard.addComponent(new DistanceScalingComponent(t.scene.camera)),i.disableBillboard||this.canvasBoard.addComponent(new Billboard(t.scene.camera,!0)),this.canvasBoard.addComponent(new AnimationComponent),this.canvasBoard.getComponent(CanvasBoardRendererComponent).castShadows=!1,this.canvasBoard.getComponent(CanvasBoardRendererComponent).lightContribution=0,this.canvasBoard.getComponent(CanvasBoardRendererComponent).disable(),this.canvasBoard.layer=Layers.POI,mat4.fromTranslation(this.object.transform.relative,this.node.position),this.object.addNode(this.canvasBoard)},getCanvasBoard:function(){return!!this.canvasBoard&&this.canvasBoard.getComponent(CanvasBoardComponent)},createPOISignOnMeshGeometry:function(t,e){var i=Primitives.text(this.getName(e.translator.getLanguage())),n=new Node("DebugLine"),o=n.addComponent(new LineRendererComponent(new Color(1,0,1,1)));o.overlay=!0,i.addComponent(new POIComponent(this,e.getKioskNode(),o)),i.getComponent(TextRendererComponent).castShadows=!1,i.getComponent(TextRendererComponent).lightContribution=0,i.getComponent(TextRendererComponent).disable();var a=i.getComponent(TextComponent);a.family="Tahoma, Geneva, sans-serif",a.color.set(1,1,1,1),a.outlineColor.set(0,0,0,1),this.object=new Node("POILocation"),mat4.fromTranslation(this.object.transform.relative,this.node.position),this.object.addNode(i),mat4.fromTranslation(n.transform.relative,vec3.fromValues(-this.node.position[0],0,-this.node.position[2])),this.object.addNode(n)},linkMesh:function(){if(0!==this.mesh_id&&this.object&&this.floor&&this.floor.node3D){var t=this.object.find("/POIController");if(t){var e=t.getComponent(POIController).getMeshInfoByID(this.mesh_id);if(!1!==e){var i=e.path.split("/");if(!(i.length<2)){var n=parseInt(i.pop().substring(5)),o=i.join("/");if(!(n<0)){if(this.meshNode=e.floor.node3D.find(o),!this.meshNode){if(!(e.floor.node3D.subnodes.length>0))return;for(var a=0;a<e.floor.node3D.subnodes.length&&(this.meshNode=e.floor.node3D.subnodes[a].find(i[1]),!this.meshNode);a++);if(!this.meshNode)return}var s=this.meshNode.getComponent(MeshComponent);s&&(n<s.mesh.submeshes.length&&(this.submesh=s.mesh.submeshes[n]),this.setDistanceScalingByMesh&&this.object.onEachChildComponent(function(t){t instanceof DistanceScalingComponent&&(t.maxScale=Math.min(s.mesh.boundingSphere.radius/2,t.maxScale))}))}}}}}},applySettings:function(t){var e=this,i=this.poiComponent;if(i.offsetY=t.getFloat("poi.3d.offset",0,e),i.width=t.getFloat("poi.width",1,e),i.height=t.getFloat("poi.height",1,e),i.highlightColors[0]=t.getColor("poi.highlight.color1","#ff0000ff",e).toVector(),i.highlightColors[1]=t.getColor("poi.highlight.color2","#0000ffff",e).toVector(),i.dehighlightColor=t.getColor("poi.dehighlight.color","#888888ff",e).toVector(),i.highlightDuration=t.getFloat("poi.highlight.duration",5,e),i.highlightSpeed=t.getFloat("poi.highlight.speed",1,e),i.textSize=t.getFloat("poi.text.size",1,e),i.textColor=t.getColor("poi.text.color","#FFFFFF",e),i.outline=t.getBoolean("poi.text.outline",!1,e),i.outlineColor=t.getColor("poi.text.outline-color","#000000",e),i.outlineWidth=t.getInt("poi.text.outline-width",5,e),i.backgroundColor=t.getColor("poi.text.background-color","#00000000",e),i.disableBillboard=t.getBoolean("poi.3d.billboard",!1,e),i.billboardClickable=t.getBoolean("poi.3d.billboard-clickable",e),t.getBoolean("poi.3d.meshgroupcolor",!1,e)&&e.groups.length>0&&e.groups[0]){var n=e.groups[0];i.groupColor=n.getColor().toVector()}},applyOtherSettins:function(t,e){if(this.object){var i=this;this.object.onEachChildComponent(function(e){e instanceof DistanceScalingComponent?(e.doingIt=t.getBoolean("poi.distancescaling.enabled",!1,i),e.maxScale=t.getFloat("poi.distancescaling.maxscale",15,i),t.getBoolean("poi.distancescaling.mesh",!1,i)&&(i.setDistanceScalingByMesh=!0)):e instanceof AnimationComponent&&(t.getBoolean("path.animation.poi",!1,i)||e.disable())}),e&&this.poiComponent.onStart()}}}),NavigationNode3D=NavigationNode.extend({init:function(t){this._super(t),this.node3D=!1}}),WayfinderFactory3D=WayfinderFactory.extend({createFloor:function(t,e){return new Floor3D(t,e)},createNode:function(t){return new NavigationNode3D(t)},createPOI:function(t,e){return new POI3D(t,e)}}),Wayfinder3D=Wayfinder.extend({init:function(t){t&&t instanceof WayfinderOptions||(t=new WayfinderOptions3D),this._super(t,new WayfinderFactory3D(this)),this.engine=!1,this.logic=!1,this.engineLoaded=!1,this.orbitController=!1,this.poiController=!1,this.pathComponent=!1,this.materials=!1,this.floorMeshes={},this.screensaving=!1,this.screensaver=!1,this.lights=[],this.setup=new WayfinderSetup3D(this)},startLoading:function(){Logistics.getJSON(WayfinderAPI["3d"].scene.url(),null,ClassCallback(this,this.onBundleData),{stage:"settings"})},onBundleData:function(t){this._super(t);var e=t.data;this.instances=e.instances,this.lights=e.lights;for(var i in e.meshes){var n={},o=e.meshes[i];for(var a in o)n[a]=o[a].name;this.floorMeshes["floor-meshes-"+i]={data:n}}if(e.meshesofinstances)for(var i in e.meshesofinstances){var n={},o=e.meshesofinstances[i];for(var a in o)n[a]=o[a].name;this.floorMeshes["floor-meshes-"+i]={data:n}}this.materials=e.materials,this.setup3D()},showFloor:function(t,e,i){this._super(t,e);this.logic&&this.logic.showFloor(t,e,i)},showPath:function(t,e,i,n){if(!(t instanceof NavigationNode))return[];var o=this.options.kiosk,a=t.id;if(this.logic)try{return this.logic.showPath(o,a,e,i,n)}catch(t){console.log("Warning: Could not show path from "+o+" to "+a,t)}return[]},showKiosk:function(t){this.setDefaultView(t)},setZoom:function(t){this.orbitController&&this.orbitController.setZoom(1-t)},zoomIn:function(){this.orbitController&&this.orbitController.zoomIn()},zoomOut:function(){this.orbitController&&this.orbitController.zoomOut()},setDefaultView:function(){this.logic&&this.logic.setDefaultView()},pathToText:function(t){var e=new Pathfinder3D(this.nodes,this.edges).pathToText(t);return this.textPathSimplification(e)},setup3D:function(){this.setupEngine()},setupEngine:function(t){var e="sorted";this.settings.getBoolean("camera.correct-transparency.enabled",!1)&&(e="blended",this.settings.getBoolean("camera.correct-transparency.stochastic-enabled",!1)&&(e="stochastic"));var i="forward";this.settings.getBoolean("camera.deferred-renderer.enabled",!1)&&(i="auto");var n=this.options.map;t&&(n=t),this.engine=new Engine(n,{requestedFPS:30,renderer:i,antialias:this.settings.getBoolean("camera.antialiasing.enabled",!1),ssao:this.settings.getBoolean("camera.ssao.enabled",!1),ssaoGDisplace:this.settings.getFloat("camera.ssao.gdisplace",.4),ssaoRadius:this.settings.getFloat("camera.ssao.radius",2),ssaoLuminanceInfluence:this.settings.getFloat("camera.ssao.luminance-influence",.7),ssaoBrightness:this.settings.getFloat("camera.ssao.brightness",1),transparencyMode:e,softShadows:this.settings.getBoolean("camera.deferred-renderer.soft-shadows",!1),assetsPath:this.options.assetsLocation,contextErrorCallback:ClassCallback(this,this.cbOnWebGLContextFail)});var o=document.getElementById(this.options.map);o.className+=" no-select",o.addEventListener("selectstart",function(t){},!1),"undefined"!=typeof window&&window.addEventListener("resize",ClassCallback(this,this.resize)),this.resize();var a=this;this.engine.assetsManager.shadersManager.shadersPath=this.options.assetsLocation,this.engine.assetsManager.modelsManager.createParser=function(t,e,i,n,o){var a=new ThreadedDataParser(t,e,i,n,o);return a.flipX=!0,a},this.engine.assetsManager.texturesManager.sourceCallback=function(t){return t},this.engine.assetsManager.texturesManager.descriptorCallback=function(t){return t.loadAsImage?(t.source=WayfinderAPI.images.get.url(t.source),t.parentDescriptor=!1,t):(t.parentDescriptor=!1,!1===a.options.textureLOD?t.source=WayfinderAPI.textures.texture.url(t.source):t.source=WayfinderAPI.textures.mipmap.url(a.options.textureLOD,t.source),t)};var s=this.building.getFloors();for(var r in s){var h=s[r],l=new Node("Level-"+h.index);if(l.addComponent(new FloorComponent(h)),l.addComponent(new FloorFlightComponent),h.node3D=l,!this.options.disableModelLoading){var d=new ModelDescriptor(WayfinderAPI.models.json.url(h.model_id),"json");l.addNode(this.engine.assetsManager.modelsManager.addDescriptor(d))}this.engine.scene.root.addNode(l)}this.engine.assetsManager.load(ClassCallback(this,this.onAssetsLoaded),function(t){"function"==typeof a.cbOnProgress&&a.cbOnProgress(t)}),this.setup.placeDynamicModels(this.instances)},placeDynamicModels:function(t){var e=this,i=new Node("Models-all"),n=t[0],o=!1;n.poi&&(o=this.pois[n.poi]);var a=new ModelDescriptor(WayfinderAPI.models.json.url(n.id),"json");n.node3D=this.engine.assetsManager.modelsManager.addDescriptor(a),this.engine.assetsManager.modelsManager.load(function(){var n=t[0];if(n.node3D&&n.instances){var a=n.instances[0];if(a.node3D=n.node3D.instantiate(),a.node3D.transform.setPosition(a.position),o&&(o.node.node3D=a.node3D),a.floor){var s=e.engine.scene.root.findChildWithName("Level-"+a.floor);s&&o?(o.node.position=a.position,o.setNode(o.node),s.addNode(o.node.node3D)):i.addNode(a.node3D)}else i.addNode(a.node3D)}e.engine.scene.root.addNode(i)})},onAssetsLoaded:function(){var t=this;this.dataLoaded||(this.dataLoaded=!0,this.onDataLoaded(),this.logic=new WayfinderLogic3D(this),this.engine.sceneStarted=function(){t.setup.setup(),"function"==typeof t.cbOnMapReady&&(t.cbOnMapReady(),t.addWatermark())},this.options.disableRendering||this.engine.run())},onProgress:function(t){"function"==typeof this.cbOnProgress&&this.cbOnProgress(t)},resize:function(){this._super(),this.engine&&this.engine.resize(),this.orbitController&&this.onZoomChange(this.orbitController.getZoom())},getNearestPOI:function(t,e){return this.logic?this.logic.getNearestPOI(t,e):null},showScreensaver:function(){if((!this.pathComponent||!this.pathComponent.path||this.pathComponent.finished)&&(this.clearHighlights(),this.showKiosk(),this.settings.getBoolean("kiosk.screensaver.enabled",!1)&&this.screensaver)){this.screensaving=!0;var t=[];for(var e in this.pois)this.pois[e].node_id in this.nodes&&this.pois[e].node_id!=this.options.kiosk&&this.pois[e].node_id!=this.screensaver.destNodeID&&t.push(this.pois[e].node_id);var i=t[Math.floor(Math.random()*t.length)];for(var e in this.nodes[i].pois)this.nodes[i].pois[e].show();var n=this;this.screensaver.setDestination(this.nodes[i],i,function(){if(n.nodes[i].pois)for(var t in n.nodes[i].pois)n.nodes[i].pois[t].hide()});for(var e in this.nodes[i].pois)this.nodes[i].pois[e].show()}},restoreDefaultState:function(){this._super(),this.pathComponent&&this.pathComponent.clearPath()},hideScreensaver:function(){this.screensaving=!1,this.screensaver&&this.screensaver.clearDestination(),this.restoreDefaultState()},setHighlights:function(t){this.clearHighlights(),this.poiController&&t&&this.poiController.setHighlights(t)},clearHighlights:function(){this.poiController&&this.poiController.clearHighlights()},setDisplaying:function(t){this.clearDisplaying(),this.poiController&&t&&this.poiController.setDisplaying(t)},clearDisplaying:function(){this.poiController&&this.poiController.clearDisplaying()},onSetLanguage:function(t){for(var e in this.pois){var i=this.pois[e];if(i.object&&!(i.object.subnodes.length<1)){var n=i.object.subnodes[0].getComponent(TextComponent);if(n){var o=i.getName(t);o&&n.setText(o)}}}},clearPath:function(){this.pathComponent&&this.pathComponent.clearPath()},zoomOnPathSegment:function(t,e){this.pathComponent.zoomOnPathSegment(t,e)},addWatermark:function(){var t=this;WayfinderAPI.access.hasWatermark(function(e){if(e.data){var i=document.getElementById(t.options.map),n=document.createElement("canvas");n.width="100",n.height="20",n.style.left="80%",n.style.bottom="5%",n.style.zIndex=1,n.style.position="absolute",n.style.pointerEvents="none";var o=n.getContext("2d"),a=document.createElement("img");a.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFUAAAAXCAYAAAB6ZQM9AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAABcSAAAXEgFnn9JSAAAAB3RJTUUH4AkJBzIUWG0KUAAACm1JREFUWMPtmMmvJUV2h79zIjLz3rzTu8MbqooagCpwF1DQBrwwiJK9sFreWJbsXvrP8LbFzvK6vWl57QWbljdWe2HZhXsSDTTFYANFU1Dzq5fvvnfnKSOOF3WrVdCAu0HqBql+u4yUIjO+OHHOL47wGXrJkCEkTXAFaANkBnod5i8KS+7rCyWfHvi+kbbgtIdTQB7BG7gALODaHN7Zh/0XBbuP77eA+s9GI4EnHTyl0AogETCgjLAwVhGuiOPiHlx6UVjdR/gFUP/BaOXwXBI5GwKpOSSAhFKIJphGG8/ARagkjBHeLj1vL1Nu34/aT8oDfM+QOZwK8Fi5JJtPIU6V/Tcz9t/MJCyV1kMrmo8tqOysZLSwhoNnlxO2xwNeBq7dR/kpqENwbdgBkjLC6EbCe/+Sy+Ufpcz3HaD4PJUjz1Ttsb9bWPWhAfND/HLEieWE40+/yo3XniH+odbQ6/VaIYSqqkYzG/X7/dFXOb2dTqdelmU5HA5nXxpqDrnCjkVkORWu/kdFigtHaFBl+3hOmqaMx2Nu/OSWeJ/Yg3+zJLgZGN6MbvtDkjt17PeuytbW1pOq+rBzzqsqZna90Wj8dDQafSkgnU6nniTJ886528Dr65Lyu0P10BZoR4PFQNl7vcpGtsO5Z5+kXq9z6dIljh8/TvJBwu4bV2XnT3KSkzNEQIR2u0LlDwBVtra2zqjqH8cY3wshXFZVBWw0Gn1p25ckiXPObTnnFuua87tD/Z6hHrYMqqGE1cgz21dYLEnTlCRJuHz5MmfOnKFer3OrEOb7icVNSDIQR12gBgx+z1ATETkBTIfD4Wvz+Xzwtcmpv7qIa6e0BHQ+huHHkUqWkec5k8mELMt49NFHiTFy+/ZtkooSlpHJLXAZpDUqktMCbtydc2Njo1uW5Wg8Hk/vyVNdYNnv94d3P95oNDoiQghhkWVZS0TqMcYQQjgYDoeHzWZzw3uv/X5//96IaTabnSRJmiLSAmKtVtuo1+v53fdlWU4PDw9H7Xa7W5bl2HufiEhXVf1iseiPRqP+PfNlnU6nJyK1GOM0hBCcc5+A1G63W6ra8d4nIYRRURR7QNlut1sxRhkMBvNut7u9WCwm4/G48Fd/SBg8zL4EVssR6WocSHozO7ixKz/+8W1EBFVlNpsxnU144KkKfmMpyxKCYeRkWcb2d/6N93/0l4Rer9fy3r8QQrg2Ho9fAUKn0+lmWfYXMcai1Wq9PBgM5rVarZbn+fkY41hE5iKyLSJmZpmqWpZlF0Wkp6pHe73efxVFcQug1WptVKvVP1sD3QAkSZLnRMRERM2spqrvNhqNd9I0PZ+m6UREPNAUkar3fp6m6Sv7+/uXms3mRrVafVZEjpnZAgjAQkRqZgYgvV7vjHPu8XWqNO99tr29/dFoNLqYJMk5EelkWTZX1aPOuYvj8bjvL7xIPP99Pq6n3Iolx2eDKGlnRHoysfG7icwOw52zljl2zuTUTg9tzhCXQt6DfBOvGccakTowWK1WE+996Zx7IM/zt6bT6dh7f8TM2iKSrmHMsyzbUNVtM7syn89vqur7i8ViWqlUWlmWvaCqj5RledU5t6GqR4FbAFmWbYtIN8Z4SUSOAVKW5U+ApYhsOOeeV9XczERV22bWNrM3QgivikjLe/9cmqZPNBqNolqtnhORU2b2elmWH8UYK2manjOzfB2h3SRJnokx7i+XyzdijMtKpXJGRJ7K83wA5Kr6oJldKcvylRDCNSB6gPGbHFa/zSXgiETSZZxRe2RozRNNm1zNsIXH10vx7aFNKKiGSOso1LrgPBKhm0EXGAwGg0WWZdedc09UKpXWdDpdqOoDMcabItJI03QLKLz322ZWxhivD4fDXSBtNps1ADObqmonxviWmR2o6slms/m/w+FwCRw3s9lisfhVlmVdEZF1FC96vd4SKAHWkWtmtjuZTN5Zp6LdnZ2dB0TkwTRNj4rIKeDK7u7um3Cnp9Hr9dQ594CZqff+hJnVQwivLpfLCcB8Pr+W5/kTzrmjgBORVQjh7aIo3v9E9X/tB8Q//yc+dMbjZmzHiAwHI2BsZc1D5qQMKytv34naKLBxEmR9HxMjVzjCS1zmu1iM8ZZz7ok0Tbv1en0J9MzsoqqeAHaq1epHInLUzPaKojjs9XrHVfVbqtpaV9w2EJ1zkxjjx6p6Lk3TzVarNXLOHQkhXJ/P54dZlv3/FkFkPB6P7zqTCExExDnnNkSkEkLYvQsUQFVHayejzrmeqja99083m80n1xuuQE1EKkA0s+lsNit+w1IBDC6yVz/JB2VJZzkiKWdQzk1iWMGdK74gmKYw3YVrP4fNx6F7GvMJXoXjf32M/IcwmUwmB81mc2hmW2maCmCLxeJapVLxqnqmUqnsAF0ze6vT6XS99y+Y2Wi5XL66Wq0O8zw/JyKnQwgB+FhVz6rqiTRN92OMaVmWH6Vp+tv2HewznkVVVUQQkc+0TGaGmbkY4yjG+B4w/dT76fq/gqrGz4T62g+I3/573lr1CasxmxZpI9QRKhgOQB34FESReR9uvootR9B7FNIGW3mkB0xms9m00WjsqupR731uZreHw+EwSZJbqvqtJElOi4iEEG5474+KSD2E8LN+v/8hIHme27pQUBRFf2dn56aqngI6wMFsNttLkuQr2Z4QwlREVsDmmkO5Hm967ysiEkMIB865YzHG/aIornzaOW1vb//R55r/u/rlP1KcPM9PV54kEWqktLyjI0IXpa2eugiVCIkYyWqCu/0WshgiW2fJq9sc4yWu8F1CjPGGqj7qnGuWZfkyUC6Xy4MkSUbOuYdijDeKojjc3NzcMTMVkVa73W6KSFdEjomIW6eCZQjhsvf+YWAjhPCz2Ww2SZIk+ypQzewwxnhNRB7a2toqQghXRKTmnDtrZlUzs7IsrzjnHvHeP9Xr9SSEcBhjFKAaQhh84Y3qXn18gXK9azOg4DyXN8FXK6QkVGVBNTpqqjQUGjFQ739ArVxSbT9E/a/aZP8K89VqVTjnDgBdrVY3AUaj0aJSqVz33m/FGK8A8xjjVVW9oarnsix7EFia2XhtbwCsLMubzrmxiOhqtboCxHUhmpjZr289q9UqOudGIjIVkRhjHMYY5/euryzLhfd+CEwWi8UblUolc849rapngZWZ9WOMHwHzg4OD3V6v9wvv/RPe+/Pe+/l6Qxar1eoXZjaLMY4+9/h/ri4Q9+4k8iUw/vX43yKnR2hs4AMk40tkUkVnqztJfzAYDFT1ZYDDw8O7hj9Op9N3syy7tVwuDwD29/f3W63WhUqlshlj1PXxHjnnmoPB4GBdbGoi4mOMHxwcHByu519471+5G83rsaGI/LeZLYfD4UBEXlbV6T0bxHQ6vZTn+a2iKApgVa1W/7Ner2+ZWQUYFUWx12g0qmtQq6Io/qfRaNzMsqyjqhVgFWMc9vv9vY2NjYmIZAcHB+Mv7Px/3dTtdrtJkvypiLTLsvz3vb293W9E6+/rql6vdyRJkueBVgjh53t7e7e/Mf3Ur6vMTEII+zHGXxZFcfnLdIzu6zelnU4n+yakqXv1f240JIAu0+pkAAAAAElFTkSuQmCC",a.onload=function(){o.drawImage(a,0,0)},i.parentElement.appendChild(n)}})},getFPS:function(){return Math.round(100*wayfinder.engine.fps.getAverage())/100},showModelInstance:function(t){return this.logic.showModelInstance(t)},hideModelInstance:function(t){return this.logic.hideModelInstance(t)},getImageData:function(t){if(!this.engine||!t)return!1;this.engine.captureScreenshot(t)}}),WayfinderOptions3D=WayfinderOptions.extend({init:function(){this._super(),this.application="3d",this.assetsLocation="/shared/",this.pathDisplayInstructions=!0,this.pathZoomPadding=100,this.pathColor="rgba(255,0,0,0.8)",this.pathPauseTime=2e3,this.pathSpotRadius=3,this.pathStride=30,this.pathSpeed=60,this.zoomPadding=1.05,this.poiColor="rgba(100,200,0,0.9)",this.poiRadius=9,this.textureLOD=0,this.debugTransparency=!1,this.disableModelLoading=!1,this.disableCollisionTrees=!1,this.disableRendering=!1}}),WayfinderSetup3D=Class.extend({init:function(t){this.wayfinder=t},setup:function(){var t=this.wayfinder.engine.scene;this.overrideBuildingMaterials(),this.setupPathComponent(t),this.setupScreensaverComponent(t),this.setupCamera(t),this.setupOrbitController(t),this.setupLights(t),this.setupPOIs(t),this.setupYAH(t),this.setupSkybox(t),t.cameraComponent.fitNodeToView(t.root),this.wayfinder.options.debugTransparency&&(t.cameraComponent.camera.renderStage=new DebugRenderStage(new TargetScreen,this.wayfinder.engine)),this.wayfinder.showKiosk()},setupCamera:function(t){t.camera.backgroundColor=this.wayfinder.settings.getColor("scene.background-color","#FFFFFF00"),t.cameraComponent instanceof PerspectiveCamera&&t.cameraComponent.setClipPlanes(this.wayfinder.settings.getFloat("camera.plane.near",.1),this.wayfinder.settings.getFloat("camera.plane.far",1e3))},setupPathComponent:function(t){var e=new Node;this.wayfinder.pathComponent=e.addComponent(new PathComponent(this.wayfinder.nodes,this.wayfinder)),t.root.addNode(e)},setupScreensaverComponent:function(t){if(this.wayfinder.settings.getBoolean("kiosk.screensaver.enabled",!1)){var e=new Node;this.wayfinder.screensaver=e.addComponent(new ScreensaverComponent(this.wayfinder)),t.root.addNode(e)}},setupOrbitController:function(t){var e=this.wayfinder.settings,i=t.root.addNode(new Node("CameraTarget")),n=t.cameraNode.addComponent(new WayfinderOrbitController(this.wayfinder));n.target.value=i.transform,n.distance=50,n.distanceSteps=64,n.minimumDistance=e.getFloat("camera.distance.min",10),n.maximumDistance=e.getFloat("camera.distance.max",100);var o=t.root.getBoundingBox();o&&(n.minimumPan[0]=o.min[0],n.minimumPan[1]=o.min[1],n.minimumPan[2]=o.min[2],n.maximumPan[0]=o.max[0],n.maximumPan[1]=o.max[1],n.maximumPan[2]=o.max[2]),n.minimumPitch=-Math.PI/2.2,n.maximumPitch=-.1,e.getBoolean("mouse.invert-buttons",!1)&&(n.panButton=0,n.rotateButton=2);var a=e.getBoolean("mouse.enable-rotation",!0);n.enableRotation(a);var s=e.getBoolean("mouse.enable-touch-rotation",!1);n.enableTouchRotation(s),this.wayfinder.orbitController=n;var r=this;n.cbOnChange=function(t,e){r.wayfinder.cbOnTouch(t,e)}},setupLights:function(t){var e=this.wayfinder.settings;t.light.intensity=e.getFloat("lights.directional.intensity",1),t.light.shadowCasting=e.getBoolean("lights.directional.shadows",!1),t.light.color=e.getColor("lights.directional.color",new Color(1,1,.98)),t.light.setLightDirection(vec3.fromValues(e.getFloat("lights.directional.direction-x",1),e.getFloat("lights.directional.direction-y",1),e.getFloat("lights.directional.direction-z",1)));var i=e.getColor("lights.ambient.color",new Color(.5,.5,.5)),n=t.lightNode.addComponent(new AmbientLight(i));!function(e){if(e){var i=!0,o=!0;for(var a in e){var s=e[a],r=s.color.split(" "),h=new Color(parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])),l=s.rotation.split(" "),d=quat.fromValues(parseFloat(l[0]),parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),c=vec3.transformQuat(vec3.create(),vec3.fromValues(0,-1,0),d),f=s.position.split(" "),u=vec3.fromValues(parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])),g=parseFloat(s.intensity);switch(s.type){case"point":var p=new Node("Omni");p.addComponent(new OmniLight(parseFloat(s.radius),h)).intensity=g,p.transform.setPosition(u),t.lightNode.addNode(p);break;case"ambient":if(o)n.color=h,o=!1;else{var m=new Node("Ambient");m.addComponent(new AmbientLight(h)).intensity=g,t.lightNode.addNode(m)}break;case"directional":if(i)t.light.intensity=g,t.light.color=h,t.light.setLightDirection(c),i=!1;else{var y=new Node("Directional");y.addComponent(new DirectionalLight(c,h)).intensity=g,t.lightNode.addNode(y)}}}}}(this.wayfinder.lights)},setupPOIs:function(t){var e=new Node("POIController"),i=e.addComponent(new POIController(this.wayfinder));t.root.addNode(e),this.wayfinder.poiController=i;var n=this.wayfinder.building.getFloors();for(var o in n){var a=n[o],s=this.wayfinder.floorMeshes["floor-meshes-"+a.id];if(s&&s.data){a.setMeshNames(s.data);for(var r in s.data)i.meshIDToPath[parseInt(r,10)]={path:s.data[r],floor:n[o]}}var h=new Node("pois");for(var l in a.pois)a.pois[l].createGeometry(this.wayfinder.engine,this.wayfinder),a.pois[l].object&&h.addNode(a.pois[l].object);a.node3D.addNode(h)}t.engine.assetsManager.texturesManager.load(function(){})},setupSkybox:function(t){var e=["scene.skybox.front","scene.skybox.back","scene.skybox.left","scene.skybox.right","scene.skybox.down","scene.skybox.up"],i=[],n=!1;for(var o in e){var a=this.wayfinder.settings.getInt(e[o],0);0!==a&&(n=!0);var s=new TextureDescriptor(a);s.loadAsImage=!0,i.push(s)}if(n){t.cameraNode.addComponent(new SkyboxComponent).setup(t.engine.assetsManager,t.engine,i)}},setupYAH:function(t){var e=this.wayfinder.getKioskNode();if(e&&e.floor&&e.floor.node3D){var i=this.wayfinder.settings,n=i.getInt("kiosk.you-are-here-image",0);if(0!==n&&this.wayfinder.options.drawKioskIcon){var o=t.engine,a=new TextureDescriptor(n);a.loadAsImage=!0;var s=new Material(o.assetsManager.addShaderSource("Transparent"),{diffuse:new UniformColor(new Color)},[new Sampler("diffuse0",o.assetsManager.texturesManager.addDescriptor(a))]);s.name="YAH_icon",s.shader.requirements.transparent=!0;var r=i.getFloat("poi.width",1),h=i.getFloat("poi.height",1),l=Primitives.plane(r,h,s);l.name="YAH";var d=l.getComponent(MeshRendererComponent);d.castShadows=!1,d.lightContribution=0,d.disable(),l.addComponent(new MeshCollider),l.addComponent(new Billboard(t.camera,!0)),l.addComponent(new YAHComponent(e,i)).offsetY=i.getFloat("poi.3d.offset",0),i.getBoolean("path.animation.yah",!1)&&l.addComponent(new AnimationComponent),l.getComponent(AnimationComponent)&&(l.getComponent(AnimationComponent).setLowestPosition(i.getFloat("poi.3d.offset",0)),l.getComponent(AnimationComponent).setHighestPosition(i.getFloat("path.animation.yah-highest-position",5)),l.getComponent(AnimationComponent).setAnimationSpeed(i.getFloat("path.animation.yah-speed",1)),l.getComponent(AnimationComponent).startAnimating()),l.layer=Layers.POI;var c=new Node("YAHLocation");mat4.fromTranslation(c.transform.relative,e.position),c.addNode(l),e.floor.node3D.addNode(c)}}},overrideBuildingMaterials:function(){var t={};for(var e in this.wayfinder.materials)t[this.wayfinder.materials[e].id]={parsed:this.wayfinder.materials[e],material:!1};var i=this.wayfinder.engine;i.scene.root.onEachChildComponent(function(e){if(e instanceof MeshComponent){m=(m=(m=e.node.path()).substring(6)).substring(0,m.indexOf("/"));v=!1;if(y=e.node.scene.root.findChildWithName(m)){(P=y.getComponent(FloorComponent))&&(v=P.floor.model_id)}for(var n in e.mesh.materials){var o=e.mesh.materials[n],a=!1;for(var s in t)if(t[s].parsed.name===o.name){if(0===t[s].parsed.model_id){a=t[s];break}t[s].parsed.model_id===v&&(a=t[s])}if(a)if(a.material)e.mesh.materials[n]=a.material;else{for(var r in a.parsed.uniforms){var h=(I=a.parsed.uniforms[r]).value.split(" "),l=!1,d=!1;switch(I.type){case"int":l=new UniformInt(parseInt(I.value));break;case"float":l=new UniformFloat(parseFloat(I.value));break;case"vec2":d=vec2.create(),l=new UniformVec2(d);break;case"vec3":d=vec3.create(),l=new UniformVec3(d);break;case"color":case"vec4":d=vec4.create(),l=new UniformVec4(d);break;case"mat4":d=mat4.create(),l=new UniformMat4(d)}if(d){for(var s in h)d[s]=parseFloat(h[s]);l.value=d}l&&(o.uniforms[I.name]=l)}if(o.shader=i.assetsManager.addShaderSource(a.parsed.shader),o.uniforms.diffuse.value[3]<1&&(o.shader=i.assetsManager.addShaderSource("transparent")),a.parsed.textures instanceof Array)for(var c in a.parsed.textures){var f=a.parsed.textures[c],u=!1;for(var g in o.samplers)if(o.samplers[g].name==f.sampler&&o.samplers[g].texture.name!=f.name){var p=new TextureDescriptor(f.name),c=i.assetsManager.texturesManager.addDescriptor(p);o.samplers[g]=new Sampler(f.sampler,c)}if(!u){var p=new TextureDescriptor(f.name),c=i.assetsManager.texturesManager.addDescriptor(p);o.samplers.push(new Sampler(f.sampler,c))}}a.material=o}}}else if(e instanceof MeshRendererComponent){var m=e.node.path();m=(m=m.substring(6)).substring(0,m.indexOf("/"));var y=e.node.scene.root.findChildWithName(m),v=!1;if(y){var P=y.getComponent(FloorComponent);P&&(v=P.floor.model_id)}for(var n in e.meshRenderers){var o=e.meshRenderers[n].material,a=!1;for(var s in t)if(t[s].parsed.name===o.name){if(0===t[s].parsed.model_id){a=t[s];break}t[s].parsed.model_id===v&&(a=t[s])}if(a)if(("transparent"==a.parsed.shader||o.uniforms.diffuse.value[3]<1)&&(e.meshRenderers[n].transparent=!0),a.material)e.meshRenderers[n].material=a.material;else{for(var r in a.parsed.uniforms){var I=a.parsed.uniforms[r],h=I.value.split(" "),l=!1,d=!1;switch(I.type){case"int":l=new UniformInt(parseInt(I.value));break;case"float":l=new UniformFloat(parseFloat(I.value));break;case"vec2":d=vec2.create(),l=new UniformVec2(d);break;case"vec3":d=vec3.create(),l=new UniformVec3(d);break;case"color":case"vec4":d=vec4.create(),l=new UniformVec4(d);break;case"mat4":d=mat4.create(),l=new UniformMat4(d)}if(d){for(var s in h)d[s]=parseFloat(h[s]);l.value=d}l&&(o.uniforms[I.name]=l)}if(o.shader=i.assetsManager.addShaderSource(a.parsed.shader),a.parsed.textures instanceof Array)for(var c in a.parsed.textures){var f=a.parsed.textures[c],u=!1;for(var g in o.samplers)if(o.samplers[g].name==f.sampler&&o.samplers[g].texture.name!=f.name){var p=new TextureDescriptor(f.name),c=i.assetsManager.texturesManager.addDescriptor(p);o.samplers[g]=new Sampler(f.sampler,c)}if(!u){var p=new TextureDescriptor(f.name),c=i.assetsManager.texturesManager.addDescriptor(p);o.samplers.push(new Sampler(f.sampler,c))}}a.material=o}}}}),i.assetsManager.load()},placeDynamicModels:function(t){var e,i=this,n=new Node("Models-all"),o=[];for(var a in t){var s=t[a];if(!o[s.model]){var r=new ModelDescriptor(WayfinderAPI.models.json.url(s.model),"json");e=this.wayfinder.engine.assetsManager.modelsManager.addDescriptor(r),o[s.model]=e}}this.wayfinder.engine.assetsManager.modelsManager.load(function(){for(var e in t){var a=t[e];if(o[a.model])if(a.node3D=o[a.model].instantiate(),a.node3D.transform.setPosition(a.position),a.floor){var s=i.wayfinder.engine.scene.root.findChildWithName("Level-"+a.floor);if(s){if(void 0===a.visible||a.visible||a.node3D.onEachChildComponent(function(t){t instanceof RendererComponent&&t.disable()}),a.node3D.visible=a.visible,s.addNode(a.node3D),a.poi){var r=i.wayfinder.pois[a.poi];r&&(r.node.position=a.position,r.setNode(r.node),s.addNode(r.node.node3D))}}else n.addNode(a.node3D)}else n.addNode(a.node3D)}i.wayfinder.engine.scene.root.addNode(n)})}}),WayfinderLogic3D=Class.extend({init:function(t){this.wayfinder=t,this.engine=t.engine,this.currentFloor=!1},showPath:function(t,e,i,n,o){if(!this.wayfinder.pathComponent)throw"Cannot show path: Wayfinder has no PathComponent reference.";var a=this.wayfinder.nodes[e];if(!a)throw"Destination node not found.";console.log("Path from: "+t+" to "+e,a),this.stopAnimatingAllPOIs(a.id);!n||n.displayDestinationOnStart;var s=new Date,r=s.getDay(),h=s.getHours(),l={},d={},c=[];for(var f in this.wayfinder.nodes){var u=this.wayfinder.nodes[f];if(this.wayfinder.attributes&&f in this.wayfinder.attributes&&"allowedTimes"in this.wayfinder.attributes[f]){var g,p=this.wayfinder.attributes[f];if(1==p.allowedTimes.length)g=p.allowedTimes[0];else{if(r>=p.allowedTimes.length){l[f]=u;continue}g=p.allowedTimes[r]}for(P=0;P<g.length;P+=2)if(h>=g[P]&&h<g[P+1]){l[f]=u;break}f in l||c.push(f)}if(this.wayfinder.attributes&&f in this.wayfinder.attributes&&"inaccessibility"in this.wayfinder.attributes[f]){var m=this.wayfinder.attributes[f].inaccessibility;this.wayfinder.accessibility&&-1!=m.indexOf(this.wayfinder.accessibility)?(c.push(f),f in l&&delete l[f]):-1==c.indexOf(f)&&(l[f]=u)}-1==c.indexOf(f)&&(l[f]=u)}for(var f in this.wayfinder.edges){var y=this.wayfinder.edges[f];if(-1===c.indexOf(f)){for(var v=[],P=0;P<y.length;P++)-1==c.indexOf(y[P])&&v.push(y[P]);d[f]=v}}var I=new Pathfinder3D(l,d).find(t,e);this.wayfinder.showFloor(this.currentFloor);var A=this.wayfinder.poiController;A.clearHighlights(),A.clearDisplaying();var w=this;if(this.wayfinder.pathComponent.setPath(I,function(){var t=w.wayfinder.getKioskNode();if("function"==typeof o&&o(I,e,i),t&&t.floor&&t.floor.node3D)t.floor.node3D.find("YAHLocation/YAH")}),this.wayfinder.settings.getBoolean("path.3d.display-poi-billboard",!1)&&(i?(A.setHighlights([i]),A.setDisplaying([i])):(A.setHighlights(a.pois),A.setDisplaying(a.pois))),this.wayfinder.settings.getBoolean("path.animation.poi",!0)){var b=i||a.pois[0];b.setAnimation(this.wayfinder.settings.getFloat("poi.3d.offset",0),this.wayfinder.settings.getFloat("path.animation.yah-highest-position",10),this.wayfinder.settings.getFloat("path.animation.yah-speed",.5)),b.startAnimating()}var C=w.wayfinder.getKioskNode();if(!C||!C.floor||!C.floor.node3D)return I;var W=C.floor.node3D.find("YAHLocation/YAH");if(!W)return I;var O=W.getComponent(AnimationComponent);return O&&O.startAnimating(),I},showFloor:function(t,e,i){function n(n,o){d.inflight--,(0===d.inflight||o)&&(i||(h.currentFloor.showYAH(),h.showFloorPOIs(h.currentFloor),h.showPathMeshes(h.currentFloor),function(){function t(t){t instanceof RendererComponent&&t.disable()}if(!1!==h.currentFloor)for(var e in l)l[e].index>h.currentFloor.index&&l[e].node3D.onEachChildComponent(t)}()),e&&e(t))}function o(t,e){t.onEachChild(s),n(0,e)}function a(t){if(!t.getComponent(POIComponent)&&!t.getComponent(YAHComponent)){var e=t.getComponent(RendererComponent);e&&(e.castShadows=!1)}}function s(t){if(!t.getComponent(POIComponent)&&!t.getComponent(YAHComponent)){var e=t.getComponent(RendererComponent);e&&(e.castShadows=!0)}}function r(t){if(!t.getComponent(POIComponent)&&!t.getComponent(YAHComponent)){var e=t.getComponent(RendererComponent);e&&(e.node&&e.node.parent&&void 0!==e.node.parent.visible&&!e.node.parent.visible?e.disable():e.enable())}}h=this;if(t instanceof Floor){this.currentFloor||(this.currentFloor=t);var h=this,l=this.wayfinder.building.getSortedFloors(),d={};d.inflight=0,this.currentFloor instanceof Floor&&(this.hideFloorPOIs(this.currentFloor),this.currentFloor===t&&this.showFloorPOIs(this.currentFloor));for(var c in l){var f=l[c];f.index>t.index?(d.inflight++,f.node3D.onEachChild(a),f.node3D.getComponent(FloorFlightComponent).fly(n)):f.index<=t.index&&f.index>this.currentFloor.index?(d.inflight++,f.node3D.onEachChild(r),f.node3D.getComponent(FloorFlightComponent).land(o)):(f.node3D.onEachChild(r),this.showPathMeshes(f))}if(this.currentFloor=t,this.wayfinder.pathComponent&&this.wayfinder.settings.getBoolean("path.3d.hide-above",!0)){var u=this.wayfinder.pathComponent.getInstancesAboveFloor(this.currentFloor);for(var c in u)u[c][0].disable(),u[c][1].disable(),u[c][2].disable()}this.currentFloor.showYAH()}},showFloorPOIs:function(t){this.hideAllPOIs(),t.showYAH(),this.wayfinder.poiController.showPOIs(t.pois)},hideFloorPOIs:function(t){t.hideYAH(),this.wayfinder.poiController.hidePOIs(t.pois)},hideAllPOIs:function(){var t=this.wayfinder.building.getFloors(),e=this.wayfinder.poiController;for(var i in t)t[i].hideYAH();e&&e.hidePOIs(this.pois)},stopAnimatingAllPOIs:function(t){var e=this.wayfinder.poiController;this.wayfinder.building.getFloors();e.stopAnimatingPOIs(this.wayfinder.pois,t)},showPathMeshes:function(t){var e=this.wayfinder.pathComponent;if(e&&e.finished){var i=e.getInstancesBelowFloor(t);for(var n in i)i[n][0].enable();i=e.getInstancesAtFloor(t);for(var n in i)i[n][0].enable()}},setDefaultView:function(t){this.wayfinder.pathComponent&&this.wayfinder.pathComponent.clearPath(),this.setKioskView(t)},setKioskView:function(t){this.wayfinder.clearHighlights(),this.wayfinder.clearDisplaying();var e=this.wayfinder.orbitController,i=vec3.fromValues(this.wayfinder.settings.getFloat("camera.target.x",0),this.wayfinder.settings.getFloat("camera.target.y",0),this.wayfinder.settings.getFloat("camera.target.z",0)),n=this.wayfinder.getKioskNode();e&&n&&(this.setNormalRotation(),vec3.set(e.pan,0,0,0),this.wayfinder.settings.getBoolean("camera.target.floor-center",!1)&&n.floor.node3D?vec3.add(i,n.floor.node3D.getBoundingSphere().center,i):vec3.add(i,n.position,i),e.target.value.setPosition(i),t?e.setZoom(t):n.zoom?e.setDistance(n.zoom):this.fitToView(),n&&n.floor&&this.wayfinder.showFloor(n.floor),this.wayfinder.onZoomChange(e.getZoom()))},setNodeView:function(t,e,i){var n=this.wayfinder.orbitController;if(n&&n.target&&!n.target.isNull()&&t){this.setNormalRotation();var o=vec3.create();vec3.add(o,o,t.position),vec3.scale(o,o,.5),vec3.scale(o,o,this.wayfinder.options.zoomPadding);var a=new BoundingSphere(o,t.position);a.encapsulateSphere(t.position),vec3.set(n.pan,0,0,0),n.target.value.setPosition(a.center),i&&this.setNormalRotation(t),e?n.setZoom(e):t.zoom?n.setDistance(t.zoom):this.fitToView(),this.wayfinder.showFloor(t.floor)}},fitToView:function(){var t=this.wayfinder.orbitController;if(t&&t.target&&!t.target.isNull()){var e=this.wayfinder.engine.scene;e.root.updateChildTransforms();var i=e.root.getBoundingBox(!0),n=vec3.fromValues(0,0,1),o=quat.identity(quat.create());quat.rotateY(o,o,t.rotation[1]),quat.rotateX(o,o,t.rotation[0]),vec3.transformQuat(n,n,o),vec3.negate(n,n),vec3.normalize(n,n);var a=new Plane;a.setByNormalAndPoint(n,i.center);var s=i.getVertices();for(var r in s)s[r]=a.projectToPlane(s[r]);var h=vec3.create(),l=vec3.create();vec3.copy(h,s[0]),vec3.copy(l,s[0]);for(f=1;f<8;f++)for(r=0;r<3;r++)s[f][r]<h[r]&&(h[r]=s[f][r]),s[f][r]>l[r]&&(l[r]=s[f][r]);var d=vec3.cross(vec3.create(),a.normal,[1,0,0]),c=vec3.cross(vec3.create(),d,a.normal);vec3.normalize(c,c),vec3.normalize(d,d);var f=vec3.sub(vec3.create(),l,h);this.wayfinder.options||(this.wayfinder.options=1.05);var u=1.05*Math.max(vec3.dot(c,f),vec3.dot(d,f)),g=Math.min(e.cameraComponent.getVerticalFieldOfView(),e.cameraComponent.getHorizontalFieldOfView())*Math.PI/180;t.setDistance(u/Math.sin(g/2)-u)}},setNormalRotation:function(t){t||(t=this.wayfinder.getKioskNode());var e=this.wayfinder.orbitController;if(e)if(t){e.rotation[0]=-t.rotation[0]/180*Math.PI;var i=Math.floor(Math.abs(e.currentRotation[1])/(2*Math.PI));e.currentRotation[1]<2*Math.PI?e.currentRotation[1]+=i*(2*Math.PI):e.currentRotation[1]-=i*(2*Math.PI);var n=t.rotation[1]/180*Math.PI;e.currentRotation[1]>n+Math.PI?e.rotation[1]=n+2*Math.PI:e.currentRotation[1]<n-Math.PI?e.rotation[1]=n-2*Math.PI:e.rotation[1]=n}else e.rotation[0]=e.minimumPitch,e.rotation[1]=0},getNearestPOI:function(t,e){function i(t){var e=t.length;if(e<2)return!1;for(var i=0,o=1;o<e;++o)i+=vec3.distance(n[t[o-1]].position,n[t[o]].position);return i}var n=this.wayfinder.nodes,o=this.wayfinder.edges;if(0==e.length||!(t in n))return null;var a=new Pathfinder3D(n,o),s=n[t];e.sort(function(t,e){var i=t.getNode(),n=e.getNode();if(!i&&!n)return 0;if(!i)return 1;if(!n)return-1;return vec3.squaredDistance(t.getNode().position,s.position)-vec3.squaredDistance(e.getNode().position,s.position)});for(var r,h,l=1/0,d=null,c=e.length,f=0;f<c;++f)if(r=a.find(t,e[f].getNode().id),h=i(r)){if(!(h<l))continue;l=h,d=e[f]}return d},hideModelInstance:function(t){t.node3D.onEachChildComponent(function(t){t instanceof RendererComponent&&(t.disable(),t.node&&t.node.parent&&void 0!==t.node.parent.visible&&(t.node.parent.visible=0))}),t.node3D.disable()},showModelInstance:function(t){t.node3D.onEachChildComponent(function(t){t instanceof RendererComponent&&(t.enable(),t.node&&t.node.parent&&void 0!==t.node.parent.visible&&(t.node.parent.visible=1))}),t.node3D.enable(),t.visible=1}}),FloorComponent=Component.extend({init:function(t){this._super(),this.floor=!1,t instanceof Floor3D&&(this.floor=t)},type:function(){return"FloorComponent"}}),FloorFlightComponent=Component.extend({init:function(){this._super("Floor Flight Component"),this.flightAltitude=500,this.flightMultiplier=5,this.originalRelative=!1,this.originalPosition=!1,this.destinationRelative=mat4.create(),this.destinationPosition=vec3.create(),this.offset=0,this.flying=!1,this.readyCallbacks=[]},type:function(){return"FloorFlightComponent"},fly:function(t){this.originalPosition||(this.originalRelative=mat4.clone(this.node.transform.relative),this.originalPosition=mat4.translation(vec3.create(),this.node.transform.relative)),mat4.translate(this.destinationRelative,this.originalRelative,[0,this.offset+this.flightAltitude,0]),mat4.translation(this.destinationPosition,this.destinationRelative),this.flying=!0,this.flightSpeed=0,t&&this.readyCallbacks.push(t)},land:function(t,e){this.originalPosition||(this.originalRelative=mat4.clone(this.node.transform.relative),this.originalPosition=mat4.translation(vec3.create(),this.node.transform.relative)),this.destinationRelative=mat4.clone(this.originalRelative),this.destinationPosition=mat4.clone(this.originalPosition),mat4.translate(this.node.transform.relative,this.node.transform.relative,[0,this.offset+this.flightAltitude,0]),this.offset>0&&(mat4.translate(this.destinationRelative,this.destinationRelative,[0,this.offset,0]),this.destinationPosition[1]+=this.offset),this.flying=!1,this.flightSpeed=0,t&&this.readyCallbacks.push(t)},setOffset:function(t){this.offset=t},isInPlace:function(){var t=mat4.translation(vec3.create(),this.node.transform.relative);return this.flying&&t[1]>=this.originalPosition[1]+this.flightAltitude||!this.flying&&t[1]<=this.originalPosition[1]},callReadyCallbacks:function(){if(0!=this.readyCallbacks.length){for(var t in this.readyCallbacks){(0,this.readyCallbacks[t])(this.node)}this.flying=!1,this.readyCallbacks=[]}},onUpdate:function(t){if(this.originalPosition){var e=mat4.translation(vec3.create(),this.node.transform.relative),i=0,n=Math.abs(this.destinationPosition[1]-e[1]);this.flying?e[1]<this.destinationPosition[1]?(i=t.fps.getDelta()*(1e3/(this.flightMultiplier*n)),e[1]+i>this.destinationPosition[1]&&(i=n)):this.callReadyCallbacks():e[1]>this.destinationPosition[1]?(i=t.fps.getDelta()/1e3*-(1+this.flightMultiplier*n),e[1]+i<this.destinationPosition[1]&&(i=-n)):this.callReadyCallbacks(),0!==i&&mat4.translate(this.node.transform.relative,this.node.transform.relative,[0,i,0])}}}),PathComponent=Component.extend({init:function(t,e){function i(t,i){var n=e.settings.getModel(t,0);if(n>0){return new ModelDescriptor(WayfinderAPI.models.json.url(n),"json")}return i}this._super(),this.wayfinder=e,this.nodes=t,this.speed=10,this.stepDistance=.5,this.floorPause=0,this.liftStepDistance=.5,this.liftingDistance=1,this.position=0,this.fpvPosition=1,this.finished=!1,this.paused=!1,this.floorTime=0,this.floorPaused=!1,this.followPath=!1,this.currentPathNode=!1,this.targetPosition=vec3.create(),this.targeting=!1,this.floorOffset=this.wayfinder.settings.getFloat("path.3d.floor-offset",0),this.floorsCovered=0,this.pathMeshSources={start:i("path.3d.model.start","models/PathStart.data"),middle:i("path.3d.model.middle","models/PathMiddle.data"),end:i("path.3d.model.end","models/PathEnd.data"),active:i("path.3d.model.active","models/PathMiddle.data"),liftUp:i("path.3d.model.liftup","models/PathLiftUp.data"),liftUpIn:i("path.3d.model.liftupin","models/PathLiftUp.data"),liftUpOut:i("path.3d.model.liftupout","models/PathLiftUp.data"),liftDown:i("path.3d.model.liftdown","models/PathLiftDown.data"),liftDownIn:i("path.3d.model.liftdownin","models/PathLiftDown.data"),liftDownOut:i("path.3d.model.liftdownout","models/PathLiftDown.data"),prestart:i("path.3d.model.prestart","models/PathStart.data"),premiddle:i("path.3d.model.premiddle","models/PrePathMiddle.data"),preend:i("path.3d.model.preend","models/PathEnd.data"),preliftUp:i("path.3d.model.preliftup","models/PathPreLiftUp.data"),preliftUpIn:i("path.3d.model.preliftupin","models/PathPreLiftUp.data"),preliftUpOut:i("path.3d.model.preliftupout","models/PathPreLiftUp.data"),preliftDown:i("path.3d.model.preliftdown","models/PathPreLiftDown.data"),preliftDownIn:i("path.3d.model.preliftdownin","models/PathPreLiftDown.data"),preliftDownOut:i("path.3d.model.preliftdownout","models/PathPreLiftDown.data"),belowstart:"models/PathStart.data",belowmiddle:"models/PathMiddle.data",belowend:"models/PathStart.data",belowliftUp:"models/PathLiftUp.data",belowliftUpIn:"models/PathLiftUp.data",belowliftUpOut:"models/PathLiftUp.data",belowliftDown:"models/PathLiftDown.data",belowliftDownIn:"models/PathLiftDown.data",belowliftDownOut:"models/PathLiftDown.data"},this.pathMeshes={},this.resetStructures()},type:function(){return"PathComponent"},resetStructures:function(){this.path=!1,this.totalPathLength=0,this.floor=!1,this.cbOnFinish=!1,this.pathMeshFloors=[],this.pathMeshInstances=[],this.pathWaitingInstances=[],this.position=0,this.fpvPosition=1,this.floorPause=0,this.floorTime=0,this.floorPaused=!1,this.floorsCovered=0},onStart:function(t,e){for(var i in this.pathMeshSources){var n=this.pathMeshSources[i];n instanceof ModelDescriptor?this.pathMeshes[i]=e.assetsManager.modelsManager.addDescriptor(n):this.pathMeshes[i]=e.assetsManager.addModel(n)}var o=this;e.assetsManager.load(function(){for(var t in o.pathMeshes)o.pathMeshes[t].onEachChildComponent(function(t){t instanceof RendererComponent&&(t.castShadows=!1,t.lightContribution=0)})})},setPath:function(t,e){if(this.clearPath(),this.path=t,this.cbOnFinish=e,this.finished=!1,this.stepDistance=this.wayfinder.settings.getFloat("path.3d.stride",1),this.speed=this.wayfinder.settings.getFloat("path.3d.speed",10),this.fpvSpeed=this.wayfinder.settings.getFloat("camera.first-person.speed",10),this.floorPause=this.wayfinder.settings.getFloat("path.floor.pause",0),this.followPath=this.wayfinder.settings.getBoolean("path.3d.follow-path",!1),this.firstPersonView=this.wayfinder.settings.getBoolean("camera.first-person.enabled",!1),this.firstPersonView){var i=this.node.scene.cameraComponent.node.getComponent(OrbitController);i&&(this._minimumDistance=i.minimumDistance,i.minimumDistance=this.wayfinder.settings.getFloat("camera.first-person.eye-height",1.68))}var n=this.wayfinder.settings.getFloat("path.3d.size",1),o=vec3.fromValues(n,n,n);if(t){if(t.length<2)return;var a=this,s=function(t,e,i,n,s){function r(t){var e=a.pathMeshes[t].instantiate();return e.transform.translate(i),e.transform.scale(o),n&&e.transform.rotate(n,[0,1,0]),a.node.addNode(e),e.pathNode=s,e}var h=r(e),l=r("pre"+e),d=r("below"+e),c=r("active");h.disable(),d.disable(),c.disable();var f=[h,l,d,c];return a.pathMeshInstances.push(f),a.pathWaitingInstances.push(f),a.pathMeshFloors.push(t),h},r=function(t,e,i,n,o,r,h){for(var l=vec3.subtract(vec3.create(),n,i),d=o,c=a.stepDistance,f=vec3.length(l);d<f-r;)s(t,e,vec3.add(vec3.create(),i,vec3.scale(vec3.create(),l,d/f)),Math.PI/2-Math.atan2(l[2],l[0]),h),d+=c;return d-f-r},h=this.nodes[t[0]],l=this.nodes[t[t.length-1]];s(h.floor,"start",h.position,!1,h);for(var d=this.nodes[t[0]].position,c=a.stepDistance,f=h,u=vec3.create(),g=vec3.create(),p=1;p<t.length;p++){var m=this.nodes[t[p]];if(m){var y=m.floor;u=vec3.clone(m.position),f.floor_id!=m.floor_id&&this.floorOffset>0||vec3.add(u,u,g);var v=vec3.subtract(vec3.create(),u,d);if(this.totalPathLength+=vec3.length(v),f.floor_id!=m.floor_id&&this.floorOffset>0){0,g[1]+=this.floorOffset;vec3.add(u,u,g);c=r(y,"liftUp",d,u,c,0,m)}else vec2.length(vec2.fromValues(v[0],v[2]))<2*this.stepDistance&&v[1]>this.liftingDistance?(c=0,this.liftStepDistance?c=r(y,"liftUp",d,u,c,0,m):s(y,"liftUp",d,!1,m)):vec2.length(vec2.fromValues(v[0],v[2]))<2*this.stepDistance&&v[1]<-this.liftingDistance?(c=0,this.liftStepDistance?c=r(y,"liftDown",d,u,c,0,m):s(y,"liftDown",u,!1,m)):c=r(y,"middle",d,u,c,p+1==t.length?a.stepDistance/2:0,m);d=u,f=m}}s(l.floor,"end",u,!1,l)}this.firstPersonView?this.showLastFloor(!1):this.showCurrentFloor(!1),this.node.updateChildTransforms(),this.wayfinder.settings.getBoolean("path.3d.top-down",!1)&&this.setTopView(),this.followPath&&this.zoomOnPath(this.node.getBoundingSphere(),h.position)},clearPath:function(){this.resetStructures(),this.node.removeSubnodes();for(var t in this.wayfinder.building.floors)this.wayfinder.building.floors[t].node3D.getComponent(FloorFlightComponent).setOffset(0)},setTopView:function(){var t=this.node.scene.cameraComponent.node.getComponent(OrbitController);if(t&&t.target&&!t.target.isNull()){t.rotation[0]=-1.53588974,t.rotation[2]=0;var e=this.wayfinder.getKioskNode();e&&e.zoom&&t.setDistance(e.zoom)}},zoomOnPath:function(t,e){if(t){var i=this.node.scene.cameraComponent.node.getComponent(OrbitController);if(i&&i.target&&!i.target.isNull()){this.previousRotationSpeed||(this.previousRotationSpeed=i.speed,i.speed=this.wayfinder.settings.getFloat("path.3d.camera-speed",2));var n=vec3.create();vec3.sub(n,e,t.center),vec3.scale(n,n,2/3),vec3.add(n,t.center,n);var o=new BoundingSphere(n,t.radius);o.encapsulateSphere(t),vec3.set(i.pan,0,0,0),vec3.copy(this.targetPosition,o.center),this.targeting=!0;var a=2.2*o.radius,s=Math.min(this.node.scene.cameraComponent.getVerticalFieldOfView(),this.node.scene.cameraComponent.getHorizontalFieldOfView())*Math.PI/180;i.setDistance(.5*(a/Math.sin(s/2)-o.radius));var r=this.wayfinder.getKioskNode();if(r&&!this.wayfinder.settings.getBoolean("path.3d.top-down",!1)){i.rotation[0]=-r.rotation[0]/180*Math.PI;var h=Math.floor(Math.abs(i.currentRotation[1])/(2*Math.PI));i.currentRotation[1]<2*Math.PI?i.currentRotation[1]+=h*(2*Math.PI):i.currentRotation[1]-=h*(2*Math.PI);var l=r.rotation[1]/180*Math.PI;i.currentRotation[1]>l+Math.PI?i.rotation[1]=l+2*Math.PI:i.currentRotation[1]<l-Math.PI?i.rotation[1]=l-2*Math.PI:i.rotation[1]=l}else i.rotation[0]=-1.53588974;this.wayfinder.cbOnZoomChange&&"function"==typeof this.wayfinder.cbOnZoomChange&&this.wayfinder.cbOnZoomChange(i.getZoom())}}},calcLerp:function(t,e){var i=this.node.scene.cameraComponent.node.getComponent(OrbitController),n=t.transform.getPosition(),o=i.target.value.getPosition();return vec3.lerp(o,o,n,Math.min(1,e*i.speed)),o},moveOnPoint:function(t){var e=this.node.scene.cameraComponent.node.getComponent(OrbitController);e&&e.target&&!e.target.isNull()&&e.target.value.setPosition(t)},zoomOnPoint:function(t){if(t){var e=this.node.scene.cameraComponent.node.getComponent(OrbitController);if(e&&e.target&&!e.target.isNull()){var i=this.fpvPosition,n=Math.floor(i),o=!1;if(!(n+1>=this.pathMeshInstances.length)){n+2==this.pathMeshInstances.length&&(o=!0);var a=this.pathMeshInstances[n][0].transform.getPosition(),s=this.pathMeshInstances[n+1][0].transform.getPosition(),r=null;o||(r=this.pathMeshInstances[n+2][0].transform.getPosition());var h=vec3.create();vec3.sub(h,s,a);var l=vec3.sub(vec3.create(),s,a),d=null;o||(d=vec3.sub(vec3.create(),r,s)),vec3.scale(h,h,i-n),vec3.add(h,a,h),h[1]+=this.wayfinder.settings.getFloat("camera.first-person.eye-height",1.68);var c=new BoundingSphere(h,t.radius);vec3.set(e.pan,0,0,0),e.target.value.setPosition(c.center);c.radius,Math.min(this.node.scene.cameraComponent.getVerticalFieldOfView(),this.node.scene.cameraComponent.getHorizontalFieldOfView()),Math.PI;e.setDistance(0),e.rotation[0]=0;var f=3*Math.PI/2-Math.atan2(l[2],l[0]);f+=Math.PI,f%=2*Math.PI;var u=f-=Math.PI,g=0;if(!o){for(g=3*Math.PI/2-Math.atan2(d[2],d[0]),g+=Math.PI,g%=2*Math.PI,g-=Math.PI;Math.abs(g-f)>Math.PI;)g-f<0?g+=2*Math.PI:f+=2*Math.PI;u=f+(g-f)*(i-n),u+=Math.PI,u%=2*Math.PI,u-=Math.PI}for(;Math.abs(u-e.rotation[1])>Math.PI;)u-e.rotation[1]<0?u+=2*Math.PI:u-=2*Math.PI;e.rotation[1]=u,this.wayfinder.cbOnZoomChange&&"function"==typeof this.wayfinder.cbOnZoomChange&&this.wayfinder.cbOnZoomChange(e.getZoom())}}}},zoomBetweenNodes:function(t,e){if(t&&e){var i=this.node.scene.cameraComponent.node.getComponent(OrbitController);if(!i||!i.target||i.target.isNull())return;var n=Math.min(this.node.scene.cameraComponent.getVerticalFieldOfView(),this.node.scene.cameraComponent.getHorizontalFieldOfView())*Math.PI/180;distance=vec3.create(),vec3.sub(distance,t.position,e.position);var o=1.1*vec3.length(distance);i.setDistance(o/Math.sin(n/2)-o),this.wayfinder.cbOnZoomChange&&"function"==typeof this.wayfinder.cbOnZoomChange&&this.wayfinder.cbOnZoomChange(i.getZoom())}},onUpdate:function(t){if(this.path&&!this.paused&&!this.finished){var e=t.fps.getDelta()/1e3;if(this.floorPaused)this.showCurrentFloor(e);else{var i=this.node.scene.cameraComponent.node.getComponent(OrbitController);if(i&&this.targeting){var n=vec3.create();i.target.value.getPosition(n),vec3.lerp(n,n,this.targetPosition,Math.min(1,e*i.speed)),i.target.value.setPosition(n)}var o=this.position,a=this.fpvPosition;if(this.position+=e*this.speed,this.position>=this.pathMeshInstances.length&&!this.firstPersonView)this.finished=!0,this.onPathFinished(this.path),this.cbOnFinish&&this.cbOnFinish();else if(this.fpvPosition>=this.pathMeshInstances.length-3&&this.firstPersonView){this.finished=!0;var s=this;console.log("First person view finished2"),setTimeout(function(){s.onPathFinished(this.path),s.wayfinder.setDefaultView()},this.wayfinder.settings.getInt("camera.first-person.delay-end",100)),s.cbOnFinish&&s.cbOnFinish()}var r=!0;if(this.firstPersonView&&!this.wayfinder.settings.getBoolean("camera.first-person.show-path",!0)&&(r=!1),r){for(var h=Math.floor(o),l=Math.floor(this.position),d=l-h+h;h<=l&&!(h>=this.pathMeshInstances.length);h++)h==d?this.pathMeshInstances[h][3].enable():(this.pathMeshInstances[h][0].enable(),this.pathMeshInstances[h][3].disable()),this.pathMeshInstances[h][0].pathNode!==this.currentPathNode&&(this.currentPathNode=this.pathMeshInstances[h][0].pathNode,this.wayfinder.cbOnPathStep(this.pathMeshInstances[h][0].pathNode)),this.pathMeshInstances[h][1].disable(),this.pathWaitingInstances.shift();if(this.followPath&&!this.firstPersonView&&h<this.pathMeshInstances.length){f=this.calcLerp(this.pathMeshInstances[h][0],e);this.moveOnPoint(f)}}var c=Math.floor(a);if(this.firstPersonView&&c<this.pathMeshInstances.length){c<2&&(e/=10-3*(this.fpvPosition+1));var f=this.calcLerp(this.pathMeshInstances[c][0],e*this.fpvSpeed),u=(c>=1?this.pathMeshInstances[c-1][0].transform.getPosition():i.target.value.getPosition(),vec3.distance(this.pathMeshInstances[c][0].transform.getPosition(),i.target.value.getPosition())),g=vec3.distance(i.target.value.getPosition(),f);this.moveOnPoint(f),this.zoomOnPoint(this.node.getBoundingSphere()),u>0?this.fpvPosition+=g/u:this.fpvPosition++}this.firstPersonView||this.showCurrentFloor(e)}}},onPathFinished:function(t){if(this.targeting=!1,this.previousRotationSpeed){var e=this.node.scene.cameraComponent.node.getComponent(OrbitController);if(e){var i=this.node.scene.engine.fps.getDelta()/1e3*e.speed*2;i=Math.min(i,1),e.rotation[0]=lerp(e.currentRotation[0],e.rotation[0],i),e.rotation[1]=lerp(e.currentRotation[1],e.rotation[1],i),e.distance=lerp(e.currentDistance,e.distance,i),e.speed=this.previousRotationSpeed}delete this.previousRotationSpeed}"function"==typeof this.wayfinder.cbOnPathFinished&&this.wayfinder.cbOnPathFinished(t)},showCurrentFloor:function(t,e){var i=Math.floor(this.position);if(!(i>=this.pathMeshInstances.length)&&(this.floor!=this.pathMeshFloors[i]||this.floorPaused)){if(!this.floorPaused){var n=this.floor;this.floor=this.pathMeshFloors[i],this.wayfinder.cbOnBeforeFloorChange&&n&&this.wayfinder.cbOnBeforeFloorChange(n,this.floor,this.pathMeshFloors[this.pathMeshFloors.length-1]),this.floorOffset&&this.floorOffset>0&&(this.floor.node3D.getComponent(FloorFlightComponent).setOffset(this.floorOffset*this.floorsCovered),this.floorsCovered++)}if(t){if(this.floorPaused=!0,this.floorTime+=t,this.floorTime<this.floorPause)return;this.floorPaused=!1,this.floorTime=0}var o=this;this.floor.id!==this.wayfinder.getCurrentFloor().id&&(this.paused=!0,this.wayfinder.showFloor(this.floor,function(t){o.wayfinder.cbOnFloorChange&&o.wayfinder.cbOnFloorChange(t),o.paused=!1}))}},showLastFloor:function(){var t=this.wayfinder.building.getSortedFloors()[0],e=this;this.paused=!0,this.wayfinder.showFloor(t,function(t){e.paused=!1})},getInstancesAtFloor:function(t){var e=[];for(var i in this.pathMeshFloors)this.pathMeshFloors[i]===t&&e.push(this.pathMeshInstances[i]);return e},getInstancesBelowFloor:function(t){var e=[];for(var i in this.pathMeshFloors)this.pathMeshFloors[i].index<t.index&&e.push(this.pathMeshInstances[i]);return e},getInstancesAboveFloor:function(t){var e=[];for(var i in this.pathMeshFloors)this.pathMeshFloors[i].index>t.index&&e.push(this.pathMeshInstances[i]);return e},zoomOnPathSegment:function(t,e){for(var i=0;i<this.pathMeshInstances.length;i++)if(this.pathMeshInstances[i][0].pathNode==e){this.position=i,this.showCurrentFloor(100);var n=this.calcLerp(this.pathMeshInstances[i][0],1e3);return this.moveOnPoint(n),void this.zoomBetweenNodes(t,e)}}}),ScreensaverComponent=Component.extend({init:function(t){this._super(),this.wayfinder=t,this.destination=!1,this.destNodeID=-1,this.waitTime=1,this.waitedTime=0,this.preWaitedTime=0,this.distance=0,this.minimumDistance=0,this.originalDistance=1,this.paused=!1,this.movementSpeed=5,this.finishFunction=!1},type:function(){return"ScreensaverComponent"},setDestination:function(t,e,i){this.destination=t,this.destNodeID=e,this.finishFunction=i,this.waitedTime=0,this.preWaitedTime=0,this.movementSpeed=this.wayfinder.settings.getFloat("kiosk.screensaver.speed",5);var n=this.node.scene.cameraComponent.node.getComponent(OrbitController);if(n&&n.target&&!n.target.isNull()){var o=vec3.sub(vec3.create(),this.destination.position,n.target.value.getPosition());this.distance=vec3.length(o),this.minimumDistance=n.minimumDistance,this.originalDistance=n.distance-this.minimumDistance,this.showCurrentFloor()}},clearDestination:function(){this.destination=!1,this.finFun&&this.finFun()},onUpdate:function(t){if(this.destination&&!this.paused){var e=t.fps.getDelta()/1e3,i=this.node.scene.cameraComponent.node.getComponent(OrbitController);if(!i||!i.target||i.target.isNull())return;if(i.rotation[0]=-1,this.preWaitedTime<this.waitTime)return void(this.preWaitedTime+=e);var n=this.destination.position,o=this.movementSpeed*e,a=vec3.sub(vec3.create(),n,i.target.value.getPosition());if(vec3.length(a)<o){if(i.target.value.setPosition(n),this.waitedTime+=e,this.waitedTime>this.waitTime)return this.finFun&&this.finFun(),void this.wayfinder.showScreensaver()}else{var s=vec3.normalize(vec3.create(),a);vec3.scale(s,s,o);var r=vec3.add(vec3.create(),i.target.value.getPosition(),s);i.target.value.setPosition(r)}i.setDistance(this.minimumDistance+this.originalDistance*(vec3.length(a)/this.distance))}},showCurrentFloor:function(){var t=this;t.paused=!0,this.wayfinder.showFloor(this.destination.floor,function(e){t.paused=!1})}}),DistanceScalingComponent=Component.extend({init:function(t){if(this._super(),this.camera=t,!(this.camera instanceof Camera))throw"DistanceScalingComponent.camera is not an instance of Camera";this.minScale=1,this.maxScale=15,this.doingIt=!0,this.v=vec3.create(),this.cameraPosition=vec3.create(),this.localPosition=vec3.create(),this.localRotation=quat.create()},type:function(){return"DistanceScalingComponent"},onUpdate:function(t){if(this.enabled&&this.doingIt){this.node.transform.getPosition(this.v),this.camera.getPosition(this.cameraPosition),vec3.sub(this.v,this.v,this.cameraPosition);var e=.1*vec3.len(this.v);e=e<this.minScale?this.minScale:e>this.maxScale?this.maxScale:e,vec3.set(this.v,e,e,e),mat4.translation(this.localPosition,this.node.transform.relative),quat.fromMat4(this.localRotation,this.node.transform.relative),mat4.fromRotationTranslationScale(this.node.transform.relative,this.localRotation,this.localPosition,this.v)}}}),AnimationComponent=Component.extend({init:function(){this._super(),this.lowestPosition=vec3.create(),this.highestPosition=vec3.create(),this.animationPositions=[vec3.create(),vec3.create()],this.animating=!1,this.t=0,this.animationSpeed=1,this.direction=1,this.finish=!1,this.defaultPosition=vec3.create(),this.localPosition=vec3.create(),this.localRotation=quat.create(),this.localScale=vec3.create(),this.timeout=1e4},type:function(){return"AnimationComponent"},startAnimating:function(){this.animating||(this.t=0,this.direction=1,this.animating=!0,mat4.decompose(this.defaultPosition,this.localRotation,this.localScale,this.node.transform.relative),vec3.add(this.animationPositions[0],this.lowestPosition,this.defaultPosition),vec3.add(this.animationPositions[1],this.highestPosition,this.defaultPosition),this.finish=!1)},stopAnimating:function(){this.animating&&(this.animating=!1,this.finish=!0,mat4.fromRotationTranslationScale(this.node.transform.relative,this.localRotation,this.defaultPosition,this.localScale))},finishAnimating:function(){this.finish=!0},onUpdate:function(t){if(this.enabled&&this.animating){if(mat4.decompose(this.localPosition,this.localRotation,this.localScale,this.node.transform.relative),vec3.lerp(this.localPosition,this.animationPositions[0],this.animationPositions[1],this.t),this.t+=t.fps.getDelta()*this.animationSpeed*.001,this.t>=1){if(this.finish&&this.direction<0)return;this.animationPositions.reverse(),this.t=0,this.direction*=-1}mat4.fromRotationTranslationScale(this.node.transform.relative,this.localRotation,this.localPosition,this.localScale)}},setLowestPosition:function(t){this.lowestPosition=vec3.fromValues(0,t,0)},setHighestPosition:function(t){this.highestPosition=vec3.fromValues(0,t,0)},setAnimationSpeed:function(t){this.animationSpeed=t},setAnimationTime:function(t){this.timeout=t}}),POIComponent=Component.extend({init:function(t,e,i){this._super(),this.poi=!1,t instanceof POI3D&&(this.poi=t),this.debugLine=i,this.kioskNode=e,this.highlightDuration=5,this.highlightSpeed=1,this.highlightColors=[vec4.fromValues(1,0,0,1),vec4.fromValues(1,1,0,1)],this.dehighlightColor=vec4.fromValues(0,0,0,1),this.highlighting=!1,this.dehighlighting=!1,this.t=0,this.originalMaterial=!1,this.currentColor=new UniformVec4([1,1,1,1]),this.offsetY=0,this.width=1,this.height=1,this.textSize=1,this.textColor=new Color(1,1,1,1),this.outlineColor=new Color(0,0,0,0),this.outlineWidth=5,this.outline=!0,this.backgroundColor=new Color(0,0,0,0),this.groupColor=null,this.disableBillboard=!1,this.billboardClickable=!0,this.heightFromFloor=!0},type:function(){return"POIComponent"},excluded:function(){return["originalMaterial"]},dehighlight:function(){if(this.poi&&this.poi.submesh){this.dehighlighting=!0,this.startTime=(new Date).getTime();var t=this.poi.meshNode.getComponent(MeshRendererComponent).getSubmeshRenderer(this.poi.submesh);t&&t.material&&"diffuse"in t.material.uniforms&&(this.originalMaterial=t.material,this.dehighlightColor[3]=this.originalMaterial.uniforms.diffuse.value[3],vec4.copy(this.currentColor.value,this.dehighlightColor),t.material=t.material.instantiate(),t.material.uniforms.diffuse=this.currentColor)}},startHighlight:function(){if(this.poi&&this.poi.submesh){this.highlighting=!0,this.startTime=(new Date).getTime(),this.t=0;var t=this.poi.meshNode.getComponent(MeshRendererComponent).getSubmeshRenderer(this.poi.submesh);if(t&&t.material&&"diffuse"in t.material.uniforms){this.originalMaterial=t.material;for(var e in this.highlightColors)this.highlightColors[e][3]=this.originalMaterial.uniforms.diffuse.value[3];vec4.copy(this.currentColor.value,this.highlightColors[0]),t.material=t.material.instantiate(),t.material.uniforms.diffuse=this.currentColor,t.material.uniforms.ambient=this.currentColor}}},stopHighlight:function(){if(this.highlighting=!1,this.dehighlighting=!1,!1!==this.originalMaterial){var t=this.poi.meshNode.getComponent(MeshRendererComponent).getSubmeshRenderer(this.poi.submesh);t&&(t.material=this.originalMaterial),this.originalMaterial=!1}},onUpdate:function(t,e){if(this.highlighting||this.dehighlighting){((new Date).getTime()-this.startTime<=1e3*this.highlightDuration||Math.abs(this.highlightDuration)<1e-5)&&this.highlighting&&(vec4.lerp(this.currentColor.value,this.highlightColors[0],this.highlightColors[1],this.t),this.t+=t.fps.getDelta()*this.highlightSpeed*.001,this.t>=1&&(this.highlightColors.reverse(),this.t=0))}},onStart:function(){if(this.poi){this.poi.linkMesh();var t=vec3.fromValues(this.width,this.height,1),e=this.node.getComponent(TextComponent);if(e&&(e.color=this.textColor,e.backgroundColor=this.backgroundColor,e.outline=this.outline,e.outlineColor=this.outlineColor,e.outlineWidth=this.outlineWidth,e.updateText(),vec3.set(t,this.textSize,this.textSize,this.textSize)),this.poi.meshNode&&this.disableBillboard)this.positionToMeshCenter();else if(this.heightFromFloor){var i=this.poi.floor.node3D.getBoundingBox(),n=new Plane;n.setByNormalAndPoint([0,-1,0],i.max);var o=n.getDistanceToPoint(this.poi.node.position);o<0&&(o=0),mat4.fromRotationTranslationScale(this.node.transform.relative,quat.create(),[0,o+this.offsetY,0],t)}else mat4.fromRotationTranslationScale(this.node.transform.relative,quat.create(),[0,this.offsetY,0],t);if(this.groupColor&&this.poi.meshNode){var a=this.poi.meshNode.getComponent(MeshRendererComponent).getSubmeshRenderer(this.poi.submesh);if(a){var s=a.material;if(s&&s.uniforms&&"diffuse"in s.uniforms){var r=s.instantiate(),h=vec3.create();vec3.scale(h,this.groupColor,.7),vec3.max(h,h,vec3.fromValues(0,0,0)),a.material=r,vec4.copy(r.uniforms.diffuse.value,this.groupColor),vec4.copy(r.uniforms.ambient.value,h)}}}}},getConcaveHull:function(t,e){function i(t,e){var i=t[0]*e[1]-t[1]*e[0];return Math.atan2(i,vec2.dot(t,e))}function n(t,e,n){var o=function(t){for(var e=[],i=0;i<h.length;i+=3)for(var n=0;n<3;n++)if(h[i+n]==t){-1==e.indexOf(h[i+(n+1)%3])&&e.push(h[i+(n+1)%3]),-1==e.indexOf(h[i+(n+2)%3])&&e.push(h[i+(n+2)%3]);break}return e}(t),a=new Array;for(var s in o)-1==n.indexOf(o[s])&&a.push(o[s]);return function(t,e,n){for(var o=1e20,a=-1,s=0;s<n.length;s++){var h=i(t,vec2.normalize(vec2.create(),vec2.sub(vec2.create(),r[e],r[n[s]])));h<o&&(o=h,a=n[s])}return a}(e,t,a)}if(this.poi.submesh){var o=this.poi.meshNode.getComponent(MeshRendererComponent).getSubmeshRenderer(this.poi.submesh),a=o.submesh,s=o.matrix,r=(this.poi.node.rotation&&(this.poi.node.rotation[1],Math.PI),[]);if(a.faces){for(var h=a.faces.slice(),l=(mat2.create(),vec3.create(),0);l<a.positions.length;l+=3){var d=vec3.transformMat4(vec3.create(),vec3.fromValues(a.positions[l],a.positions[l+1],a.positions[l+2]),s);r.push(vec2.fromValues(d[0],d[2]))}for(var c=0,l=1;l<r.length;l++)r[l][0]>r[c][0]&&(c=l);var f=new Array,u=vec2.fromValues(1,0),g=c,p=r.length+1,m=new Array;for(m.push(g);p>0;){for(;m.length>2;)m.shift();var y=n(g,u,m);if(-1==y)break;if(m.push(y),f.push(y),vec2.normalize(u,vec2.sub(u,r[g],r[y])),(g=y)==c)break;p--}if(p){var v=new Array;for(var l in f)v.push(r[f[l]]);return v}}}},calculateEdgeAngleFromAxis:function(t,e){var i=vec2.fromValues(e[0]-t[0],e[1]-t[1]),n=vec2.fromValues(1,0),o=vec2.fromValues(-1,0),a=vec2.dot(i,o),s=vec2.len(i)*vec2.len(o),r=vec2.dot(i,n),h=vec2.len(i)*vec2.len(n),l=Math.acos(r/h),d=Math.acos(a/s);return d<l?[d,-1]:[l,1]},calculateRotatedAreaBounds:function(t){for(var e,i,n,o,a=1/0,s=0,r=0,h=0,l=1,d=vec2.create(),c=vec2.create(),f=0;f<t.length-1;f++)h=-1===(r=this.calculateEdgeAngleFromAxis(t[f],t[f+1]))[1]?r[0]:Math.PI-r[0],i=this.calculateBounds(t,h),Math.abs(i[2]*i[3])<a?(a=Math.abs(i[2]*i[3]),n=t[f],o=t[f+1],e=i,s=(l=r[1])*r[0]):Math.abs(i[2]*i[3])==a&&(vec2.sub(c,n,o),vec2.sub(d,t[f],t[f+1]),vec2.len(c),vec2.len(d)>vec2.len(c)&&(a=Math.abs(i[2]*i[3]),n=t[f],o=t[f+1],e=i,s=(l=r[1])*r[0]));if(!e)return!1;var u=vec2.fromValues(e[0],e[1]),g=vec2.fromValues(e[2]/2,e[3]/2);return g=this.rotatePoint(g,s),-1==l?vec2.add(g,u,g):vec2.sub(g,u,g),{edge:[n,o,vec2.sub(vec2.create(),n,o),this.getOrientation(n,o,g)],angle:s,bounds:{corner:u,width:e[2],height:e[3]},center:g,direction:l}},calculateBounds:function(t,e){for(var i,n=1/0,o=1/0,a=-1/0,s=-1/0,r=0;r<t.length;r++)i=t[r],e&&(i=this.rotatePoint(i,e)),n=Math.min(n,i[0]),o=Math.min(o,i[1]),a=Math.max(a,i[0]),s=Math.max(s,i[1]);return i=this.rotatePoint(vec2.fromValues(n,o),-e),[i[0],i[1],a-n,s-o,a,s]},rotatePoint:function(t,e){var i=t[0]*Math.cos(e)-t[1]*Math.sin(e),n=t[1]*Math.cos(e)+t[0]*Math.sin(e);return vec2.fromValues(i,n)},getOrientation:function(t,e,i){var n=(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1]);return n>0?-1:n<0?1:0},positionToMeshCenter:function(){if(this.kioskNode){var t=this.poi.meshNode.getComponent(MeshRendererComponent).getSubmeshRenderer(this.poi.submesh),e=this.node.getComponent(MeshRendererComponent);if(e&&e.meshRenderers&&e.meshRenderers[0]){var i,n=e.meshRenderers[0].globalBoundingBox,o=t.globalBoundingBox,a=t.localBoundingBox,s=new Plane,r=0,h=this.getConcaveHull(o.center,this.poi.getName("en")),l=Math.min(a.size[0],a.size[1]);s.setByNormalAndPoint([0,-1,0],o.max);var d=s.getDistanceToPoint(this.poi.node.position);d<0&&(d=0);var c=vec3.fromValues(o.center[0]-this.poi.node.position[0],this.poi.node.position[1]+d+.15,o.center[2]-this.poi.node.position[2]);h&&this.kioskNode?(i=this.calculateRotatedAreaBounds(h))&&i.bounds?(l=i.bounds.width,r=Math.round(i.angle*(180/Math.PI)+this.kioskNode.rotation[1]),vec3.set(c,i.center[0]-this.poi.node.position[0],c[1],i.center[1]-this.poi.node.position[2])):console.warn("no area",this.poi.getName("en"),i,h):console.warn("nohull",this.poi.getName("en"),h);Math.min(a.size[0],a.size[1]);var f=l/n.size[0],u=vec3.fromValues(.95*f,.95*f,1);mat4.fromRotationTranslationScale(this.node.transform.relative,quat.euler(quat.create(),-90,r,0),c,u)}else console.warn(this.poi.getName("en"),"no meshRenderers",e.meshRenderers)}}}),POIController=Controller.extend({init:function(t){this._super("POI Controller"),this.wayfinder=t,this.meshIDToPath={},this.highlights=[],this.displaying=[],this.deHighlightPOIs=this.wayfinder.settings.getBoolean("poi.dehighlight.enabled",!1)},type:function(){return"POIController"},getMeshInfo:function(t,e){if(!t||!e)return!1;var i=!1,n=[],o=t.getComponent(MeshComponent);if(o){var a=o.mesh;for(var s in a.submeshes)if(a.submeshes[s]===e){i=a.getMaterial(e.materialIndex),n.push("mesh-"+s);break}}for(var r=t,h=!1;r;){if(r.getComponent(FloorComponent)){h=r.getComponent(FloorComponent).floor;break}n.push(r.name),r=r.parent}return n.reverse(),{path:n.join("/"),floor:h,material:i}},getMeshInfoByID:function(t){return t in this.meshIDToPath&&this.meshIDToPath[t]},onClick:function(t,e,i,n){var o=this.node.scene.cameraComponent.screenPointToRay(t);if(o){var a=this.node.scene.dynamicSpace.rayCast(o,Layers.POI),s=a.nearest();if(s){var r=s.collider.node.getComponent(POIComponent);r&&this.onPOIClick(r.poi)}else if(a=this.node.scene.dynamicSpace.rayCast(o,Layers.Default),s=a.nearest()){var h=this.getMeshInfo(s.node,s.submesh),l=h.floor.getMeshIDByPath(h.path);if(l){for(var d in h.floor.pois)if(h.floor.pois[d].mesh_id==l)return void this.onPOIClick(h.floor.pois[d],t,n);if(this.wayfinder.settings.getBoolean("poi.3d.check-other-floors",!1))for(var d in this.wayfinder.pois)if(this.wayfinder.pois[d].mesh_id==l)return void this.onPOIClick(this.wayfinder.pois[d],t,n)}else if(this.wayfinder.settings.getBoolean("poi.3d.check-other-floors",!1))for(var d in this.wayfinder.pois)if(this.wayfinder.pois[d].mesh_name==h.path)return void this.onPOIClick(this.wayfinder.pois[d],t,n);if(this.wayfinder.logic.currentFloor){var c=this.wayfinder.logic.currentFloor.pois,f=this.wayfinder.settings.getFloat("poi.activation.radius",10),u=this.wayfinder.settings.getFloat("poi.activation.duration",3);for(var d in c)if(c[d].object&&"utility"!=c[d].type&&!c[d].visible){var g=mat4.translation(vec3.create(),c[d].object.transform.absolute);vec3.distance(g,s.point)<=f&&c[d].show(u)}}}}},onPOIClick:function(t,e,i){this.clearHighlights(),this.setHighlights([t]),this.wayfinder.onPOIClick(t,e,i)},setHighlights:function(t){if(t&&"object"==typeof t){for(var e,i=0;i<t.length;i++)(e=t[i])instanceof POI3D&&(this.highlights.push(e),e.highlight());if(this.deHighlightPOIs)for(var i in this.wayfinder.pois)(e=this.wayfinder.pois[i])instanceof POI3D&&!(e in this.highlights)&&e.dehighlight()}},clearHighlights:function(){for(var t=0;t<this.highlights.length;t++)this.highlights[t].stopHighlight();this.highlights.length=0},setDisplaying:function(t){var e;if(t&&"object"==typeof t)for(var i=0;i<t.length;i++)(e=t[i])instanceof POI3D&&(e.show(),this.displaying.push(e))},clearDisplaying:function(){for(var t,e=0;e<this.displaying.length;e++)(t=this.displaying[e]).isAlwaysVisible()||t.hide();this.displaying.length=0},hidePOIs:function(t){for(var e in t)t[e]in this.displaying||t[e].hide()},showPOIs:function(t){for(var e in t)(t[e].alwaysVisible||"utility"==t[e].type||this.poiInArray(t[e],this.displaying))&&t[e].show()},stopAnimatingPOIs:function(t,e){for(var i in t)e&&t[i].node_id==e||t[i].stopAnimating()},poiInArray:function(t,e){for(var i in e)if(e[i].id==t.id)return!0;return!1}}),WayfinderOrbitController=SmoothOrbitController.extend({init:function(t){this._super(),this.wayfinder=t,this.lastPinch=0,this.lastRotation=0,this.lastDeltaX=0,this.lastDeltaY=0,this.rotatingEnabled=!0,this.rotatingTouchEnabled=!0},setZoom:function(t){this._super(t),this.wayfinder.onZoomChange(this.getZoom())},zoomIn:function(t){this._super(t),this.wayfinder.onZoomChange(this.getZoom())},zoomOut:function(t){this._super(t),this.wayfinder.onZoomChange(this.getZoom())},onMouseMove:function(t,e,i){!1!==this.rotateButton&&e==this.panButton&&this.rotatingEnabled&&this.rotate(i[1],i[0]),!1!==this.panButton&&e==this.rotateButton&&this.move(i[0],i[1])},onPan:function(t,e,i,n){var o=vec2.len(e),a=.8*o;this.rotatingTouchEnabled?("panup"===n.type&&this.rotate(-o,0),"pandown"===n.type&&this.rotate(o,0),"panleft"===n.type&&this.rotate(0,-a),"panright"===n.type&&this.rotate(0,a)):this.move(e[0],e[1])},onMultiDrag:function(t){var e=t.gesture;Math.abs(e.angle)>100&&("down"==e.direction?this.rotate(0,1):"up"==e.direction&&this.rotate(0,1))},onRotate:function(t,e,i,n){this.rotatingEnabled&&this.rotateY(e)},rotateX:function(t){var e=t*(Math.PI/180);this.rotation[0]=this.rotation[0]+e},rotateY:function(t){var e=t*(Math.PI/180);this.rotation[1]=this.rotation[1]+e},rotateZ:function(t){var e=t*(Math.PI/180);this.rotation[2]=this.rotation[2]+e},onDrag:function(t){t.gesture.preventDefault(),t.gesture&&(this.move(-(t.gesture.deltaX-this.lastDeltaX),-(t.gesture.deltaY-this.lastDeltaY)),this.lastDeltaX=t.gesture.deltaX,this.lastDeltaY=t.gesture.deltaY)},onTouchRelease:function(){this.lastPinch=0,this.lastRotation=0,this.lastDeltaY=0,this.lastDeltaX=0},move:function(t,e){var i=vec3.create();vec3.scale(i,this.panXAxis,-t),vec3.add(i,i,vec3.scale(vec3.create(),this.panYAxis,-e)),i=vec3.scale(i,i,this.distance/900);var n=quat.fromMat4(quat.create(),this.node.transform.absolute),o=vec3.fromValues(0,0,1);vec3.transformQuat(o,o,n);var a=Math.atan2(o[2],o[0]);a-=Math.PI/2,quat.identity(n),quat.rotateY(n,n,a),quat.conjugate(n,n),quat.normalize(n,n),vec3.transformQuat(i,i,n),vec3.add(this.pan,this.pan,i),this.pan[0]=Math.max(this.pan[0],this.minimumPan[0]),this.pan[1]=Math.max(this.pan[1],this.minimumPan[1]),this.pan[2]=Math.max(this.pan[2],this.minimumPan[2]),this.pan[0]=Math.min(this.pan[0],this.maximumPan[0]),this.pan[1]=Math.min(this.pan[1],this.maximumPan[1]),this.pan[2]=Math.min(this.pan[2],this.maximumPan[2]),this.onChange("move",t,e)},enableRotation:function(t){this.rotatingEnabled=t},enableTouchRotation:function(t){this.rotatingTouchEnabled=t}}),YAHComponent=Component.extend({init:function(t,e){this._super("YAH Component"),this.kioskNode=t,this.offsetY=0,this.settings=e},type:function(){return"YAHComponent"},onStart:function(){if(this.kioskNode){var t=this.kioskNode.floor.node3D.getBoundingBox(),e=0;if(this.settings.getBoolean("poi.3d.height-from-floor-enabled")){var i=new Plane;i.setByNormalAndPoint([0,-1,0],t.min),e=i.getDistanceToPoint(this.kioskNode.position)}e<0&&(e=0),mat4.fromRotationTranslation(this.node.transform.relative,quat.create(),[0,e+this.offsetY,0])}}});