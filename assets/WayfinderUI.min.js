var UserInterface3D=UserInterface.extend({init:function(wayfinder){this._super(wayfinder)},setDocumentTitle:function(){if(this.wayfinder.building.name.length>0)document.title=this.wayfinder.building.name+" - 3D Wayfinder"}});var UserInterfaceLandscape3D=UserInterface3D.extend({init:function(wayfinder){this._super(wayfinder);this.tabs=new Tabs($("#left-menubar"));this.resize();if(wayfinder.options.debugTranslations)this.wayfinder.translator.showUntranslated()},onDataLoaded:function(){this.setup();this.tabs.resize()},setup:function(){this._super();this.poiInfoTab=this.tabs.add("poi-info",new POIInfo($("#poi-info"),this));this.setupMenuTabs();this.setupTabsMenu();this.setupTopMenus();this.setupBanners();this.onSetupFinished()},resize:function(){var canvas=$("#"+this.wayfinder.options.map);canvas.attr("width",canvas.css("width"));canvas.attr("height",canvas.css("height"));this.wayfinder.resize()},onProgress:function(progress){this.loadingScreen.setProgress(progress)},onSetLanguage:function(language){this._super(language);this.tabs.update()},setupTabsMenu:function(){this.tabsMenu=new TabsMenu($("#tabs-menu"),this,this.tabs)},setupMenuTabs:function(){this.atozMenu=this.tabs.add("az",new AtoZMenu($("#atoz-menu"),this));this.floorsMenu=this.tabs.add("floors",new FloorsMenu($("#floors-menu"),this));this.topicsMenu=this.tabs.add("topics",new TopicsMenu($("#topics-menu"),this));this.searchMenu=this.tabs.add("search",new SearchMenu($("#search-search-tab"),this));this.poiInfo=this.tabs.add("poi-info",new POIInfo($("#poi-info"),this));this.floorButtonsMenu=new FloorButtonsMenu($("#floors"),this.wayfinder.building.getFloors(),this);this.tabs.activateTab("az")},setupTopMenus:function(){this.languagesMenu=new FlagsMenu($("#languages-menu"),this);this.facilitiesMenu=new FacilitiesMenu($("#facilities-menu"),this)},displayPOIInfo:function(poi){this.tabs.getTab("poi-info").getPanel().setup(poi);this.tabs.activateTab("poi-info")},showPath:function(poi){this._super(poi);var path=this.wayfinder.showPath(poi.node,poi,{displayDestinationOnStart:true})},displayGroup:function(group){this.searchMenu.getPanel().search("group:"+group.getID());this.tabs.activateTab("search")},onFloorChange:function(floor){this.floorButtonsMenu.activateFloor(floor)},onMapPOIClick:function(poi){this._super(poi);this.poiInfo.getPanel().setup(poi);this.tabs.activateTab("poi-info");this.showPath(poi);this.wayfinder.setDisplaying([poi])},showUsersLocation:function(){this.wayfinder.showKiosk()}});var DealsMenuItem=MenuItem.extend({init:function(ad,ui){this.ui=ui;this.ad=ad;this.wayfinder=ui.wayfinder;this._super(ad.id);this.setup(ad)},createElement:function(){this.element=$("<div class='deal'></div>");this.image=$("<div class='image' name='image'></div>");this.slogan=$("<div class='slogan' name='slogan'></div>");this.poi=$("<div class='poi' name='poi'></div>");this.element.append(this.image).append(this.slogan).append(this.poi)},setup:function(ad){var language=this.wayfinder.getLanguage();var apiLocation=this.wayfinder.options.apiLocation;if(ad.image_id>0)Logistics.getImage(apiLocation+"?class=PublicImages&method=getImage&parameters=["+ad.image_id+"]&echo_out=true",ClassCallback(this,this.setImage));else this.image.hide();this.slogan.html(ad.text1[language]);this.poi.html(ad.poi.getName(language))},setImage:function(image){this.image.css("background-image","url("+image.src+")")}});var UserMessage=Class.extend({init:function(key,type,wayfinder,callback){this.wayfinder=wayfinder;this.type=type;this.key=key;this.callback=callback;this.timeout=15e3;this.draw()},draw:function(){this.element=$("<div class='message "+this.type+"'></div>");var cur_lang=this.wayfinder.translator.getLanguage();this.wayfinder.translator.translateElement(this.element,this.key);this.element.hammer().on("tap",ClassCallback(this,this.onClick));setTimeout(ClassCallback(this,this.close),this.timeout);this.wayfinder.options.messages.append(this.element)},close:function(){var element=this.element;if(element){this.element.hide(200,function(){element.remove()});delete this.element}},onClick:function(){this.close();if(this.callback&&typeof this.callback){this.callback(this)}}});var FloorButtonsMenu=Menu.extend({init:function(element,floors,ui){this.floors=floors;this.ui=ui;this.wayfinder=ui.wayfinder;this._super(element);this.setup()},setup:function(){this.clear();var floorsUtility=new ArrayUtility(this.floors);var language=this.wayfinder.getLanguage();var sortedFloors=floorsUtility.sort(function(a,b){return a.index<b.index});for(var i in sortedFloors){var name=sortedFloors[i].names.get(language);if(name&&typeof name==="string"&&sortedFloors[i].showInMenu){var arr=name.split(" ");if(arr.length>0)name=arr[0];var item=this.add(new MenuItem(name));item.element.addClass("floor-"+sortedFloors[i].getID());item.setDataObject(sortedFloors[i])}}this.publish()},onItemClick:function(item){this.ui.setFloor(item.getDataObject())},activateFloor:function(floor){for(var i in this.items){if(this.items[i].getDataObject()==floor){this.activateItem(this.items[i]);return}}},update:function(){this.setup()}});var AtoZMenu=ScrollableMenu.extend({init:function(element,ui){this._super(element);this.ui=ui;this.wayfinder=ui.wayfinder;this.setup()},setup:function(){var pois=this.sortPOIs(this.ui.wayfinder.pois);var language=this.ui.wayfinder.getLanguage();var group_names="";var groups=null;for(var i in pois){groups=pois[i].getGroupNames();if(groups&&groups[language]){group_names=groups[language].join(", ")}else{group_names=""}var item=this.add(new ValueMenuItem(pois[i].getName(language),group_names));item.setDataObject(pois[i]);if(pois[i].getAdvertisements().length>0){item.addClass("has_ads")}}this.publish()},sortPOIs:function(pois){var newArray=[];var language=this.wayfinder.getLanguage();for(var i in pois){if(pois[i].getName(language)&&pois[i].getShowInMenu())newArray.push(pois[i])}newArray.sort(function(a,b){if(a.getName(language)&&b.getName(language))return a.getName(language).toLowerCase().trim().localeCompare(b.getName(language).toLowerCase().trim())});return newArray},onItemClick:function(item){this.wayfinder.statistics.onClick(item.getDataObject().id,"menu");this._super(item);this.ui.displayPOIInfo(item.getDataObject())},onSetLanguage:function(language){this.clear();this.setup()},update:function(){this.clear();this.setup()}});var POIInfo=ScrollableComponent.extend({init:function(element,ui){this._super(element);this.poi=null;this.ui=ui;this.wayfinder=this.ui.wayfinder;this.translator=this.wayfinder.translator;this.name=this.element.find("[name='name']");this.description=this.element.find("[name='description']");this.groups=this.element.find("[name='groups']");this.image=this.element.find("[name='image']").hide();this.loadingImage=this.element.find("[name='loading-image']").hide();this.background=this.element.find("[name='background']").hide();this.logo=this.element.find("[name='logo']").hide();this.floor=this.element.find("[name='floor']");this.deals=this.element.find("[name='deals']");this.showPath=this.element.find("[name='show-path']");this.dealsMenu=new Menu(this.deals);this.dealsMenu.onItemClick=ClassCallback(this,this.onDealClick);this.hide()},update:function(){if(this.poi){this.setup(this.poi)}},setup:function(poi,options){this.poi=poi;if(this.poi&&this.poi instanceof POI){this.reset();this.element.removeClass("hasBackground");this.element.removeClass("hasLogo");this.background.hide();this.logo.hide();this.showPath.unbind("tap");this.showPath.hammer().on("tap",ClassCallback(this,this.onShowPath));this.wayfinder.translator.translateElement(this.showPath,"show_path");this.name.unbind("tap");this.name.html(this.poi.getName(this.wayfinder.getLanguage()));this.name.hammer().on("tap",ClassCallback(this,this.onNameClick));if(poi.descriptions.get(this.wayfinder.getLanguage())){this.description.html(this.parseDescription(poi.descriptions.get(this.wayfinder.getLanguage()).replace(/\r\n/g,"<br />").replace(/\n/g,"<br />"),options))}else this.description.html("");this.setupPhone();this.generateFloor();this.generateAds();this.wayfinder.translator.setElement(this.showPath,"show_path");this.groups.html(this.generateGroups());if(this.poi.background_id){Logistics.getImage(WayfinderAPI.getURL("images","get",[this.poi.background_id]),ClassCallback(this,function(data){if(data){this.element.addClass("hasBackground");this.background.css("background-image","url("+data.src+")");this.background.show()}}))}if(this.poi.image_id){if(this.poi.getIcon()){this.logo.css("background-image","url("+this.poi.getIcon().src+")");this.logo.show();this.element.addClass("hasLogo")}}this.resize()}},setupPhone:function(){this.description.find("span.phone").hammer().on("tap",function(event){event.gesture.preventDefault();document.location="tel:"+$(this).attr("data-number")})},generateFloor:function(){if(this.poi.getFloor()){this.floor.show();this.floor.html(this.poi.getFloor().getName(this.wayfinder.getLanguage()))}else{this.floor.hide()}},generateGroups:function(){var resultElement=$("<span></span>");var poiGroups=this.poi.groups;var count=0;for(var groupIndex in poiGroups){var poiGroup=poiGroups[groupIndex];var nameElement=$("<span></span>");nameElement.html(poiGroup.getName(this.wayfinder.getLanguage()));var me=this;nameElement.unbind("tap");resultElement.append(nameElement);count++;if(count<poiGroups.length)resultElement.append(", ")}return resultElement},generateAds:function(){var ads=this.poi.getAdvertisements();var item=false;if(ads){this.dealsMenu.clear();for(var i in ads){item=this.dealsMenu.add(new DealsMenuItem(ads[i],this.ui))}}},onShowPath:function(event){this.ui.showPath(this.poi)},onFloorClick:function(){},onNameClick:function(poi){},onDealClick:function(item){},parseDescription:function(item,options){return item}});var SearchMenu=ScrollableMenu.extend({init:function(element,ui){this._super(element);this.ui=ui;this.wayfinder=ui.wayfinder;this.searchParams=[];this.limit=0;this.searchstring="";this.setupSettings()},setupSettings:function(){this.scoreLimit=this.wayfinder.settings.getFloat("ui.search.score-difference-limit",this.wayfinder.options.searchScroreLimiter);this.descriptionScoreDown=this.wayfinder.settings.getFloat("ui.search.description-scoredown",.7);this.tagsScoreDown=this.wayfinder.settings.getFloat("ui.search.tags-scoredown",.7);this.roomIdScoreDown=this.wayfinder.settings.getFloat("ui.search.tags-room-id",.7);this.limit=this.wayfinder.settings.getInt("ui.search.limit",-1);this.minimumScore=this.wayfinder.settings.getFloat("ui.search.minimum-score",this.wayfinder.options.searchMinimumScrore);this.wayfinder.search.overrideOptions({maxSearchParams:15,stringSearch:"relative",minimumScore:this.minimumScore,splitKeywords:true,limit:this.limit===-1?Infinity:this.limit,scoreLimit:this.scoreLimit,poi:{name:1,description:this.descriptionScoreDown,tags:this.tagsScoreDown,room_id:this.roomIdScoreDown}})},search:function(searchstring){if(typeof searchstring!=="undefined"&&searchstring!==""){this.searchstring=searchstring;this.element.removeClass("no-results");var searchParams=this.parseSearchString(searchstring.trim().toLowerCase());for(param in searchParams){if(typeof searchParams[param]=="object"){switch(searchParams[param][0]){case"floor":var pois=wayfinder.building.floors[searchParams[param][1]].pois;this.addPOIs2Menu(this.sortPOIs(pois));break;case"group":var pois=wayfinder.poiGroups[searchParams[param][1]].pois;this.addPOIs2Menu(this.sortPOIs(pois));break}this.publish();this.update();return}}var foundPOIs=this.wayfinder.search.search(searchstring);this.addPOIs2Menu(foundPOIs);this.publish();this.update();if(foundPOIs.length===0){this.element.addClass("no-results");this.element.removeClass("successful-search");this.wayfinder.statistics.onSearch(searchstring,"unsuccessful")}else{this.element.addClass("successful-search");this.wayfinder.statistics.onSearch(searchstring,"successful")}}},displayAtoZ:function(floorId){var foundPOIs=[];var pois=this.sortPOIs(this.wayfinder.pois);for(var i in pois){foundPOIs.push(pois[i])}this.addPOIs2Menu(foundPOIs);this.publish();this.resize()},findWithChar:function(character){var foundPOIs=[];var language=this.wayfinder.getLanguage();foundPOIs[0]=[];var pois=this.sortPOIs(this.wayfinder.pois);for(var i in pois){if(pois[i].getShowInMenu()&&pois[i].getName(language).charAt(0)==character){foundPOIs[0].push(pois[i])}}this.addPOIs2Menu(foundPOIs);this.publish();this.resize()},addPOIs2Menu:function(searchResult){var count=0;var sorted=[];var poi;var item;for(var s=0;s<searchResult.length;s++){if(searchResult[s]){poi=searchResult[s];item=this.createItem(poi);this.add(item);if(poi.getAdvertisements().length>0){item.addClass("has_ads")}}}},createItem:function(poi){if(!poi)return;var language=this.wayfinder.getLanguage();var group_names="";if(poi.getGroupNames){var groups=poi.getGroupNames();if(groups&&groups[language]){group_names=groups[language].join(", ")}}var item=new ValueMenuItem(poi.getName(language),group_names);item.setDataObject(poi);return item},parseSearchString:function(searchstring){if(typeof searchstring==="string"){var items=searchstring.split(" ");var keywords=[];for(var i in items){keywords.push(this.findSearchParameters(items[i]))}return keywords}else{return[]}},findSearchParameters:function(string){var items=string.split(":");var newItems=[];if(items.length>1){for(var i in items){newItems.push(items[i].trim())}return newItems}else return string.trim()},getSearchStrings:function(params){var searchKeys=[];for(var j in params){if(typeof params[j]==="string"){searchKeys.push(params[j])}}return searchKeys},onItemClick:function(item,event){this._super(item);var poi=item.getDataObject();this.wayfinder.statistics.onClick(poi.id,"menu");this.ui.displayPOIInfo(poi,event)},sortPOIs:function(pois){var newArray=[];var language=this.wayfinder.getLanguage();for(var i in pois){if(pois[i].getName(language)&&pois[i].getShowInMenu())newArray.push(pois[i])}newArray.sort(function(a,b){return a.getName(language).trim().toLowerCase().localeCompare(b.getName(language).trim().toLowerCase())});return newArray}});var ZoomSlider=UIComponent.extend({init:function(element,ui,hideSlider,reverse){this._super(element);this.ui=ui;this.zoomingIn=false;this.zoomingOut=false;this.updateInterval=10;this.element.empty();this.increaseButton=$("<div class='button in no-select'>+</div>");this.increaseButton.hammer().on("touch",ClassCallback(this,this.toggleZoomIn));this.increaseButton.hammer().on("release",ClassCallback(this,this.toggleZoomIn));this.element.append(this.increaseButton);if(typeof hideSlider!==undefined||hideSlider===false){this.slideButton=$("<div class='slide-button no-select'></div>");this.slideArea=$("<div class='slide-area'></div>");this.slideArea.append(this.slideButton);this.element.append(this.slideArea);this.dragScroll=new DragScroll(this.slideArea,this.slideButton,{reverse:false,swapContainers:false});this.dragScroll.setUpdateCallback(ClassCallback(this,this.updateZoom))}this.decreaseButton=$("<div class='button out no-select'>-</div>");this.decreaseButton.hammer().on("touch",ClassCallback(this,this.toggleZoomOut));this.decreaseButton.hammer().on("release",ClassCallback(this,this.toggleZoomOut));this.element.append(this.decreaseButton)},updateZoom:function(){var percentage=1-this.dragScroll.getRelativePosition()[1];this.ui.setZoom(percentage)},setZoom:function(zoom){if(zoom>=0&&zoom<=1){this.dragScroll.setRelativePosition(zoom)}},zoomIn:function(){this.ui.increaseZoom();clearTimeout(this.zoomInTimer);this.zoomInTimer=setTimeout(ClassCallback(this,this.zoomIn),this.updateInterval)},zoomOut:function(){this.ui.decreaseZoom();clearTimeout(this.zoomOutTimer);this.zoomOutTimer=setTimeout(ClassCallback(this,this.zoomOut),this.updateInterval)},toggleZoomIn:function(event){event.gesture.stopPropagation();if(this.zoomingIn){clearTimeout(this.zoomInTimer)}else{this.zoomInTimer=setTimeout(ClassCallback(this,this.zoomIn),this.updateInterval)}this.zoomingIn=!this.zoomingIn},toggleZoomOut:function(event){event.gesture.stopPropagation();if(this.zoomingOut){clearTimeout(this.zoomOutTimer)}else{this.zoomOutTimer=setTimeout(ClassCallback(this,this.zoomOut),this.updateInterval)}this.zoomingOut=!this.zoomingOut},resize:function(){this.dragScroll.resize()}});var TopicsMenu=ScrollableMenu.extend({init:function(element,ui){this._super(element);this.ui=ui;this.wayfinder=ui.wayfinder;this.setup()},setup:function(){var language=this.wayfinder.getLanguage();var groups=this.sortGroups(this.wayfinder.poiGroups);for(var i in groups){if(groups[i].getShowInMenu()){this.add(this.createItem(groups[i]))}}this.publish()},createItem:function(group){var item=new BulletItem(group.getName(this.ui.wayfinder.getLanguage()));item.setDataObject(group);item.setBulletColor(group.getColor());return item},sortGroups:function(groups){var newArray=[];var language=this.wayfinder.getLanguage();for(var i in groups){if(groups[i].getName(language)){newArray.push(groups[i])}}newArray.sort(function(a,b){if(a.getName(language)&&b.getName(language))return a.getName(language).toLowerCase().trim().localeCompare(b.getName(language).toLowerCase().trim())});return newArray},onItemClick:function(item){this.ui.displayGroup(item.getDataObject())},update:function(){this.clear();this.setup()}});var GoogleMap=UIComponent.extend({init:function(element,ui){this._super(element);this.map=null;this.options={zoom:17};this.setup()},setup:function(lat,lng,zoom){if(typeof google!=="undefined"){this.options.center=new google.maps.LatLng(lat,lng);this.options.zoom=zoom;this.map=new google.maps.Map(this.element[0],this.options);var marker=new google.maps.Marker({position:this.options.center,map:this.map})}},onActivate:function(){google.maps.event.trigger(this.map,"resize")}});var HotGroupsMenu=Menu.extend({init:function(element,ui){this._super(element);this.innerElement=$("<div class='inner'></div>");this.ui=ui;this.setup()},addItemElement:function(item){this.innerElement.append(item.element);item.element.on("selectstart",false)},setup:function(){var groups=this.ui.wayfinder.poiGroups;var item=null;this.clear();this.element.append(this.innerElement);for(var i in groups){if(groups[i].getShowInTopMenu()){item=this.add(new ImageMenuItem(groups[i].getNames().get(this.ui.wayfinder.getLanguage())));item.setCallback(ClassCallback(this,this.showGroup));item.setDataObject(groups[i]);if(groups[i].getImageID()){item.loadImage(groups[i].getImageID(),this.ui.wayfinder)}}}this.publish()},showGroup:function(item){this.ui.displayGroup(item.getDataObject(),true);this.hide()}});var IFrameWindow=UIComponent.extend({init:function(element,ui){this._super(element);this.ui=ui;this.iframe=null;this.setup()},setup:function(){var header=$("<div class='header'></div>");var close=$("<div class='close'>Close</close>");close.hammer().on("tap",ClassCallback(this,this.close));this.ui.wayfinder.translator.translateElement(close,"close");header.append(close);this.iframe=$("<iframe src=''></iframe>");this.element.append(header);this.element.append(this.iframe)},open:function(url,width,height){this.iframe.attr("src",url);this.show()},close:function(){this.hide()}});var TabsMenu=Menu.extend({init:function(element,ui,menuTabs,defaultTab){this._super(element);this.ui=ui;this.wayfinder=ui.wayfinder;this.tabs=menuTabs;this.itemmap={};this.defaultTab="az";if(typeof defaultTab!=="undefined"){this.defaultTab=defaultTab}this.setup();this.activateTab(this.defaultTab)},setup:function(){this.itemmap.topics=this.add(new ImageMenuItem("topics"));this.itemmap.topics.setDataObject("topics");this.wayfinder.translator.translateElement(this.itemmap.topics.textElement,"topics");this.itemmap.topics.element.addClass("topics");this.itemmap.atoz=this.add(new ImageMenuItem("az"));this.itemmap.atoz.setDataObject("az");this.wayfinder.translator.translateElement(this.itemmap.atoz.textElement,"az");this.itemmap.atoz.element.addClass("az");this.itemmap.floors=this.add(new ImageMenuItem("floors"));this.itemmap.floors.setDataObject("floors");this.wayfinder.translator.translateElement(this.itemmap.floors.textElement,"floors");this.itemmap.floors.element.addClass("floors");this.itemmap.searchItem=this.add(new TextInputItem(this.wayfinder.translator.get("search"),ClassCallback(this,this.search)));this.wayfinder.translator.translateAttribute(this.itemmap.searchItem.input,"value","search");this.wayfinder.translator.translateAttribute(this.itemmap.searchItem.input,"data-label","search");this.itemmap.searchItem.element.addClass("search");this.publish()},onItemClick:function(item){this.tabs.activateTab(item.getDataObject())},search:function(value){this.itemmap.searchItem.setValue(value);this.tabs.getTab("search").getPanel().search(value);this.tabs.activateTab("search")},update:function(){this.itemmap.searchItem.reset()},activateTab:function(name){this.activateItem(this.itemmap[name]);this.tabs.activateTab(name)},restore:function(){this.activateTab(this.defaultTab)}});var FloorsMenu=ScrollableMenu.extend({init:function(element,ui){this._super(element);this.ui=ui;this.wayfinder=ui.wayfinder;this.setup()},setup:function(){var language=this.wayfinder.getLanguage();var floors=this.wayfinder.building.getSortedFloors();for(var i in floors){if(floors[i]&&floors[i].showInMenu){var item=this.prepend(new MenuItem(floors[i].getName(language)));item.setDataObject(floors[i])}}this.publish()},onItemClick:function(item){this.ui.displayFloorPOIs(item.getDataObject())},update:function(){this.clear();this.setup()}});var FlagsMenu=Menu.extend({init:function(element,ui){this._super(element);this.ui=ui;this.setup()},setup:function(){if(Object.keys(this.ui.wayfinder.languages).length<2)return;for(var i in this.ui.wayfinder.languages){var item=this.add(new ImageMenuItem(this.ui.wayfinder.languages[i].getNativeName(),this.ui.wayfinder));item.loadImage(this.ui.wayfinder.languages[i].flagImage,this.ui.wayfinder);item.setDataObject(this.ui.wayfinder.languages[i]);item.addClass(this.ui.wayfinder.languages[i].getName());if(this.ui.wayfinder.getLanguage()==this.ui.wayfinder.languages[i].getName()){this.activateItem(item)}}if(this.items.length<2){this.items=[]}this.publish()},onItemClick:function(item){this._super(item);this.ui.wayfinder.setLanguage(item.getDataObject().getName())},update:function(){this._super();for(var i in this.items){if(this.items[i].getDataObject().getName()==this.ui.wayfinder.getLanguage()){this.activateItem(this.items[i])}}}});var FacilitiesMenu=Menu.extend({init:function(element,ui,replaceYAHIcon){this._super(element);this.ui=ui;this.replaceYAHIcon=true;if(typeof replaceYAHIcon!=="undefined"){this.replaceYAHIcon=replaceYAHIcon}this.setup()},setup:function(){var groups=this.ui.wayfinder.poiGroups;var item=null;for(var i in groups){if(groups[i].getShowInTopMenu()){item=this.add(new ImageMenuItem(groups[i].getNames().get(this.ui.wayfinder.getLanguage())));item.setCallback(ClassCallback(this,this.showGroup));item.setDataObject(groups[i]);if(groups[i].getImageID()){item.loadImage(groups[i].getImageID(),this.ui.wayfinder)}}}this.addYAH();this.publish()},addYAH:function(){var item=this.add(new ImageMenuItem("yah"));item.setCallback(ClassCallback(this,this.showYAH));item.addClass("yah");this.ui.wayfinder.translator.translateElement(item.textElement,"yah");var icon=this.ui.wayfinder.settings.getInt("kiosk.you-are-here-image",0);if(this.replaceYAHIcon&&icon){item.loadImage(icon,this.ui.wayfinder)}},showYAH:function(){console.log("showYAH");this.ui.showUsersLocation()},showGroup:function(item){this.ui.displayGroup(item.getDataObject(),true)},update:function(){this.clear();this.setup()}});var DealsMenu=ScrollableMenu.extend({init:function(element,ui){this._super(element);this.ads=ui.wayfinder.poiAdvertisements;this.setup()},setup:function(){for(var adIndex in this.ads){this.add(new DealsMenuItem(this.ads[adIndex],wayfinder))}this.publish()}});var YAHMenuItem=MenuItem.extend({init:function(kiosk){this._super("");this.kiosk=kiosk},onAdd:function(menu){this.element.addClass("yah")},onActivate:function(menu){}});var Tabs=Menu.extend({init:function(element){this._super(element);this.tabs=[];this.activeTab=false},add:function(name,tab,button){this.tabs[name]=new Tab(name,tab,button);if(button)this._super(button);return this.tabs[name]},removeTab:function(tab){for(var i in this.tabs){if(this.tabs[i]==tab){this.tabs.splice(i,1);this.tabs[i].remove(this);return}}},getTab:function(name){return this.tabs[name]},activate:function(tab){if(tab instanceof UIComponent){for(var i in this.tabs){if(this.tabs[i]==tab){this.activateTab(i)}}}},activateTab:function(name){var tab=this.getTab(name);if(tab){if(this.activeTab&&this.activeTab!==tab){this.activeTab.hide(this);this.activeTab.deactivate()}this.activeTab=tab;this.activeTab.show(this);this.activeTab.activate();this.onActivate(this.activeTab,name)}},restoreTab:function(name){var tab=this.getTab(name);if(tab){if(this.activeTab&&this.activeTab!==tab){this.activeTab.hide(this);this.activeTab.deactivate()}this.activeTab=tab;this.activeTab.show(this);this.activeTab.activate()}},resize:function(){this._super();for(var i in this.tabs){this.tabs[i].resize()}},update:function(){for(var i in this.tabs){this.tabs[i].update()}}});var Tab=Class.extend({init:function(name,panel,button){this.name=name;if(panel&&panel instanceof UIComponent){this.panel=panel}if(button&&button instanceof UIComponent)this.button=button},update:function(){this.panel.update();if(this.button)this.button.update()},getPanel:function(){return this.panel},getButton:function(){return this.button},remove:function(){},show:function(){this.panel.show();if(this.button){this.button.activate()}},hide:function(){this.panel.hide();if(this.button){this.button.deactivate()}},activate:function(){if(this.panel){this.panel.activate()}if(this.button){this.button.activate()}},deactivate:function(){if(this.panel){this.panel.deactivate()}if(this.button){this.button.deactivate()}},restore:function(){if(this.panel){this.panel.show(this)}},resize:function(){if(this.panel){this.panel.resize()}if(this.button){this.button.resize()}}});var MenuTab=Tab.extend({init:function(menu){this._super(menu.element);this.menu=menu},show:function(modifier){this.menu.show(modifier)},hide:function(modifier){this.menu.hide(modifier)}});var Keyboard=UIComponent.extend({init:function(container,defaultLayout){this._super(container);this.layouts={};this.layoutName=defaultLayout===undefined?"en":defaultLayout;this.keyset="default";this.container=container;this.selectionStart=0;this.selectionEnd=0;this.output="";this.value="";this.ready_function=null;this.actions=new KeyboardActions(this);this.cbOnChange=null;this.setDefaultLayout()},addLayout:function(name,layout){this.layouts[name]=layout},changeLayout:function(name,keyset){this.layoutName=name;if(keyset){this.keyset=keyset}else{this.keyset="default"}this.clear();this.construct()},setOutput:function(output){this.output=output;var me=this;$(this.output).focus(function(){me.updateFromOutput()});$(this.output).keyup(function(){me.updateFromOutput()});$(this.output).mouseup(function(){me.updateFromOutput()});$(this.output).change(function(){me.updateFromOutput()})},updateFromOutput:function(){if($(this.output).is("input")){this.value=$(this.output).val()}else{this.value=$(this.output).text()}this.getCaretPosition()},clear:function(){this.element.empty()},clearValue:function(){this.value="";this.selectionStart=0;this.selectionEnd=0},getCurrentKeyset:function(){try{return this.layouts[this.layoutName]["keys"][this.keyset]}catch(err){console.log("Error! Probably no keyboard layout added!");return this.layouts["en"]["keys"]["default"]}},construct:function(){this.clear();var html="";var keyset=this.getCurrentKeyset();var c=this.container;var me=this;for(var r in keyset){html+="<div class='keyboard_row'>";for(var k in keyset[r]){var key=keyset[r][k];switch(typeof key){case"string":html+="<div class='keyboard_key "+key+"' row='"+r+"' index='"+k+"'>"+key+"</div>";break;case"object":var key_class="";if(key.cls)key_class=" "+key.cls;html+="<div class='keyboard_key"+key_class+" "+key.key+"' object='' row='"+r+"' index='"+k+"'>"+key.key+"</div>";break}}html+="</div>"}this.container.append(html);this.container.find(".keyboard_key").mousedown(function(){me.getCaretPosition();me.keyPressed(this)});this.container.find(".keyboard_key").mouseup(function(){me.keyReleased(this)});$(this.container).find(".keyboard_key").mouseout(function(){me.keyReleased(this)});if(this.container[0]!==undefined){this.container[0].onselectstart=function(){return false};this.container[0].onmousedown=function(){return false}}this.rescale()},rescale:function(){var keyboard_height=0;var keyboard_width=0;this.container.find(".keyboard_row").each(function(){var key_height=$(this).outerHeight()-$(this).innerHeight();var row_width=$(this).outerWidth()-$(this).innerWidth();$(this).children().each(function(){var width=0;if($(this).outerWidth()<$(this).outerWidth(true))width=$(this).outerWidth(true);else width=$(this).outerWidth()+$(this).outerWidth(true);row_width+=width+1;key_height=Math.max(key_height,$(this).outerHeight(true))});$(this).width(row_width);$(this).height(key_height);keyboard_height+=key_height});this.container.height(keyboard_height);if(this.ready_function!==null){this.ready_function()}},keyPressed:function(key){$(key).addClass("key_pressed");var layout=this.getCurrentKeyset();var lkey=layout[$(key).attr("row")][$(key).attr("index")];switch(typeof lkey){case"string":this.changeValue(lkey);break;case"object":if(lkey.action===undefined){this.changeValue(lkey.key)}else{this.actions.activate(lkey)}break}this.pushtoOutput()},changeValue:function(char){var start=this.value.substring(0,this.selectionStart);var end=this.value.substring(this.selectionEnd,this.value.length);this.value=""+start+char+end;this.selectionStart+=char.length;this.selectionEnd=this.selectionStart},pushtoOutput:function(){if(this.output){if(this.output.is("input")){this.output.val("input");this.output.val(this.value);this.output[0].selectionStart=this.selectionStart;this.output[0].selectionEnd=this.selectionEnd}else{this.output.html(this.value)}this.output.trigger("change");this.output.trigger("keyup");this.output.trigger("");if(this.cbOnChange&&typeof this.cbOnChange==="function"){this.cbOnChange(this.value)}}},getCaretPosition:function(){if(this.output!==undefined){if($(this.output).is("input")){this.selectionStart=$(this.output)[0].selectionStart;this.selectionEnd=$(this.output)[0].selectionEnd}}},keyReleased:function(key){$(key).removeClass("key_pressed")},width:function(){return $(this.container).outerWidth()},height:function(){return $(this.container).outerHeight()},ready:function(ready_function){this.ready_function=ready_function},setDefaultLayout:function(){this.layouts["en"]={name:"English",keyboard:"US International",local_name:"English",lang:"en",keys:{"default":[["1","2","3","4","5","6","7","8","9","0",{key:"&#171; Bksp",action:["backspace"],cls:"key2x"}],["q","w","e","r","t","y","u","i","o","p","\\"],["a","s","d","f","g","h","j","k","l",{key:"Enter",action:["submit"],cls:"key3x"}],[{key:"Shift",action:["change_keyset","shift"],cls:"key2x"},"z","x","c","v","b","n","m"],[{key:" ",cls:"key_spacebar"}]],shift:[["~","!","@","#","$","%","^","&","*","(",")",{key:"&#171; Bksp",action:"backspace",cls:"key2x"}],["Q","W","E","R","T","Y","U","I","O","P","{","}"],["A","S","D","F","G","H","J","K","L",{key:"Enter",action:["submit"],cls:"key3x"}],[{key:"Shift",action:["change_keyset","default"],cls:"key2x active"},"Z","X","C","V","B","N","M","<",">","?"],[{key:" ",cls:"key_spacebar"}]]}}}});var KeyboardActions=Class.extend({init:function(keyboard){this.keyboard=keyboard},activate:function(key){if(typeof this.actions[key.action[0]]==="function"){this.actions[key.action[0]](key,this.keyboard)}},addAction:function(key,callback){this.actions[key]=callback},actions:{backspace:function(key,keyboard){if(keyboard.selectionStart>0&&keyboard.selectionStart==keyboard.selectionEnd){keyboard.selectionStart--;keyboard.changeValue("")}else{keyboard.changeValue("")
}},change_keyset:function(key,keyboard){if(key.action[1]!==undefined){keyboard.keyset=key.action[1];keyboard.clear();keyboard.construct()}},change_layout:function(key,keyboard){if(key.action[1]!==undefined){keyboard.layoutName=key.action[1];keyboard.clear();keyboard.construct()}},submit:function(key,keyboard){if(key.action[1]!==undefined){keyboard.pushtoOutput();keyboard.clear()}}}});KeyboardLayouts=Class.extend({init:function(){this.layouts={};this.setDefaultLayout()},get:function(name){return this.layout[name]},add:function(name,_layout){this.layouts[name]=_layout.get(name)},setDefaultLayout:function(){this.layouts["en"]={name:"English",keyboard:"US International",local_name:"English",lang:"en",keys:{"default":[["`","1","2","3","4","5","6","7","8","9","0","-","=",{key:"&#171; Bksp",action:["backspace"],cls:"key2x"}],[{key:"Tab",action:["tab"],cls:"key2x"},"q","w","e","r","t","y","u","i","o","p","[","]","\\"],[{key:"Caps",action:["change_keyset","capslck"],cls:"key2x"},"a","s","d","f","g","h","j","k","l",";","'",{key:"Enter",action:["submit"],cls:"key3x"}],[{key:"Shift",action:["change_keyset","shift"],cls:"key2x"},"z","x","c","v","b","n","m",",",".","/",{key:"Shift",action:["change_keyset","shift"],cls:"key2x"}],[{key:"AltCr",action:["change_keyset","altgr"],cls:"key2x"},{key:" ",cls:"key_spacebar"},{key:"AltCr",action:["change_keyset","altgr"],cls:"key2x"}]],capslck:[["`","1","2","3","4","5","6","7","8","9","0","-","=",{key:"&#171; Bksp",action:"backspace",cls:"key2x"}],[{key:"Tab",action:["tab"],cls:"key2x"},"Q","W","E","R","T","Y","U","I","O","P","[","]","\\"],[{key:"Caps",action:["change_keyset","default"],cls:"key2x active"},"A","S","D","F","G","H","J","K","L",";","'",{key:"Enter",action:["submit"],cls:"key3x"}],[{key:"Shift",action:["change_keyset","shift"],cls:"key2x"},"Z","X","C","V","B","N","M",",",".","/",{key:"Shift",action:["change_keyset","shift"],cls:"key2x"}],[{key:"AltCr",action:["change_keyset","altgr"],cls:"key2x"},{key:" ",cls:"key_spacebar"},{key:"AltCr",action:["change_keyset","altgr"],cls:"key2x"}]],shift:[["~","!","@","#","$","%","^","&","*","(",")","_","+",{key:"&#171; Bksp",action:"backspace",cls:"key2x"}],[{key:"Tab",action:["tab"],cls:"key2x"},"Q","W","E","R","T","Y","U","I","O","P","{","}","|"],[{key:"Caps",action:["change_keyset","capslck"],cls:"key2x"},"A","S","D","F","G","H","J","K","L",":",'"',{key:"Enter",action:["submit"],cls:"key3x"}],[{key:"Shift",action:["change_keyset","default"],cls:"key2x active"},"Z","X","C","V","B","N","M","<",">","?",{key:"Shift",action:["change_keyset","default"],cls:"key2x active"}],[{key:"AltCr",action:["change_keyset","altgr"],cls:"key2x"},{key:" ",cls:"key_spacebar"},{key:"AltCr",action:["change_keyset","altgr"],cls:"key2x"}]],altgr:[["","¹","²","³","¤","€","¼","½","¾","‘","’","¥","×",{key:"&#171; Bksp",action:"backspace",cls:"key2x"}],[{key:"Tab",action:["tab"],cls:"key2x"},"ä","å","é","®","þ","ü","ú","í","ó","ö","«","»","¬"],[{key:"Caps",action:["change_keyset","default"],cls:"key2x"},"á","ß","ð","","","","","","ø","¶","´",{key:"Enter",action:["submit"],cls:"key3x"}],[{key:"Shift",action:["change_keyset","altgr_shift"],cls:"key2x"},"æ","","©","","","ñ","µ","ç","","¿",{key:"Shift",action:["change_keyset","default"],cls:"key2x"}],[{key:"AltCr",action:["change_keyset","default"],cls:"key2x active"},{key:" ",cls:"key_spacebar"},{key:"AltCr",action:["change_keyset","default"],cls:"key2x active"}]],altgr_shift:[["","¡","","","£","","","","","","","","÷",{key:"&#171; Bksp",action:"backspace",cls:"key2x"}],[{key:"Tab",action:["tab"],cls:"key2x"},"Ä","Å","É","","Þ","Ü","Ú","Í","Ó","Ö","","","¦"],[{key:"Caps",action:["change_keyset","default"],cls:"key2x"},"Á","§","Ð","","","","","","Ø","°","¨",{key:"Enter",action:["submit"],cls:"key3x"}],[{key:"Shift",action:["change_keyset","altgr"],cls:"key2x active"},"Æ","","¢","","","Ñ","","Ç","","",{key:"Shift",action:["change_keyset","default"],cls:"key2x active"}],[{key:"AltCr",action:["change_keyset","default"],cls:"key2x active"},{key:" ",cls:"key_spacebar"},{key:"AltCr",action:["change_keyset","altgr"],cls:"key2x active"}]]}}}});var Banner=UIComponent.extend({init:function(element,frames){this._super(element);this.frames=frames;this.current=0;this.timer=null;this.element.addClass("set");this.fadeDuration=500;this.backgroundColor="#fff";this.element.css("background-color",this.backgroundColor);this.load();this.play()},show:function(time){if(time){this.element.show(time)}else{this.element.show()}this.onShow()},hide:function(time){if(time){this.element.hide(time)}else{this.element.hide()}this.onHide()},load:function(){var tplSubcontainer='<div style="position: absolute; background-size: cover; background-position: 50% 50%; background-repeat: no-repeat; left: {1}%; top: {2}%; width: {3}%; height: {4}%; {5}" data-id="{0}"></div>';for(var i=0;i<this.frames.length;i++){var frame=this.frames[i];frame.element=$('<div style="position: relative; width: 100%; height: 100%;">');for(var j=0;j<frame.containers.length;j++){var container=frame.containers[j];var image="";if(container.advertisement_id>0&&!(container.type&&container.type.substr(0,5)==="video")){image="background-image: url('{0}');".format(WayfinderAPI.advertisements.data.url(container.advertisement_id))}container.element=$(tplSubcontainer.format(container.id,container.left,container.top,container.width,container.height,image));if(container.advertisement_id>0&&container.type.substr(0,5)==="video"){container.element.append($('<video width="100%" height="auto" src="{0}" loop></video>'.format(WayfinderAPI.advertisements.data.url(container.advertisement_id))))}frame.element.append(container.element)}frame.element.hide()}},play:function(){if(this.current>=this.frames.length)return;var banner=this;var frame=banner.frames[banner.current];if(banner.frames.length>1){if(banner.element.children().length){banner.element.children().first().fadeOut(banner.fadeDuration);setTimeout(function(){banner.element.children().first().remove()},banner.fadeDuration)}}frame.element.appendTo(banner.element).css("position","absolute").hide().fadeIn(banner.fadeDuration);for(var i=0;i<frame.containers.length;i++){if(frame.containers[i].type&&frame.containers[i].type.substr(0,5)==="video"&&frame.containers[i].element){var el=$(frame.containers[i].element).children("video").get(0);el.play().then(function(response){el.currentTime="0"},function(error){})}if(frame.containers[i].element&&frame.containers[i].element.hammer)frame.containers[i].element.hammer().on("tap",ClassCallback(banner,banner.onClick))}if(banner.frames.length>1){banner.next()}if(banner.timer)clearTimeout(banner.timer);banner.timer=setTimeout(ClassCallback(banner,banner.play),frame.duration)},next:function(){if(this.current<this.frames.length-1){this.current++}else{this.current=0}},onClick:function(event){var id=$(event.currentTarget).data("id")}});var Clock=MenuItem.extend({init:function(element,options){this._super("");this.options=options;this.time=null;this.date=null;this.setup()},setup:function(){this.time=document.createElement("div");this.time.className="time";this.element.append(this.time);this.date=document.createElement("div");this.date.className="date";this.element.addClass("clock");this.element.append(this.date);setInterval(ClassCallback(this,this.update),1e3)},update:function(){var d=new Date;this.time.textContent=("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2);this.date.textContent=("0"+d.getDate()).slice(-2)+"."+("0"+(d.getMonth()+1)).slice(-2)+"."+d.getFullYear()}});